<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="../../util/docbook/schema/docbookspec.rng" type="xml"?>
<?oxygen SCHSchema="../../util/docbook/schema/docbookspec.sch"?>
<?oxygen SCHSchema="../../util/docbook/schema/docbook.sch"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1b2">
   <title>EPUB Publications 3.0</title>

    <info>
        <releaseinfo>Internal Working Group Draft</releaseinfo>
        <pubdate>2010-xx-xx</pubdate>

        <printhistory>
            <formalpara>
                <title>This version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
            <formalpara>
                <title>Previous version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
            <formalpara>
                <title>Diffs to previous version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
        </printhistory>

        <copyright>
            <year>2010</year>
            <year>2011</year>
            <holder>International Digital Publishing Forum™</holder>
        </copyright>

        <legalnotice>
            <para>All rights reserved. This work is protected under Title 17 of the United States
                Code. Reproduction and dissemination of this work with changes is prohibited except
                with the written permission of the International Digital Publishing Forum.</para>
        </legalnotice>

        <authorgroup>
            <editor>
                <personname>Garth Conboy</personname>
                <affiliation>
                    <org>
                        <orgname>eBook Technologies</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname>Markus Gylling</personname>
                <affiliation>
                    <org>
                        <orgname>DAISY Consortium</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname>William McCoy</personname>
                <affiliation>
                    <org>
                        <orgname>WebPaper LLC</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname><remark role="todo">TBD - additional editors</remark></personname>
            </editor>

        </authorgroup>

        <abstract>
            <title>EPUB Publications 3.0</title>
            <para>EPUB is an interchange and delivery format for digital publications based on XML
                and Web Standards. EPUB3, the third major revision of EPUB, is defined by a set of
                specification documents, including this document. This document describes and
                details conformance requirements applicable to EPUB publications as a whole.</para>
        </abstract>

    </info>

    <chapter xml:id="sec-overview">
        <title>Overview</title>
        <section xml:id="sec-overview-purpose-and-scope">
            <title>Purpose and Scope</title>
            <para>This document,  EPUB Publications 3.0, defines publication-level semantics and
                conformance requirements for EPUB3, the third major revision of EPUB, an interchange
                and delivery format based on XML and Web Standards.</para>
            <para>This document is meant to be read and understood in concert with the other
                documents that make up EPUB3. The non-normative "EPUB3 Overview", which provides an
                overview of EPUB and a roadmap to the rest of the EPUB3 documents, should be read
                first.</para>
        </section>
        <section xml:id="sec-overview-relationship">
            <title>Relationship to Other Specifications</title>
            <para>This specification references and integrates the building-block specifications
                comrpising EPUB3: OCF, OPF, Content Documents, NCX, and Media Overlays. Unless
                otherwise specified terms used herein have the meaning defined in these
                specifications <remark role="todo"><remark role="todo"> TBD: enumerate other
                        dependent specs </remark>TBD: statement about layered use of terminology
                    from other dependent specs </remark><remark role="todo"> TBD: statement about
                    conformance requirements based on dependent specs<remark role="todo"> TBD: this
                        specification supersedes OPS 2.0.1</remark></remark></para>
            </section>

        <section xml:id="sec-overview-terminology">
            <title>Terminology</title>
            <glosslist>
                <glossentry xml:id="gloss-epub-publication">
                    <glossterm>EPUB Publication (<emphasis role="underline">or</emphasis>
                        Publication)</glossterm>
                    <glossdef>
                        <para>A collection of Content Documents, an OPF Package file, and other
                            media files and supporting components, packaged in an OCF container in
                            manner also conformant with this specification. Note that because OCF
                            defines both ZIP and Filesystem containers, an EPUB Publication does not
                            necessarily exist in the form of a single file.</para>
                    </glossdef>
                </glossentry>
                <glossentry>
                    <glossterm>EPUB File</glossterm>
                    <glossdef>
                        <para>An EPUB Publication packaged as an OCF ZIP container (or,
                            equivalently, an Expanded Publication that has been "zipped" into a
                            single file).</para>
                    </glossdef>
                </glossentry>
                <glossentry>
                    <glossterm>Expanded Publication</glossterm>
                    <glossdef>
                        <para>An EPUB Publication packaged as an OCF Filesystem container (or,
                            equivalently, an EPUB File that has been "unzipped").</para>
                    </glossdef>
                </glossentry>
                <glossentry>
                    <glossterm>Extended Content Document Reference</glossterm>
                    <glossdef>
                        <para>An item in the Package File manifest that either a) refers to an
                            EPUB Content Document,  b) includes an EPUB Content Document in its
                            fallback chain or c) includes an item that references an XML document
                            and which contains a valid fallback-style attribute.</para>
                    </glossdef>
                </glossentry>
                <glossentry>
                    <glossterm>EPUB Reading System (<emphasis role="underline">or</emphasis> Reading
                        System)</glossterm>
                    <glossdef>
                        <para>A system that processes Publications for presentation to end users in
                            a manner conformant with this specification, including its dependent
                            specifications. A conforming Reading System is not necessarily a single
                            dedicated program or device but may exist as a distributed system, and a
                            wide variety of legitimate presentations of Publicaitons by Reading
                            Systems are contemplated by this specification.</para>
                    </glossdef>
                </glossentry>
            </glosslist>
        </section>            
        
        <section xml:id="sec-overview-conformance">
            <title>Conformance</title>
            <xi:include href="./share/conformancestatements.xml"/>
        </section>

    </chapter>

    <chapter xml:id="sec-opf-introduction">
        <title>Introduction</title>
        <para>EPUB is an interchange and delivery format for digital publications, based on XML and
            Web Standards. An EPUB Publication can be thought of as a "website in a box": a
            packaging of Web content that represents a digital book, magazine, or other type of
            publication, with a declarative means to navigate through the content, and able to
            distributed reliably for online and offline consumption. </para>
        <para>This specification defines the semantics and conformance requirements for EPUB at the
            publication level. The individual contents of EPUB Publications are defined by other
            specifications; any  EPUB Publication consists of at minimum four files (e.g.,
            container.xml, manifest.opf, nav.ncx, and index.html), defined according to the rules of
            four independent, modular specifications (respectively OCF3, OPF3, NCX3, and
            ContentDocs3). This specification defines the additional rules for how these files and
            other optional files are tied together to create valid and conforming EPUB Publications,
            and for how such Publications are processed by a conforming Reading System.</para>
    </chapter>
    <chapter xml:id="sec-ocf-overview">
        <title>EPUB Publications</title>
        <section xml:id="sec-ocf-overview-intro">
            <title>Content Conformance</title>
            <para>An EPUB Publication consists of</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para>One or more EPUB Content Documents (conformant to
                            [ContentDocs3])</para>
                    </listitem>
                    <listitem>
                        <para>Exactly one Package File (conformant to OPF3)</para>
                    </listitem>
                    <listitem>
                        <para>Exactly one NCX Document (conformant to NCX3)</para>
                    </listitem>
                    <listitem>
                        <para>Zero or more Media Overlay Documents (conformant to  Overlays3)</para>
                    </listitem>
                    <listitem>
                        <para>Zero or more additional  files, all of which, together with the EPUB
                            Content Document(s), NCX Document, and Media Overlay Documents(s) if any, must
                            be uniquely referenced in the Package File's &lt;manifest> element
                            conformant to the rules of OPF3</para>
                    </listitem>
                    <listitem>
                        <para>Packaged as a Filesystem or ZIP container conformant to the rules of
                            OCF3 (containing a valid META-INF/container.xml file and, if in the ZIP
                            container, a MIMETYPE file), potentially together with <emphasis
                                role="bold">external files<emphasis role="bold"
                                >,</emphasis></emphasis> additional files that are not referenced in
                            the &lt;manifest> and thus not considered part of the EPUB
                            Publication.</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>that also adheres to the following additional requirements:</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para role="contentconf">The container.xml's &lt;rootfile> element must contain a &lt;rootfile>
                            element with a media-type of "application/oebps-package+xml" that
                            references the Publication's Package File </para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">Each item referenced in the Package File's
                            &lt;spine> element must be an Extended Content Document
                            Reference.</para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">For each item in the manifest whose media-type is
                            an EPUB3 Core Media Type (as defined in Section 4.1 of this document),
                            the file referenced by that item must conform to the applicable
                            specification for that Core Media Type. </para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">Each item in the manifest whose media-type is NOT
                            one of the EPUB3 Core Media Types must specify a fallback chain that
                            includes at least one item whose media-type is an EPUB3 Core Media Type,
                            or which references an XML Document and includes a
                            fallback-style.</para>
                    </listitem><listitem>
                        <para role="contentconf">The Package Document's &lt;package> element's "toc" attribute value must
                            be the id of the manifest item corresponding to an NCX file.</para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">All referenecs in the NCX Document must resolve to
                            or within a resource that is represented by an Extended Content Document
                            Reference. </para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">If the Package Document contains a guide element,
                            the href attribute of each reference element within it must resolve to
                            or within a resource that is represented by an Extended Content Document
                            Reference, and its type atttribute must conform to the requirements of
                            Section 4.2 of this document. </para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">There must not be any relative URI references of
                            any kind to external files from any item or via any URI referencing
                            mechanism, including script, in any Content Document or other content
                            files.</para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">Content Documents must not contain any "script"
                            elements unless the manifest "item" corresponding to that Content
                            Document contains the "property" value "scripted" (thus indicating a
                                <emphasis role="bold">Scripted Content Document).</emphasis></para>
                    </listitem>
                    <listitem>
                        <para>A fallback-style attribute in a manifest item must not be present
                            unless a) that item's content is XML and b) that item's media-type is
                            not a Core Media Type.</para>
                    </listitem>
                    <listitem>
                        <para>All fallback-style attributes in manifest items must reference a valid
                            EPUB Style Sheet as defined in [ContentDocs3]</para>
                    </listitem>
                    <listitem>
                        <para>All required fallbacks are included as per Section 2.3 below. </para>
                    </listitem>
                    <listitem><para><remark role="todo">TODO: publication-level metadata content conformance requirements</remark></para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">Since scripted content may be processed
                            differently, with features such as pagination potentially disabled,
                            content items that set the property value of "scripted" should not be
                            spine items unless absolutely required by a publication (i.e. scripted
                            content hould if possible be nested, contained within top-level content
                            via "object" or "iframe").</para>
                    </listitem>
                    <listitem>
                        <para role="contentconf">if a Publication is packaged as a ZIP Container, it should be named
                            with the file extension ".epub". </para>
                    </listitem>
                    <listitem><para><remark role="todo">TODO:are there any other "shoulds" (beyond those specified in OCF/OPF)?</remark></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>NOTE: for convenience, a listing of all content conformance requirements
                applicable based on all the EPUB3 specifications is available as Appendix A of the
                EPUB3 Overview.</para>
        <section xml:id="sec-xhtml-content-role-attribute">
            <title>Example: Conforming EPUB Publication</title>
            <para>This section is non-normative.</para>
            <para><remark role="todo">TODO: example (layer on an example from OCF3?)</remark></para>
        </section>
          
        </section>
        <section xml:id="sec-ocf-overview-examples">
            <title>Reading System Conformance</title>
            <para>An EPUB Reading System must necessarily be a conforming User Agent according to
                [ContentDocs3], a conforming OPF Processor according to [OPF3], a conforming OCF
                Processor according to [OCF3], and a conforming NCX Processor according to [NCX3].
                An EPUB Reading System must also, if it supports Media Overlays, be a confoming
                Media Overlay Processor according to [Overlays3].</para>
            <para>In addition, EPUB Reading Systems must adhere to the following additional
            requirements:</para>
            <para>
                <itemizedlist>
                    <listitem>
                        <para role="rsconferr">When providing navigation via the OPF spine, the Reading System must
                            ignore items that are not Extended Content Document References. </para>
                    </listitem>
                    <listitem>
                        <para role="rsconf">Reading Systems must provide a means to render a Publication in the
                            sequence order defined by the spine. Reading Systems must as part of
                            this means a) recognize the first primary (linear=true) item in spine to
                            be the beginning of the main reading order of the publication and b)
                            render successive primary items in the order given in spine. Reading
                            Systems may use "next-page" style functionality when moving from one
                            primary item to the next in spine. </para>
                    </listitem>
                    <listitem>
                        <para role="rsconf">Reading Systems must provide a means to navigate a Publication based
                            on the information in its NCX file.</para>
                    </listitem>
                    <listitem>
                        <para role="rsconf">Reading Systems may provide a means to navigate a Publication based on
                            the information in its optional Guide.</para>
                    </listitem>
                    <listitem>
                        <para role="rsconf">Reading Systems may render Scripted Content Documents as
                            an interactive, scripted HTML User Agent according to [HTML5] rather
                            than according to the simplified processing model defined for EPUB User
                            Agents in [ContentDocs3], i.e. with scripting enabled. Reading Systems
                            should not enable scripting for any resources other than Scripted
                            Content Documents.</para>
                    </listitem>
                    <listitem>
                        <para role="rsconf">Reading Systems may implement support for Scripted
                            Content Documents in a manner that disables other EPUB capabilities
                            and/or provides a different rendering such as, for example, disabling
                            pagination.</para>
                    </listitem>
                    <listitem>
                        <para role="rsconferr">Reading Systems must not fail catastrophically if they encounter two distinct Publications
                            with the same purportedly unique primary identifier as defined in [OPF3].
                        </para>
                    </listitem>
                    <listitem>
                        <para role="rsconferr">Reading Systems must process fallback items according
                            to the rules of Section 2.3 below. </para>
                    </listitem>
                    
                    <listitem>
                        <para role="rsconf">Reading Systems may render an item that is arbitrary XML with a
                            reference to an EPUB Style Sheet. Such rendering is defined to be
                            Reading System dependent. If a Reading System natively supports the XML
                            schema of such an item, the Reading System may ignore the Style
                            Sheet.</para>
                    </listitem>
                    <listitem><para><remark role="todo">TODO: publication-level metadata content conformance requirements</remark></para>
                    </listitem>
                    <listitem>
                        <para>if a Publication is packaged as a ZIP Container, it should be named with the file extension ".epub".
                        </para>
                    </listitem>
                    <listitem><para><remark role="todo">TODO:are there any other "shoulds" (beyond those specified in OCF/OPF)?</remark></para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>NOTE: for oonvenience, all Reading System conformance requirements applicable
                based on all of the EPUB3 specifications are non-normatively summarized in Appendix
                B of the EPUB3 Overview</para>
            <para/>
       

        </section>
        <section xml:id="fallback">
            <title>Fallback Items</title>
            <para role="contentconf">This specification defines a set of Core Media Types that all
                conforming Reading Systems must support in addition to Content Documents (e.g. PNG,
                SVG, OpenType fonts).  Publications may optionally reference items of additional
                media types. In order to ensure that all conforming Publications can be successfully
                rendered by all conforming Reading Systems, alternative "fallback" items must be
                provided for each such item. Fallbacks may be provided either via inherent
                mechanisms defined for Content Documents, or via the manifest-level fallback
                mechanism defined in OPF3. </para>
            <para role="contentconf">For every item that is not a Core Media Type, suitable
                fallback(s) of a Core Media Type must be provided via one of these mechanisms, as
                detailed below:</para>
            <para role="contentconf">For <emphasis role="bold">resources referenced in Content
                    Docuemnts via XHTML object elements,</emphasis> legitimate fallback(s) must be
                provided via that element’s inherent replacement capabilities. Reading Systems must
                ignore manifest-level fallbacks in resolving such reference.</para>
      
            <para role="contentconf"> For <emphasis role="bold">resources referenced in Content
                    Documents via  img elements,</emphasis> the text value of the alt or title
                attributes provide a legitimate fallback and should be included. Additional
                manifest-level fallbacks may be provided. Reading Systems should process
                manifest-level fallbacks in resolving such references. </para>
                
                
                <para role="contentconf">For <emphasis role="bold">fonts embedded in Content
                    Documents or EPUB Style Sheets using the @font-face mechanism,</emphasis> the
                basic rules of CSS must be used to provide a legitimate fallback. Reading Systems
                must ignore manifest-level fallbacks in resolving CSS font references. </para>
            <para>For <emphasis role="bold">all other resource referencing situations</emphasis> in
                EPUB Publications, a legitimate fallback must be provided via the manifest fallback
                mechanism. Reading Systems must process manifest-level fallbacks in resolving such
                resource references.</para>
            
        </section>
    </chapter>

    <chapter xml:id="sec-content-definitions">
        <title>EPUB Content Definitions</title>
        <para>This section includes information about specific values required or allowable in
            different portions of an EPUB Publication in EPUB3 including Core Media Types, Guide
            reference types, and <remark role="todo">TODO: NCX . </remark>.</para>
        <para>The values specified in this section are expected to change significantly over time. Always be sure
        to consult the latest applicable version of this specification.</para>
        <section xml:id="sec-core-media-types">
            <title>Core Media Types</title>
            <para>The following is lists the EPUB Core Media Types by MIME type.</para>
            <para>
                <remark role="todo">TODO: list from OPS2 1.3.7 + updates for EPUB3</remark>
            </para>
        </section>

        <section xml:id="sec-guide-reference-types">
            <title>Guide reference types</title>
            <para role="contentconf">Each Guide reference item's required type attribute must be selected from the list
                defined below when applicable. Other types may be used when none of the predefined
                types are applicable; their names must begin with the string other.. The value for
                the type attribute is case-sensitive. The following list of type values is derived
                from the 13th edition of the Chicago Manual of Style: <remark role="todo">TODO: list
                    from OPF2 2.6 </remark></para>
        </section>
        <section xml:id="sec-ncx-epub-semantics">
            <title>NCX reference types</title>
            <para role="contentconf"><remark role="todo">TODO: EPUB-specific requirements for  NCX</remark></para>
        </section>
    </chapter>

    <appendix xml:id="acknowledgements" role="acknowledgements" conformance="informative">
        <title>Contributors</title>
        <xi:include href="./share/contributors.xml"/>
    </appendix>

    <bibliography xml:id="references">
        <title>References</title>

        <!-- note when adding "et al." to the end of a personname field, omit the terminating 
            period; one is auto-generated after -->

        <bibliodiv>
            <title>Normative References</title>
            <biblioentry xml:id="refIRI">
                <abbrev>IRI</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3987.txt"> Internationalized
                        Resource Identifier</link>
                </title>
                <author>
                    <personname>M. Duerst, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refODF">
                <abbrev>ODF</abbrev>
                <title><link xlink:href="http://www.oasis-open.org/committees/download.php/12572/OpenDocument-v1.0-os.pdf">ODF Open Document Format</link></title>
            </biblioentry>
            <biblioentry xml:id="refODFManifestSchema">
                <abbrev>ODF10 Manifest Schema</abbrev>
                <title><link xlink:href="http://www.oasis-open.org/committees/download.php/12570/OpenDocument-manifest-schema-v1.0-os.rng">ODF 1.0 Manifest Schema</link></title>
            </biblioentry>

            <biblioentry xml:id="refEPUB">
                <abbrev>EPUB Overview</abbrev>
                <title><link xlink:href="http://www.idpf.org/doc_library/epub/OPF_3.0_draft.htm">Open Packaging Format</link><remark role="todo">TODO fix
                    link</remark></title>
            </biblioentry>
            <biblioentry xml:id="refOPF">
                <abbrev>OPF</abbrev>
                <title><link xlink:href="http://www.idpf.org/doc_library/epub/OPF_3.0_draft.htm">Open Packaging Format</link><remark role="todo">TODO fix
                    link</remark></title>
            </biblioentry>
            <biblioentry xml:id="refOPS">
                <abbrev>OPS</abbrev>
                <title><link xlink:href="http://www.idpf.org/doc_library/epub/OPS_2.0.1_draft.htm">Open Publication Structure</link><remark role="todo">TODO fix
                    link</remark></title>
            </biblioentry>
            <biblioentry xml:id="refRelaxNG">
                <abbrev>RelaxNG</abbrev>
                <title>
                    <link xlink:href="http://standards.iso.org/ittf/PubliclyAvailableStandards/c052348_ISO_IEC_19757-2_2008(E).zip">ISO/IEC 19757-2: Regular-grammar-based validation &#8212; RELAX NG</link>
                </title>
                <date>3 December 2001</date>
            </biblioentry>
            <biblioentry xml:id="refRFC2119">
                <abbrev>RFC2119</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs
                        to Indicate Requirement Levels</link> (RFC 2119) </title>
                <date>March 1997</date>
            </biblioentry>
            <biblioentry xml:id="refRFC3986">
                <abbrev>RFC3986</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3986.txt">Uniform Resource
                        Identifier (URI): Generic Syntax</link> (RFC 3986) </title>
                <author>
                    <personname>Berners-Lee, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refRFC3987">
                <abbrev>RFC3987</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3987.txt">Internationalized
                        Resource Identifiers (IRIs)</link> (RFC 3987) </title>
                <author>
                    <personname>M Duerst, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refUAAG10">
                <abbrev>UAAG10</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/WAI-USERAGENT/">User Agent Accessibility
                        Guidelines 1.0</link>
                </title>
                <author>
                    <personname>Ian Jacobs, et al</personname>
                </author>
                <date>17 December 2002</date>
            </biblioentry>
            <biblioentry xml:id="refUnicode5">
                <abbrev>Unicode</abbrev>
                <title>The Unicode Consortium. The Unicode Standard, Version 5.0.0, defined by: The
                    Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN
                    0-321-48091-0)</title>
            </biblioentry>
            <biblioentry xml:id="refWCAG20">
                <abbrev>WCAG20</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/WCAG20/">Web Content Accessibility
                        Guidelines (WCAG) 2.0</link>
                </title>
                <author>
                    <personname>Ben Caldwel, et al</personname>
                </author>
                <date>11 December 2008</date>
            </biblioentry>
            <biblioentry xml:id="refXML">
                <abbrev>XML</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/2008/REC-xml-20081126/">Extensible Markup
                        Language (XML) 1.0 (Fifth Edition)</link>
                </title>
                <author>
                    <personname>T. Bray, et al</personname>
                </author>
                <date>26 November 2008</date>
            </biblioentry>
        </bibliodiv>

    </bibliography>  
</book>
