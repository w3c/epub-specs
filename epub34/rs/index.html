<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>EPUB Reading Systems 3.4</title>
		<meta name="color-scheme" content="light dark" />
		<script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"></script>
		<script src="../../common/js/fix-errata.js" class="remove"></script>
		<script src="../../common/js/css-inline.js" class="remove"></script>
		<script src="../../common/js/data-test-display.js" class="remove"></script>
		<script src="../../common/js/copyright.js" class="remove"></script>
		<script class="remove">
			var respecConfig = {
				group: "pm",
				wgPublicList: "public-pm-wg",
				specStatus: "ED",
				shortName: "epub-rs-34",
				edDraftURI: "https://w3c.github.io/epub-specs/epub34/rs/",
                // implementationReportURI: "https://w3c.github.io/epub-specs/epub34/reports/",
				// previousPublishDate: "2023-05-25",
                // previousMaturity: "REC",
				// errata: "https://w3c.github.io/epub-specs/epub34/errata.html",
				copyrightStart: "1999",
				editors: [ 
				{
					name: "Matt Garrish",
					company: "DAISY Consortium",
					companyURL: "https://daisy.org",
					w3cid: 51655
				},
				{
					name: "Ivan Herman",
					url: "https://www.w3.org/People/Ivan/",
					company: "W3C",
					w3cid: 7382,
					orcid: "0000-0003-0782-2704",
					companyURL: "https://www.w3.org",
				}],
				formerEditors: [{
					name: "Dave Cramer",
					company: "Invited Expert",
					w3cid: 65283
				}],
				includePermalinks: true,
				permalinkEdge: true,
				permalinkHide: false,
				github: {
					repoURL: "https://github.com/w3c/epub-specs",
					branch: "main"
				},
				localBiblio: {
					"csssnapshot": {
						"title": "CSS Snapshot",
						"href": "https://www.w3.org/TR/CSS/"
					},
					"epubcontentdocs-301": {
						"authors":[
						"Markus Gylling",
						"William McCoy",
						"Elika J. Etimad",
						"Matt Garrish"],
						"title": "EPUB Content Documents 3.0.1",
						"href": "https://idpf.org/epub/301/spec/epub-contentdocs-20140626.html",
						"date": "26 June 2014",
						"publisher": "IDPF"
					},
					"epubcontentdocs-32": {
						"authors":[
						"Dave Cramer",
						"Matt Garrish"],
						"title": "EPUB Content Documents 3.2",
						"href": "https://www.w3.org/publishing/epub32/epub-contentdocs.html",
						"date": "08 May 2019",
						"publisher": "W3C"
					},
					"epubmediaoverlays-32": {
						"authors":[
						"Marisa DeMeglio",
						"Daniel Weck"],
						"title": "EPUB Media Overlays 3.2",
						"href": "https://www.w3.org/publishing/epub32/epub-mediaoverlays.html",
						"date": "08 May 2019",
						"publisher": "EPUB 3 Community Group"
					},
					"epubpackages-32": {
						"authors":[
						"Matt Garrish",
						"Dave Cramer"],
						"title": "EPUB Packages 3.2",
						"href": "https://www.w3.org/publishing/epub32/epub-packages.html",
						"date": "08 May 2019",
						"publisher": "EPUB 3 Community Group"
					},
					"h264": {
						"title": "H.264 : Advanced video coding for generic audiovisual services",
						"href": "https://www.itu.int/ITU-T/recommendations/rec.aspx?rec=13189",
						"date": "2017-04-13"
					},
					"svg": {
						"title": "SVG",
						"href": "https://www.w3.org/TR/SVG/",
						"publisher": "W3C"
					},
					"w3cprocess": {
						"title": "W3C Process Document",
						"href": "https://www.w3.org/policies/process/"
					},
				},
				preProcess:[inlineCustomCSS],
				postProcess: [data_test_display, fixErrataField],
				testSuiteURI: "https://w3c.github.io/epub-tests/index.html",
				xref: {
					profile: "web-platform",
					specs: ["epub-34"]
				}
				/* otherLinks: [
					{
						key: "This document is also available in this non-normative format:",
						data: [
							{
								value: "EPUB 3",
								href: "./epub-rs-34.epub"
							}
						]
					}
				 ] */
			};
		</script>
		<style>
			#change-log > details > p {
				margin-left: 1rem;
			}</style>
	</head>
	<body>
		<div data-include="../../common/copyright.html" data-oninclude="modifyCopyright" data-include-replace="true"></div>
		<section id="abstract">
			<p>EPUB® 3 defines a distribution and interchange format for digital publications and documents. The EPUB
				format provides a means of representing, packaging, and encoding structured and semantically enhanced
				web content — including HTML, CSS, SVG and other resources — for distribution in a single-file
				container.</p>
			<p>This specification defines the conformance requirements for EPUB 3 reading systems — the user agents that
				render EPUB publications.</p>
		</section>
		<section id="sotd" class="updateable-rec"></section>
		<section id="sec-introduction">
			<h2>Introduction</h2>

			<section id="sec-intro-overview" class="informative">
				<h3>Overview</h3>

				<p>The EPUB 3 standard is separated into two distinct concerns: the authoring of [=EPUB publications=]
					is defined in the <a data-cite="epub-34#">core specification</a> [[epub-34]], while this
					specification details the rendering requirements for them in [=EPUB reading system=].</p>

				<p>An EPUB reading system can take many forms. It might have a visual display area for rendering the
					content to users, for example, or it might only provide audio playback of the content. Therefore,
					there is no single set of rules that applies to all reading systems. Rather, this specification
					breaks down the rendering requirements based on a reading system's capabilities and the features it
					supports.</p>

				<p>Moreover, this specification allows for a great deal of flexibility for developers to create unique
					user interfaces, and requirements for things like metadata processing are intentionally minimal to
					allow for such flexibility.</p>

				<p>So, although this specification identifies the formal requirements for reading systems, it is not
					possible to understand this document in isolation. Developers also need to familiarize themselves
					with the full content structure of an EPUB publication in order to understand the complete range of
					information that is available.</p>

				<div class="note">
					<p>A conforming reading system is not necessarily a single dedicated program or device but might
						exist as a distributed system.</p>
				</div>
			</section>

			<section id="sec-terminology">
				<h3>Terminology</h3>

				<p>This specification uses <a data-cite="epub-34#sec-terminology">terminology defined in EPUB 3.4</a>
					[[epub-34]].</p>

				<p>It also defines the following term:</p>

				<dl>
					<dt>
						<dfn class="export">content display area</dfn>
					</dt>
					<dd>
						<p>The area within the [=viewport=] dedicated to the display of <a>EPUB content documents</a>.
							The content display area excludes any borders, margins, headers, footers, or other
							decoration a [=EPUB reading system=] might inject into the viewport.</p>
						<p>In the case of [=synthetic spreads=], the viewport contains two content display areas.</p>
					</dd>
				</dl>

				<div class="note">
					<p>Only the first instance of a term in a section links to its definition.</p>
				</div>
			</section>

			<section id="conformance">
				<p>All algorithm explanations are <em>non-normative</em>.</p>
			</section>

			<section id="sec-intro-relations" class="informative">
				<h3>Relationship to other specifications</h3>

				<section id="rel">
					<h4>Relationship to HTML</h4>

					<p>The [[html]] standard is continuously evolving &#8212; there are no longer versioned releases of
						it. That standard, in turn, references various technologies that continue to evolve, such as
						MathML, SVG, CSS, and JavaScript.</p>

					<p>[=Reading system=] developers need to keep track of the changes to HTML, and the technologies it
						references, to ensure they keep their systems up to date.</p>

					<p>This specification does not require EPUB reading systems to support <a
							href="#sec-scripted-content">scripting</a>, <a href="#sec-xhtml-forms">form submission</a>,
						or the HTML DOM [[dom]]. Reading systems conformant with this specification are only expected to
						be able to process a conforming [=EPUB content document=]. As support for scripting and form
						submission is not compulsory, a conformant reading system might not be a fully conformant HTML
						user agent.</p>
				</section>


				<section id="sec-overview-relations-svg">
					<h4>Relationship to SVG</h4>

					<p>This specification does not reference a specific version of [[svg]], but instead uses an undated
						reference. Whenever there is any ambiguity in this reference, the latest recommended
						specification is the authoritative reference.</p>

					<p>This approach ensures that EPUB will always keep pace with changes to the SVG standard. [=Reading
						system=] developers need to keep track of changes to the SVG standard to ensure that they keep
						their systems up to date.</p>
				</section>
			</section>
		</section>
		<section id="sec-rs-conformance">
			<h2>Reading system conformance</h2>

			<section id="rs-conf-req">
				<h3>Requirements</h3>

				<p>Whether a [=reading system=] has to support a feature is mentioned at the beginning of its section.
					To be conformant with this specification, reading systems MUST support all required features as well
					as all applicable conditionally-required features (e.g., to support image rendering if the reading
					system has a [=viewport=]) as defined in their respective sections.</p>

				<p class="note"> As a reading system is not necessarily a single application, but can exist as a
					distributed system, it is not always the case that reading system requirements will be met in the
					application that renders EPUB publications to users. An example is a reading system that solely
					interacts with a controlled content repository (e.g., a bookstore or library system). In this case,
					if a reading system developer can demonstrate that requirements are not applicable to the
					application (e.g., EPUB publications with duplicate [^itemref^] entries [[epub-34]] cannot enter the
					system), the reading system as a whole is still considered conforming. </p>

				<p>When supporting recommended and optional features, reading systems MUST meet all normative
					requirements as defined in their respective sections.</p>

				<p>When reading system developers opt not to support a recommended or optional feature, it does not
					always mean none of the normative requirements of the section apply. In some cases, there might be
					alternative requirements when not implementing a feature (e.g., to <a
						href="#confreq-rs-scripted-flbk">process fallbacks</a> when scripting is not supported). Reading
					systems MUST meet these alternative requirements when not supporting a feature.</p>

				<div class="note">
					<p>EPUB publications frequently contain additional information not specified in [[epub-34]] (e.g.,
						[=package document=] metadata). Reading systems can use this additional information for any
						purposes, such as to improve the user interface.</p>
				</div>
			</section>

			<section id="rs-conf-error-handling">
				<h3>Error handling</h3>

				<p>Reading systems do not have to load [=EPUB publications=], or resources within them, when they
					violate content authoring or processing requirements.</p>
			</section>

			<section id="rs-conf-error-reporting" class="informative">
				<h3>Error reporting</h3>

				<p>Although reading systems do not have to report errors encountered while processing and rendering
					[=EPUB publications=] (e.g., if the dimensions of a [=fixed-layout document=] have been inferred),
					they are strongly encouraged to provide a means of accessing this information. A comparable example
					are the developer tools that web browsers provide for debugging HTML pages and applications.</p>

				<p>Access to such processing information allows, for example, more efficient debugging of EPUB
					publications. For maximum use in debugging, it is advised that reading systems not only report
					issues they directly encounter but also issues reported by any applications they use (e.g., HTML,
					CSS, and JavaScript errors reported from a browser core used to render the content, or validation
					issues reported by <a href="https://www.w3.org/publishing/epubcheck/">EPUBCheck</a>).</p>

				<p>It is not expected that error reporting will be an intrusive experience that affects the general
					reading experience for users. Rather, reporting information could, for example, be selectively
					activated from a settings menu so that it does not bother users unnecessarily.</p>
			</section>
		</section>
		<section id="sec-pub-resources">
			<h3>Publication resource processing</h3>

			<p id="confreq-rs-epub-pub-res" class="support" data-tests="#cnt-xhtml-support">[=Reading systems=] MUST
				process <a data-cite="epub-34#sec-publication-resources">publication resources</a> [[epub-34]].</p>

			<section id="sec-epub-rs-conf-cmt">
				<h4>Core Media types</h4>

				<p id="confreq-rs-epub3-images"
					data-tests="#pub-cmt-avif,#pub-cmt-gif,#pub-cmt-jpg,#pub-cmt-png,#pub-cmt-svg,#pub-cmt-webp">If a
					reading system has a [=viewport=], it MUST support the <a data-cite="epub-34#cmt-grp-image">image
						core media type resources</a> [[epub-34]].</p>

				<p id="confreq-rs-epub3-mp3-aac" data-tests="#pub-cmt-mp3,#pub-cmt-mp4,#pub-cmt-opus">If it has the
					capability to render prerecorded audio, it MUST support the <a data-cite="epub-34#cmt-grp-audio"
						>audio core media type resources</a> [[epub-34]].</p>

				<p class="note" id="note-video-codecs">It is advised that reading systems support at least one of the
					H.264 [[h264]] and VP8 [[rfc6386]] video codecs, but this is not a conformance requirement &#8212; a
					reading system can support any video codec, or none at all. Reading system developers have to take
					into consideration factors such as breadth of adoption, playback quality, and technology royalties
					when deciding which video formats to support.</p>
			</section>

			<section id="sec-epub-rs-conf-foreign-res">
				<h4>Foreign resources</h4>

				<p id="confreq-rs-foreign"
					data-tests="#pub-foreign_image,#pub-foreign_xml-spine,#pub-foreign_xml-suffix-spine,#pub-foreign_bad-fallback,#pub-foreign_json-spine"
					>Reading systems MAY support an arbitrary set of [=foreign resource=] types, and if a foreign
					resource is not supported, MUST process fallbacks as defined in <a
						data-cite="epub-34#sec-foreign-resources">foreign resources</a> [[epub-34]].</p>
			</section>

			<section id="sec-epub-rs-conf-remote-res">
				<h4>Resource locations</h4>

				<p id="confreq-rs-remote">Reading systems SHOULD support [=remote resources=], as defined in <a
						data-cite="epub-34#sec-resource-locations">Resource locations</a> [[epub-34]].</p>

				<p>To limit the risk of network attacks, reading systems SHOULD only load remote resources referenced
					via the <code>https</code> URI scheme [[rfc9110]].</p>
			</section>

			<section id="sec-epub-rs-conf-data-urls">
				<h4>Data URLs</h4>

				<p id="confreq-rs-data-urls"
					data-tests="#pub-data-urls_browsing-context,#pub-data-urls_top-level-content">Reading systems MUST
					prevent data URLs [[rfc2397]] from opening in [=top-level browsing contexts=] [[html]], except when
					initiated through a reading system affordance such as a context menu. If a reading system does not
					use a top-level browsing context for [=top-level content documents=], for example if the top-level
					content document is an SVG, it MUST also prevent data URLs from opening as though they are top-level
					content documents.</p>
			</section>

			<section id="sec-epub-rs-conf-file-urls">
				<h4>File URLs</h4>
				<p id="confreq-rs-file-urls" data-tests="#pub-file-urls">Reading Systems MUST prevent access to
					resources referenced via file URLs [[rfc8089]].</p>
			</section>

			<section id="sec-epub-rs-conf-xml">
				<h4>XML processing</h4>

				<p id="confreq-rs-xml-nval"
					data-tests="#pub-xml-non-validating_comment,#pub-xml-non-validating_unclosed">A [= reading system =]
					MUST use a non-validating XML processor [[xml]] that:</p>

				<ul class="conformance-list">
					<li id="confreq-rs-xml-extid" data-tests="#pub-xml-external-id">does not read external DTD
						subsets [[xml]];</li>
					<li id="confreq-rs-xml-ns" data-tests="#pub-xml-names">conforms to [[xml-names]].</li>
				</ul>
			</section>

			<section id="sec-epub-rs-i18n">
				<h2>Internationalization</h2>

				<p> As part of processing [=publication resources=], a reading system has to process the attributes to
					set the language and the base directions in [=XHTML content documents=] or [=SVG content
					documents=], as well as the <a data-cite="xml#sec-lang-tag"><code>xml:lang</code> attribute</a> for
					all XML documents (e.g., the [=package document=] and [=media overlay documents=]). </p>

				<p id="confreq-rs-pkg-dir-intro"
					data-tests="#pkg-dir_creator-rtl,#pkg-dir_rtl-root-ltr,#pkg-dir_rtl-root-unset,#pkg-dir_unset-root-rtl,#pkg-dir_unset-root-unset,#pkg-dir-auto_root-rtl,#pkg-dir-auto_root-unset"
					>Furthermore, a reading system MUST also process the <a data-cite="epub-34#attrdef-dir"
							><code>dir</code></a> attribute [[epub-34]] for the [=package document=], where the base
					direction specified by <code>dir</code> applies to the element where it is specified, and to all
					elements in its content unless overridden with another instance of <code>dir</code>. (See also <a
						href="#sec-pkg-doc-base-dir"></a> for further details.)</p>

				<p id="confreq-rs-pkg-lang-no-content" data-tests="#pkg-lang_but_not_content,#pkg-dir_but_not_content"
					>In the absence of this information in a [=publication resource=], reading systems MUST NOT assume
					either the language or the base direction of that resource from information expressed in the package
					document (i.e., in <a data-cite="epub-34#attrdef-xml-lang"><code>xml:lang</code></a> and <a
						data-cite="epub-34#attrdef-dir"><code>dir</code></a> attributes, in <a
						data-cite="epub-34#attrdef-hreflang"><code>hreflang</code> attributes</a> on <span
						data-cite="epub-34">[^link^]</span> elements, or from [^dc:language^] elements [[epub-34]]).
					Refer to a resource's formal specification for more information about to handle the absence of
					explicit language or direction information.</p>
			</section>

			<section id="sec-epub-rs-network-access">
				<h3>Network access</h3>

				<p>Reading systems MAY support network access to <a href="#sec-epub-rs-conf-remote-res">retrieve remote
						resources</a> and to allow [=scripted content documents=] to <a
						href="#confreq-rs-scripted-limit">communicate with web-hosted APIs and retrieve
					resources</a>.</p>

				<p>Providing network access, however, increases both the security risks to the reading systems and the
					security and privacy risks to users. These risks are often unique to reading systems and the
					platforms they run on &#8212; the browser cores that most reading systems are built on do not offer
					the same security and privacy controls as web browsers themselves. Consequently, developers need to
					use extra caution when allowing network access, and more thoroughly test that their reading systems
					are not vulnerable to attacks. More information about these risks is provided in <a
						href="#sec-security-privacy"></a>.</p>

				<p>If reading system developers allow network access, it is RECOMMENDED both that they:</p>

				<ul>
					<li>notify users when network activity occurs; and</li>
					<li>let users block access to the network (e.g., disable network access for the reading system
						globally or for a particular EPUB publication).</li>
				</ul>
			</section>

			<section id="sec-epub-rs-external-links">
				<h3>External links</h3>

				<p>When a link has an <code>http</code> or <code>https</code>
					<a data-cite="url#concept-url-scheme">scheme</a> [[url]], reading systems:</p>

				<ul data-tests="#pub-external-links" id="sec-external-links-open">
					<li>SHOULD obtain the user's consent before opening the link.</li>
					<li>SHOULD open the link in a new browser instance to ensure that the browser's security and privacy
						controls are available to users.</li>
				</ul>

				<p id="sec-external-links-consent" data-tests="#pub-external-links_consent">For links that have schemes
					that require a helper application to load, reading systems SHOULD obtain the user's consent and
					follow platform guidance for opening the helper application.</p>

				<div class="note">
					<p>External links are not only found in [=EPUB content documents=]. A reading system might provide
						access to external <a data-cite="epub-34#sec-link-elem">linked records</a> [[epub-34]] in the
							<a>package document</a> metadata, for example.</p>
				</div>

				<div class="note">
					<p>For more information about security and privacy issues with external links, see <a
							href="#epub-threat-model"></a>.</p>
				</div>
			</section>
		</section>
		<section id="sec-ocf">
			<h2>Open Container Format (OCF) processing</h2>

			<p id="confreq-rs-epub3-ocf" class="support" data-tests="#ocf-package_arbitrary">[=Reading systems=] MUST
				process the <a data-cite="epub-34#sec-ocf">EPUB container</a> [[epub-34]].</p>

			<div class="note">
				<p>An application that processes EPUB containers does not have to be a full-fledged reading system
					(e.g., an application might only extract the content of a container or check the validity of the
					packaged content). In these cases, developers of such applications can ignore the rendering
					requirements for reading systems defined in this section.</p>
			</div>

			<section id="sec-container-abstract">
				<h3>OCF abstract container</h3>

				<section id="sec-container-iri">
					<h4>URL of the root directory</h4>

					<p id="sec-container-iri-root"
						data-tests="#ocf-url_manifest,#ocf-url_relative,#ocf-url_link-relative">Reading systems MUST
						assign a URL [[url]] to the [=root directory=] of the [=OCF abstract container=]. This URL is
						called the [=container root URL=]. It is implementation specific, but the implementation MUST
						have the following properties:</p>

					<ul>
						<li id="sec-container-iri-root-parse"
							data-tests="#ocf-url_link-path-absolute,#ocf-url_parse-path-absolute">The result of <a
								data-lt="url parser">parsing</a> [[url]] "<code>/</code>" with the <a>container root
								URL</a> as <a data-cite="url#concept-base-url"><var>base</var></a> is the <a>container
								root URL</a>.</li>
						<li id="sec-container-iri-step-parse"
							data-tests="#ocf-url_link-leaking-relative,#ocf-url_parse-leaking-relative">The result of <a
								data-lt="url parser">parsing</a> [[url]] "<code>..</code>" with the <a>container root
								URL</a> as <a data-cite="url#concept-base-url"><var>base</var></a> is the <a>container
								root URL</a>.</li>

						<li id="sec-container-iri-origin" data-tests="#ocf-url_origin">The <a data-cite="url#origin"
								>origin</a> [[url]] of the [=container root URL=] is unique for each user-specific
							instance of an [=EPUB publication=] in a reading system.</li>
					</ul>

					<p class="note">The unicity of the <a data-cite="html#origin">origin</a> [[html]] per each
						user-specific instance of an EPUB publication in a reading system means that if two different
						users acquire a copy of the same EPUB publication, the origins will be different for the two
						users on those copies even if the same reading system is used.</p>

					<div class="note">
						<p>The properties of the [=container root URL=] are such that a conforming reading system will
							parse any relative URL string to a [=content URL=]. In other words, relative links do not
							"leak" outside the container content, which is an important feature for security.</p>

						<p>In practice, the container root URL behaves similarly to a URL defined as follows:</p>

						<table class="zebra">
							<thead>
								<tr>
									<td style="font-weight: bold; text-align: center;">URL component</td>
									<td style="font-weight: bold; text-align: center;">Values</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>scheme</td>
									<td><code>http</code> or <code>https</code></td>
								</tr>
								<tr>
									<td>host</td>
									<td>
										<code>localhost</code>
									</td>
								</tr>
								<tr>
									<td>port</td>
									<td>a dynamic port uniquely assigned to the EPUB instance</td>
								</tr>
							</tbody>
						</table>

						<p>for example:</p>

						<table class="zebra">
							<thead>
								<tr>
									<td style="font-weight: bold; text-align: center;">Container File</td>
									<td style="font-weight: bold; text-align: center;">File Path</td>
									<td style="font-weight: bold; text-align: center;">URL</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>Root directory</td>
									<td>
										<var>empty string</var>
									</td>
									<td>
										<code>http://localhost:49152/</code>
									</td>
								</tr>
								<tr>
									<td>Package document</td>
									<td>
										<code>EPUB/package.opf</code>
									</td>
									<td>
										<code>http://localhost:49152/EPUB/package.opf</code>
									</td>
								</tr>
								<tr>
									<td>EPUB content document</td>
									<td>
										<code>HTML/file name.xhtml</code>
									</td>
									<td>
										<code>http://localhost:49152/HTML/file%20name.xhtml</code>
									</td>
								</tr>
							</tbody>
						</table>

						<table class="zebra">
							<thead>
								<tr>
									<td style="font-weight: bold; text-align: center;">URL string<br />(found for
										example in the package document)</td>
									<td style="font-weight: bold; text-align: center;">content URL</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<code>../HTML/file%20name.xhtml</code>
									</td>
									<td>
										<code>http://localhost:49152/HTML/file%20name.xhtml</code>
									</td>
								</tr>
								<tr>
									<td>
										<code>/Media/img.png</code>
									</td>
									<td>
										<code>http://localhost:49152/Media/img.png</code>
									</td>
								</tr>
								<tr>
									<td>
										<code>../../../Media/img.png</code>
									</td>
									<td>
										<code>http://localhost:49152/Media/img.png</code>
									</td>
								</tr>
							</tbody>
						</table>

						<p>Note that the last two links are <a data-cite="epub-34#urls-in-ocf-constraints"
								>disallowed</a> in an EPUB publications to ensure better interoperability with
							non-conforming or legacy reading systems and toolchains.</p>
					</div>

					<div class="note">
						<p>Some language specifications reference <a href="https://www.ietf.org/standards/rfcs/"
								>Requests For Comments</a> that preceded [[url]], in which case the earlier RFC applies
							for content in that particular language.</p>
					</div>

					<div class="note">
						<p>Unlike most language specifications, reading systems have to use the [=container root URL=]
							as the <a data-cite="url#concept-base-url">base URL</a> [[url]] for all files within the
								<code>META-INF</code> directory. See also the section on <a
								data-cite="epub-34#sec-parsing-urls-metainf">Parsing URLs in the <code>META-INF</code>
								directory</a> in [[!epub-34]].</p>
					</div>
				</section>

				<section id="sec-container-filenames">
					<h4>File names</h4>

					<p>Although [[epub-34]] defines <a data-cite="epub-34#sec-container-filenames">file name and file
							path restrictions</a> for maximum interoperability, reading systems SHOULD attempt to
						process file names and paths that do not adhere to these requirements. Invalid file names and
						paths might only be problematic on some operating systems.</p>

					<p>This specification does not specify how a reading system that is unable to represent OCF file
						names and paths would handle this incompatibility.</p>
				</section>

				<section id="sec-container-metainf">
					<h4><code>META-INF</code> directory</h4>

					<dl class="conformance-list">
						<dt id="sec-container-metainf-container.xml">Container file (<code>container.xml</code>)</dt>
						<dd>
							<p id="container-default-rendition"
								data-tests="#ocf-package_arbitrary,#ocf-package_multiple">A reading system MUST, by
								default, use the [=package document=] referenced the from first [^rootfile^] element
								[[epub-34]] to render the [=EPUB publication=]. If the reading system recognizes a means
								of selecting from the other available options, it MAY choose a more appropriate package
								document.</p>
						</dd>

						<dt id="sec-container-metainf-metadata.xml">Metadata file (<code>metadata.xml</code>)</dt>
						<dd>
							<p>Reading systems SHOULD ignore <a data-cite="epub-34#sec-container-metainf-metadata.xml"
										><code>metadata.xml</code> files</a> [[epub-34]] with unrecognized root
								elements.</p>
						</dd>

						<dt id="sec-container-metainf-manifest.xml" data-tests="#ocf-metainf-manifest">Manifest file
								(<code>manifest.xml</code>)</dt>
						<dd>
							<p>Reading systems MUST NOT use ancillary manifest information contained in the ZIP archive
								or in the <a data-cite="epub-34#sec-container-metainf-manifest.xml"
										><code>manifest.xml</code> file</a> [[epub-34]] for processing an [=EPUB
								publication=].</p>
						</dd>

						<dt id="sec-container-metainf-signatures.xml">Signature file (<code>signatures.xml</code>)</dt>
						<dd>
							<p>Before computing the digest used to validate the signature in the <a
									data-cite="epub-34#sec-container-metainf-signatures.xml"><code>signatures.xml</code>
									file</a> [[epub-34]], reading systems MUST decrypt any data encrypted after signing
								&#8212; data encrypted before signing MUST NOT be decrypted.</p>
							<p>Refer to Decryption Transform for XML Signature [[xmlenc-decrypt]] for more information
								about identifying data encrypted after signing.</p>
						</dd>

						<dt id="sec-container-metainf-inc" data-tests="#ocf-metainf-inc">Other files</dt>
						<dd>
							<p>Reading systems MUST NOT fail when encountering configuration files in the <code
									class="filename">META-INF</code> directory not listed in <a
									data-cite="epub-34#sec-container-metainf-files">Reserved files</a> [[epub-34]].</p>
						</dd>
					</dl>
				</section>
			</section>

			<section id="sec-container-zip">
				<h3>OCF ZIP container</h3>

				<p>A reading system:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-zip-mult" data-tests="#ocf-zip-mult">MUST treat any [=OCF ZIP container=] that
							splits the content into segments [[zip]] as in error.</p>
					</li>
					<li>
						<p id="confreq-zip-comp" data-tests="#ocf-zip-comp">MUST treat any OCF ZIP container that uses
							compression techniques other than Deflate [[rfc1951]] as in error.</p>
					</li>
					<li>
						<p id="confreq-zip-64">MUST support the ZIP64 extensions defined as "Version 1" [[zip]].</p>
					</li>
					<li>
						<p id="confreq-zip-enc">MUST treat an OCF ZIP container that uses [[zip]] encryption features as
							in error.</p>
					</li>
					<li>
						<p id="confreq-zip-rootdir">MAY generate a physical directory for the [=root directory=] of the
							[=OCF abstract container=] if it unzips the contents.</p>
					</li>
					<li>
						<p id="confreq-zip-preserve">does not have to preserve information from an OCF ZIP container
							through load and save operations outside the context of the OCF abstract container. In
							particular, a reading system does not have to preserve CRC values, comment fields or fields
							that hold file system information corresponding to a particular operating system (e.g., <em
								class="firstterm">External file attributes</em> and <em class="firstterm">Extra
								field</em>).</p>
					</li>
				</ul>

				<p>With respect to specific fields in the OCF ZIP container archive, the reading system:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-zip-fld-version">MUST treat <code>version needed to extract</code> field values
							other than <code>10</code>, <code>20</code> or <code>45</code> in the local file header
							table [[zip]] as being in error.</p>
					</li>
					<li>
						<p id="confreq-zip-fld-comp">MUST treat <code>compression</code> method field values other than
								<code>0</code> or <code>8</code> in the local file header table [[zip]] as being in
							error.</p>
					</li>
					<li>
						<p id="confreq-zip-fld-er">MUST treat OCF ZIP containers with an <code>Archive decryption
								header</code> or an <code>Archive extra data record</code> [[zip]] as being in
							error.</p>
					</li>
				</ul>
			</section>

			<section id="sec-container-fobfus">
				<h3>Font obfuscation</h3>

				<div class="caution">
					<p>NIST is advising that use of the SHA-1 algorithm [[fips-180-4]] be phased out by the end of 2030.
						The Publishing Maintenance Working Group does not intend to support font obfuscation in EPUB
						publications past that date due to its reliance on SHA-1 &#8212; the feature is now marked as
						outdated to not invalidate existing EPUB publications. Reading system developers will have to
						consider continuing to support deobfuscation to fully support all EPUB publications that have
						used the feature. As CSS provides font fallbacks, however, ending support will only affect the
						appearance of some text content.</p>
				</div>

				<p id="confreq-ocf-fobfus" data-tests="#ocf-font_obfuscation,#ocf-font_obfuscation-bis">Reading systems
					SHOULD support deobfuscation of fonts as defined in <a data-cite="epub-33#sec-font-obfuscation">Font
						obfuscation</a> [[epub-33]].</p>

				<p>To restore the original data, reading systems can simply reverse the process: the source file becomes
					the obfuscated data, and the destination file contains the raw data.</p>

				<div class="note">
					<p>EPUB 3 allowed font obfuscation prior to EPUB 3.0.1, but did not specify the order of obfuscation
						and compression. As a result, reading systems might encounter invalid fonts after decompression
						and deobfuscation. In such instances, deobfuscating the data before inflating it might return a
						valid font. Reading systems do not have to support this method of retrieval, but developers need
						to consider that it will likely be encountered if they support EPUB 3 content generally.</p>
				</div>
			</section>
		</section>
		<section id="sec-package-doc">
			<h2>Package document processing</h2>

			<p id="confreq-rs-epub-pub" class="support">[=Reading systems=] MUST process the <a
					data-cite="epub-34#sec-package-doc">package document</a> [[epub-34]].</p>

			<section id="sec-pkg-doc-base-dir">
				<h4>Base direction</h4>

				<p id="confreq-rs-pkg-dir"
					data-tests="#pkg-dir_creator-rtl,#pkg-dir_rtl-root-ltr,#pkg-dir_rtl-root-unset,#pkg-dir_unset-root-rtl,#pkg-dir_unset-root-unset,#pkg-dir-auto_root-rtl"
					>If the <a data-cite="epub-34#attrdef-dir"><code>dir</code> attribute</a> [[epub-34]] is set and
					indicates a base direction of <code>ltr</code> or <code>rtl</code>, reading systems MUST override
					the bidi algorithm per <a data-cite="bidi#Higher-Level_Protocols">the higher-level protocols</a>
					defined in [[bidi]], setting the paragraph embedding level to 0 if the base direction is
						<code>ltr</code>, or 1 if the base direction is <code>rtl</code>.</p>

				<p id="confreq-rs-pkg-dir-auto" data-tests="#pkg-dir-auto_root-rtl,#pkg-dir-auto_root-unset">Otherwise
					the base direction is <code>auto</code>, in which case reading systems MUST determine the text's
					direction by applying the Unicode Bidi Algorithm, beginning with <a data-cite="bidi#P2">Rule P2</a>
					of [[bidi]].</p>

				<div class="note">
					<p>Reading system with an international audience, or that claim support for international content,
						are strongly advised to implement this feature when exposing that metadata to users. Ignoring
						the directionality of text can cause readability issues.</p>
				</div>
			</section>

			<section id="sec-pkg-doc-pub-identifiers">
				<h3>Unique identifier</h3>

				<p id="confreq-rs-pkg-unique-id" data-tests="#pkg-unique-id">Reading systems SHOULD NOT depend on the
					[=unique identifier=] being unique to one and only one [=EPUB publication=]. Determining whether two
					EPUB publications with the same unique identifier represent different versions of the same
					publication, or different publications, could require inspecting other metadata, such as their last
					modification dates, titles, and authors.</p>
			</section>

			<section id="sec-pkg-doc-metadata">
				<h4>Metadata</h4>

				<dl class="conformance-list">
					<dt id="conf-meta-ws">Whitespace</dt>
					<dd>
						<p id="confreq-rs-pkg-whitespace" data-tests="#pkg-meta-whitespace">Reading systems MUST [=strip
							and collapse ASCII whitespace=] [[infra]] from Dublin Core [[dcterms]] and <span
								data-cite="epub-34">[^meta^]</span> element <a data-cite="epub-34#dfn-value">values</a>
							[[epub-34]] before processing.</p>
					</dd>

					<dt id="dc-identifier">The <code>dc:identifier</code> element</dt>
					<dd>
						<p>To determine whether the value of a [^dc:identifier^] element [[epub-34]] conforms to an
							established system or has been granted by an issuing authority, reading systems SHOULD check
							for an <a data-cite="epub-34#identifier-type"><code>identifier-type</code> property</a>
							[[epub-34]].</p>
					</dd>

					<dt id="dc-title">The <code>dc:title</code> element</dt>
					<dd>
						<p id="title-order" data-tests="#pkg-title-order">Reading systems MUST recognize the first
							[^dc:title^] element [[epub-34]] in document order as the main title of the [=EPUB
							publication=] and present it to users before other title elements.</p>
						<p>This specification does not define how to process additional <code>dc:title</code>
							elements.</p>
					</dd>

					<dt id="sec-opf-dclanguage">The <code>dc:language</code> element</dt>
					<dd>
						<p>The language(s) of the EPUB publication specified in [^dc:language^] elements are
							informational. Some uses of this information include:</p>
						<ul>
							<li>exposing it to the user through the reading system user interface</li>
							<li>using it to enhance functionality in a bookshelf (e.g., sorting by language)</li>
							<li>using it to optimize the reading interface (e.g., to preload text-to-speech
								languages)</li>
						</ul>
						<p>See <a href="#sec-epub-rs-i18n"></a> for more details on how to determine the language of a
							[=publication resource=].</p>
					</dd>

					<dt id="dc-creator">The <code>dc:creator</code> element</dt>
					<dd>
						<p id="confreq-rs-pkg-creator-order" data-tests="#pkg-creator-order">When determining display
							priority, reading systems MUST use the document order of [^dc:creator^] elements [[epub-34]]
							in the <code>metadata</code> section, where the first <code>creator</code> element
							encountered is the primary creator. If a reading system exposes creator metadata to the
							user, it SHOULD include all the creators listed in the <code>metadata</code> section
							whenever possible (e.g., when not constrained by display considerations).</p>
					</dd>

					<dt id="meta">The <code>meta</code> element</dt>
					<dd>
						<p data-cite="epub-34">Reading systems SHOULD ignore all [^meta^] elements whose <a
								data-cite="epub-34#attrdef-meta-property"><code>property</code> attributes</a>
							[[epub-34]] define expressions they do not recognize. <span id="confreq-rs-pkg-meta-unknown"
								data-tests="#pkg-meta-unknown">A reading system MUST NOT fail when encountering unknown
								expressions.</span></p>
						<p>If a reading system does not recognize the <a data-cite="epub-34#attrdef-scheme"
									><code>scheme</code> attribute</a> [[epub-34]] value, it SHOULD treat the value of
							the element as a string.</p>
					</dd>

					<dt id="conf-metadata-link">The <code>link</code> element</dt>
					<dd>
						<p>Retrieval and support of [=linked resources=] is OPTIONAL.</p>
						<p id="confreq-rs-pkg-hreflang">The language identified in an <a
								data-cite="epub-34#attrdef-hreflang"><code>hreflang</code></a> [[EPUB-34]] attribute is
							purely advisory. The language information expressed in the resource determines its language
							for processing and rendering purposes, as defined in the <a
								href="#confreq-rs-pkg-lang-no-content">internationalization requirements</a>.</p>
					</dd>
				</dl>
			</section>

			<section id="sec-pkg-doc-manifest">
				<h3>Manifest</h3>

				<p id="confreq-rs-pkg-manifest-unknown" data-tests="#pkg-manifest-unknown">Reading systems MUST ignore
					values of the <a data-cite="epub-34#sec-item-resource-properties"><code>properties</code>
						attribute</a> [[epub-34]] they do not recognize.</p>

				<p id="confreq-rendition-rs-manifest" data-tests="#pkg-manifest-unlisted-resource">Reading systems
					SHOULD NOT use [=linked resources=] in the rendering of an [=EPUB publication=] due to the inherent
					limitations and risks involved (e.g., lack of information about the resource and how to process it,
					security risks from remotely-hosted sources, lack of fallbacks, etc.).</p>

				<p>
					<span id="confreq-rs-pkg-manifest-fallback">A reading system that does not support the MIME media
						type [[rfc2046]] of a given [=publication resource=] MUST traverse the <a
							data-cite="epub-34#sec-manifest-fallbacks">manifest fallback chain</a> [[epub-34]] until it
						identifies a supported publication resource to use in place of the unsupported resource. </span>
					<span id="confreq-rs-pkg-manifest-fallback-order">If the reading system supports multiple
						publication resources in the fallback chain, it MAY select the resource to use based on the
						resource's <a data-cite="epub-34#attrdef-item-properties"><code>properties</code> attribute</a>
						[[epub-34]] values, otherwise it SHOULD honor the <a
							data-cite="epub-34#preferred-fallback-chain">preferred fallback order</a>
						[[epub-34]].</span>
					<span id="confreq-rs-pkg-manifest-fallback-fail">If a reading system does not support any resource
						in the fallback chain, it MUST alert the user that it could not display the content. </span>
				</p>

				<p>When <a data-cite="epub-34#sec-manifest-fallbacks">manifest fallbacks</a> [[epub-34]] are provided
					for [=top-level content documents=], reading systems MAY choose from the available options to find
					the optimal version to render in a given context (e.g., by inspecting the properties attribute for
					each).</p>

				<p id="confreq-rs-pkg-manifest-fallback-cycle">A reading system MUST terminate the fallback chain at the
					first reference to a manifest item it has already encountered.</p>
			</section>

			<section id="sec-pkg-doc-spine">
				<h3>Spine</h3>

				<p id="confreq-rs-spine-order" data-tests="#pkg-spine-order">Reading systems MUST provide a means of
					rendering an [=EPUB publication=] in the order defined in the [^spine^] element [[epub-34]], which
					includes:</p>
				<ul>
					<li>recognizing the first <a data-cite="epub-34#attrdef-itemref-linear">primary (linear)
								<code>itemref</code></a> [[epub-34]] as the beginning of the default reading order;
						and,</li>
					<li>rendering successive primary items in the order given in the <code>spine</code>.</li>
				</ul>

				<p id="confreq-rendition-rs-spine-nonlinear">When a user traverses the default reading order defined in
					the <code>spine</code> element, a reading system MAY automatically skip <a
						data-cite="epub-34#attrdef-itemref-linear">non-linear <code>itemref</code> elements</a>
					[[epub-34]]. <span id="confreq-rs-spine-nonlinear-activation"
						data-tests="#pkg-spine-nonlinear-activation">When a user activates a hyperlink to a non-linear
						resource, however, reading systems MUST render the referenced resource or a designated
						fallback.</span> Reading systems MAY also provide the option for users to skip non-linear
					content by default or not.</p>

				<p id="confreq-rs-spine-progression-default" data-tests="#pkg-spine-progression-default">If the <a
						data-cite="epub-34#attrdef-spine-page-progression-direction"
							><code>page-progression-direction</code> attribute</a> [[epub-34]] is not set, the reading
					system MUST assume the value of <code>default</code>. When <code>page-progression-direction</code>
					value is <code>default</code>, the reading system can choose the rendering direction.</p>

				<p id="confreq-rs-spine-progression-pre-paginated" data-tests="#pkg-spine-progression-pre-paginated">If
					the <code>page-progression-direction</code> attribute has a value other than <code>default</code>,
					the reading system MUST ignore any directionality computed from <a href="#sec-pre-paginated-layouts"
							><code>pre-paginated</code></a> [=XHTML content documents=].</p>

				<p id="confreq-rs-pkg-spine-unknown" data-tests="#pkg-spine-unknown">Reading systems MUST ignore all
					values expressed in spine <code>itemref</code>
					<a data-cite="epub-34#attrdef-properties"><code>properties</code> attributes</a> [[EPUB-34]] that
					they do not recognize.</p>

				<p>
					<span id="confreq-rs-pkg-duplicate-item-rendering" data-tests="#pkg-spine-duplicate-item-rendering">
						Reading systems MUST NOT skip spine references to duplicate <a data-cite="epub-34#sec-item-elem"
							>manifest items</a> [[EPUB-34]] when rendering the linear reading order.</span>
					<span id="confreq-rs-pkg-duplicate-item-ui" data-tests="#pkg-spine-duplicate-item-ui">The reading
						system MUST treat these as distinct items for user interface (UI) purposes (for example, each
						occurrence could be independently bookmarked or annotated).</span>
					<span id="confreq-rs-pkg-duplicate-item-hyperlink" data-tests="#pkg-spine-duplicate-item-hyperlink"
						>When a reading system follows a hyperlink to a resource referenced multiple times in the spine,
						the reading system MUST navigate to the first occurrence of the document in the linear reading
						order.</span>
				</p>

				<section id="spine-overrides">
					<h4>Spine overrides</h4>

					<p id="confreq-rs-pkg-spine-override"
						data-tests="#fxl-spine-overrides_behave-as-global,#fxl-spine-overrides_behave-as-global-bis"
						>When a [=spine=] [^itemref^] element's <a data-cite="epub-34#attrdef-properties"
								><code>properties</code> attribute</a> overrides a <a
							data-cite="epub-34#app-rendering-vocab">global rendering property</a> [[epub-34]], reading
						systems MUST follow the requirements for the override's global value to display that spine
						item.</p>

					<p>For example, a spine item that contains the <a data-cite="epub-34#layout-overrides"
								><code>layout-pre-paginated</code> override</a> [[epub-34]] is rendered following the
						requirements of the global <a href="#def-layout-pre-paginated"><code>pre-paginated</code>
							value</a>.</p>

					<p id="confreq-rs-pkg-spine-override-first" data-tests="#fxl-spine-overrides_behave-as-global">If
						more than one override for the same property is specified in a <code>properties</code>
						attribute, reading systems MUST use only the first value.</p>
				</section>
			</section>

			<section id="sec-pkg-doc-collections">
				<h3>Collections</h3>

				<p>In the context of this specification, support for <a data-cite="epub-34#sec-collection-elem"
						>collections</a> [[epub-34]] in reading systems is OPTIONAL. <span
						id="confreq-rs-pkg-collections-unknown" data-tests="#pkg-collections-unknown">Reading systems
						MUST ignore <code>collection</code> elements that define unrecognized roles.</span></p>
			</section>

			<section id="sec-pkg-doc-legacy">
				<h3>Legacy features</h3>

				<p id="confreq-rs-legacy">Reading systems MUST NOT support <a data-cite="epub-34#sec-pkg-legacy">legacy
						features</a> in content that conforms to <a data-cite="epub-34#attrdef-package-version">this
						version of EPUB</a> [[epub-34]].</p>
			</section>
		</section>
		<section id="sec-layouts">
			<h2>Layout processing</h2>

			<section id="sec-layout-types">
				<h3>Layout types</h3>

				<section id="sec-reflowable-layouts">
					<h4>Reflowable layouts</h4>

					<p class="support">Reading systems MUST support reflowable layouts.</p>

					<p id="layout-default" data-cite="epub-34" data-tests="#lay-fxl-layout-default"> The default value
							<code>reflowable</code> MUST be assumed by EPUB reading systems as the global value if no
						[^meta^] element carrying the <a data-cite="epub-34#layout"><code>rendition:layout</code>
							property</a> occurs in the <a data-cite="epub-34#elemdef-opf-metadata">package document
							metadata</a> [[epub-34]].</p>

					<p>Reading systems MAY apply dynamic pagination when rendering reflowable [=EPUB content
						documents=].</p>
				</section>

				<section id="sec-fixed-layouts">
					<h4>Fixed layouts</h4>

					<section id="sec-pre-paginated-layouts" data-tests="#lay-fxl-layout-pre-paginated">
						<h5>Pre-paginated layouts</h5>

						<p class="support">[=Reading systems=] MUST support pre-paginated layouts.</p>

						<p id="def-layout-pre-paginated" data-tests="#lay-fxl-layout-pre-paginated">Reading systems MUST
							produce exactly one page per spine [^itemref^] [[epub-34]] when rendering.</p>

						<p>The default expectation for rendering pre-paginated layouts is that the [=content display
							area=] SHOULD occupy as much of the available [=viewport=] area as possible. Reading systems
							SHOULD NOT inject additional content such as border, margins, headers, or footers into the
							viewport.</p>

						<p id="layout-pre-paginated" data-tests="#lay-fxl-layout-pre-paginated-spreads">When rendering
							[=synthetic spreads=], reading systems MUST NOT include space between the adjacent content
							slots.</p>

						<div class="note">
							<p>This specification does not define how the <a
									href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">initial
									containing block</a> [[css2]] is placed within the reading system <a>content display
									area</a>.</p>
						</div>

						<div class="note">
							<p>The exposure of reading system control widgets to the user is implementation-specific and
								not included in the above behavioral expectations.</p>
						</div>

						<section id="sec-synthetic-spreads">
							<h5>Synthetic spread placement</h5>

							<p>The spread placement spine overrides are interpreted as follows:</p>

							<ul>
								<li>
									<p>
										<span id="page-spread-left" data-tests="#lay-fxl-page-spread-left">When either
											the <a data-cite="epub-34#rendition-page-spread-left"
													><code>rendition:page-spread-left</code> property</a> or <a
												data-cite="epub-34#page-spread-left"><code>page-spread-left</code>
												property</a> [[epub-34]] is specified, it indicates that the given spine
											item SHOULD be rendered in the left-hand slot of a spread.</span>
									</p>
								</li>
								<li>
									<p>
										<span id="page-spread-right" data-tests="#lay-fxl-page-spread-right">When either
											the <a data-cite="epub-34#rendition-page-spread-right"
													><code>rendition:page-spread-right</code> property</a> or <a
												data-cite="epub-34#page-spread-right"><code>page-spread-right</code>
												property</a> [[epub-34]] is specified, it indicates that the given spine
											item SHOULD be rendered in the right-hand slot of a spread.</span>
								</li>
								<li>
									<p>
										<span id="page-spread-center">When the <a
												data-cite="epub-34#rendition-page-spread-center"
													><code>rendition:page-spread-center</code> property</a> [[epub-34]]
											is specified, it indicates that synthetic spreads SHOULD be disabled and the
											spine item SHOULD be rendered centered in the viewport.</span>
									</p>
								</li>
							</ul>

							<p>The <code>rendition:page-spread-left</code>, <code>rendition:page-spread-right</code>,
									<code>rendition:page-spread-center</code> properties (and their unprefixed
								equivalents) apply only to pre-paginated content, and only when the reading system is
								creating [=synthetic spreads=].</p>

							<p id="page-break-precedence" data-tests="#lay-rendition-flow-pre-pag">The
									<code>rendition:page-spread-*</code> properties and their unprefixed equivalents
								MUST take precedence over whatever value of the <a
									href="https://www.w3.org/TR/CSS2/page.html#propdef-page-break-before"
										><code>page-break-before</code> property</a> [[csssnapshot]] has been set for an
								[=XHTML content document=].</p>

							<p id="fxl-page-spread-combined" data-tests="#lay-fxl-page-spread-combined">When a reading
								system encounters two spine items that represent a true spread (i.e., two adjacent spine
								items with the <code>rendition:page-spread-left</code> and
									<code>rendition:page-spread-right</code> properties), it SHOULD create the spread
								with no space between the adjacent pages.</p>

							<p>If the first <a data-cite="epub-34#dfn-itemref"><code>itemref</code> element</a>
								[[epub-34]] in the spine does not specify a spread placement position, it SHOULD either
								be presented by itself (i.e., as though the <code>rendition:page-spread-center</code>
								property has been set) or placed alone in one of the two available spread slots (i.e.,
								with the other slot empty). Which slot to use SHOULD be obtained from the <a
									data-cite="epub-34#attrdef-spine-page-progression-direction"
										><code>page-progression-direction</code> attribute</a> [[epub-34]] value. For
								example, in an EPUB publication with a left-to-right page progression direction, the
								left-hand slot will be unpopulated.</p>

							<div class="note">
								<p>If a reading system does not render <a data-cite="epub-34#attrdef-itemref-linear"
										>non-linear</a> [[epub-34]] content by default, the first spine item to place on
									its own becomes the first linear item in the spine.</p>
							</div>
						</section>
					</section>

					<section id="sec-roll-layouts">
						<h5>Roll layouts</h5>

						<p class="support">[=Reading systems=] SHOULD support the rendering of roll layouts.</p>

						<p>For <a data-cite="epub-34#layout-roll">roll layouts</a> [[epub-34]], reading systems MUST fit
							the width of each [=EPUB spine | spine=] [^itemref^] to the viewport and display them in a
							continuous roll with no visible gap.</p>

						<p>Reading systems MUST ignore any <a data-cite="epub-34#layout-overrides">layout overrides</a>
							[[epub-34]] when an EPUB publication specifies to use a roll layout.</p>

						<div class="note">
							<p>Prior to the introduction of roll layouts, some Japanese publishers combined a <a
									href="#sec-pre-paginated-layouts">pre-paginated layout</a> with a <a
									data-cite="epub-33#flow"><code>rendition:flow</code> property</a> [[epub-33]] set to
								the value "<code>scrolled-continuous</code>" to create rolls. If reading systems
								developers intend to support this content, they will need to treat the combination as
								synonymous with a roll layout being declared.</p>
						</div>
					</section>
				</section>
			</section>

			<section id="sec-custom-properties">
				<h3>Custom properties</h3>

				<p>[=Reading systems=] MAY support custom properties provided they do not introduce expressions that
					conflict behaviorally with the properties defined in the <a data-cite="epub-34#app-rendering-vocab"
						>Package rendering vocabulary</a> [[epub-34]].</p>
			</section>
		</section>
		<section id="sec-contentdocs">
			<h2>EPUB content document processing</h2>

			<p>The definition of <a data-cite="epub-34#sec-contentdocs">EPUB content documents</a> [[epub-34]] includes
				various authoring restrictions to optimize the cross-compatibility of content (e.g., <a
					data-cite="epub-34#sec-css-req">prohibiting CSS for setting language and direction</a>
				[[?epub-34]]). Unless stated otherwise in this specification, reading systems MAY support these
				restricted features.</p>

			<section id="sec-xhtml">
				<h3>XHTML content documents</h3>

				<p id="confreq-rs-epub3-xhtml" class="support" data-tests="#cnt-xhtml-support">[=Reading systems=] MUST
					process <a data-cite="epub-34#sec-xhtml">XHTML content documents</a> [[epub-34]].</p>

				<p id="confreq-html-rs-behavior">Unless explicitly defined in this section as overridden, reading
					systems MUST process XHTML content documents using semantics defined by the [[html]] specification
					and honor any applicable user agent conformance constraints expressed therein.</p>

				<section id="sec-xhtml-extensions">
					<h4>HTML extensions</h4>

					<section id="sec-xhtml-rdfa">
						<h5>RDFa</h5>

						<p>Reading system support for the <a data-cite="rdfa-core#s_model">attribute processing
								model</a> [[rdfa-core]] is OPTIONAL.</p>
					</section>

					<section id="sec-xhtml-its">
						<h5>Internationalization Tag Set (ITS)</h5>

						<p>Reading system support for <a data-cite="its20#conformance-product-html5-its">processing ITS
								markup</a> [[its20]] is OPTIONAL.</p>
					</section>

					<section id="sec-xhtml-custom-attributes">
						<h5>Custom attributes</h5>

						<p>Reading systems MAY support custom attributes provided the attributes do not modify the
							requirements of this specification.</p>
					</section>
				</section>

				<section id="sec-xhtml-deviations">
					<h4>HTML deviations and constraints</h4>

					<section id="sec-xhtml-microdata">
						<h5>Microdata</h5>

						<p>Reading system support for the <a data-cite="html#encoding-microdata">attribute processing
								model</a> is OPTIONAL, as is the <a data-cite="html#json">conversion to JSON</a>
							[[html]].</p>
					</section>

					<section id="sec-xhtml-mathml">
						<h3>MathML</h3>

						<p>To support MathML [[mathml3]] embedded in [=XHTML content documents=], a reading system:</p>

						<ul class="conformance-list">
							<li>
								<p id="confreq-mathml-rs-behavior" data-tests="#cnt-mathml-support">MUST be an <a
										data-cite="mathml3/chapter2.html#fund.mathmlconf">input-compliant processor</a>
									for <a data-cite="mathml3/chapter3.html#">Presentation MathML</a>, as defined in the
									[[mathml3]] specification.</p>
							</li>
							<li>
								<p id="confreq-mathml-rs-render" data-tests="#cnt-mathml-support">MUST, if it has a
									[=viewport=], support visual rendering of Presentation MathML.</p>
							</li>
							<li>
								<p id="confreq-mathml-rs-anno">MAY support rendering of <a
										data-cite="mathml3/chapter4.html#">Content MathML</a> found in <a
										data-cite="mathml3/chapter5.html#mixing.elements.annotation.xml"
											><code>annotation-xml</code> elements</a> [[mathml3]].</p>
							</li>
						</ul>

						<p class="note">Reading systems can opt for third-party libraries such as <a
								href="https://www.mathjax.org/">MathJax</a> to provide MathML rendering.</p>
					</section>

					<section id="sec-xhtml-svg">
						<h5>Embedded SVG</h5>

						<p id="confreq-svg-rs-embed" data-tests="#cnt-svg-embedded">Reading systems MUST process SVG
							embedded in [=XHTML content documents=] as defined in <a href="#sec-svg"></a>.</p>

						<section id="sec-xhtml-svg-css">
							<h6>Embedded SVG and CSS</h6>

							<p id="confreq-svg-rs-css-embed-ref" data-tests="#cnt-svg-css-reference">For the purposes of
								styling SVG embedded in [=XHTML content documents=] <em>by reference</em>, reading
								systems MUST NOT apply CSS style rules of the containing document to the referenced SVG
								document.</p>

							<p id="confreq-svg-rs-css-embed-inc" data-tests="#cnt-svg-css-inclusion">For the purposes of
								styling SVG embedded in XHTML content documents <em>by inclusion</em>, reading systems
								MUST apply applicable CSS rules of the containing document to the included SVG
								elements.</p>

							<div class="note">
								<p>SVG included <em>by reference</em> is processed as a separate document, and can
									include its own CSS style rules just like an [=SVG content document=] would. Note
									that this is consistent with situations where an [[html]] <a data-lt="object"
											><code>object</code> element</a> references an external [[html]]
									element.</p>
							</div>
						</section>
					</section>

					<section id="sec-xhtml-forms">
						<h5>Form submission</h5>

						<p>Reading system support for the submission of [[html]] [^form^] elements is OPTIONAL. A
							reading system might, for example, prevent form submissions by limiting access to
							networking.</p>
					</section>
				</section>
			</section>

			<section id="sec-svg">
				<h3>SVG content documents</h3>

				<p id="confreq-rs-epub3-svg" class="support" data-tests="#cnt-svg-support">[=Reading systems=] MUST
					process <a data-cite="epub-34#sec-svg">SVG content documents</a> [[epub-34]].</p>

				<p>To process SVG content documents and <a href="#sec-xhtml-svg">SVG embedded in XHTML content
						documents</a>, a reading system:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-svg-rs-behavior" data-tests="#cnt-svg-support">MUST process SVG content documents
							using semantics defined by the [[svg]] specification, and honor any applicable user agent
							conformance constraints expressed therein, unless explicitly defined by this specification
							as overridden.</p>
					</li>
					<li>
						<p id="confreq-svg-rs-script" data-tests="#scr-readingsystem-support_svg">MUST meet the
							conformance criteria defined in <a href="#sec-scripted-content"></a>.</p>
					</li>
					<li>
						<p>
							<span id="confreq-svg-rs-css" data-tests="#cnt-svg-css">MUST, if it has a [=viewport=],
								support the visual rendering of SVG using CSS as defined in <a
									href="https://www.w3.org/TR/SVG/styling.html#">Styling</a> [[svg]] </span>
							<span id="confreq-svg-rs-css-properties">and it SHOULD support all properties defined in the
									<a href="https://www.w3.org/TR/SVG/propidx.html#">Property Index</a> [[svg]]. </span>
							<span id="confreq-svg-rs-css-embedded"
								data-tests="#cnt-svg-css-inclusion,#cnt-svg-css-reference"> In the case of embedded SVG,
								a reading system MUST also conform to the constraints defined in <a
									href="#sec-xhtml-svg-css"></a>.</span>
						</p>
					</li>
				</ul>
			</section>

			<section id="sec-fxl">
				<h3>Fixed-layout documents</h3>

				<p id="confreq-rs-epub3-fxl" data-tests="#lay-fxl-spread-none" class="support">[=Reading systems=] MUST
					support the rendering of EPUB content documents in [=spine=] items whose layout is designated as <a
						href="#sec-pre-paginated-layouts"><code>pre-paginated</code></a> or <a href="#sec-roll-layouts"
							><code>roll</code></a>. They MAY support the rendering of image [=foreign resources=] in
					spine items whose layout is designated as <code>pre-paginated.</code> or <code>roll</code>.</p>

				<div class="note">
					<p>This requirement does not require reading systems to support roll layouts. Only if the layout is
						supported do reading systems have to support the rendering of fixed-layout EPUB content
						documents.</p>
				</div>

				<section id="sec-fxl-dimensions">
					<h4>Initial containing block dimensions</h4>

					<dl>
						<dt>XHTML</dt>
						<dd>
							<p>
								<span id="confreq-fxl-rs-xhtml-icb-def">Reading systems MUST create the initial
									containing block (ICB) using the width and height expressions declared in the
										<code>viewport meta</code> tag for [=XHTML content documents=], as defined in <a
										data-cite="epub-34#sec-fxl-icb-html">Expressing in HTML</a> [[epub-34]].</span>
								<span id="confreq-fxl-rs-xhtml-icb"
									data-tests="#lay-fxl-xhtml-icb,#lay-fxl-xhtml-icb_multi">They MUST clip content
									positioned outside of the ICB.</span>
							</p>
							<p id="confreq-fxl-rs-xhtml-icb-units" data-tests="#lay-fxl-xhtml-icb_units">If the width or
								height values in the <code>viewport meta</code> tag contain a non-numeric character but
								start with a number (e.g., the value includes a unit of length declaration such as
								"500px"), the number prefix SHOULD be used as the pixel value, otherwise the value MUST
								be treated as invalid.</p>
							<p id="confreq-fxl-rs-xhtml-icb_invalid_meta" data-tests="#lay-fxl-xhtml-icb_invalid_meta">
								Reading systems SHOULD attempt to extract <code>width</code> and <code>height</code>
								values from a <code>viewport meta</code> tag even if its syntax is invalid. </p>
							<p id="confreq-fxl-rs-xhtml-icb_repeated-in-meta"
								data-tests="#lay-fxl-xhtml-icb_repeated-in-meta"> Reading systems MUST use the first
								declaration of a <code>width</code> and <code>height</code> property in a <code>viewport
									meta</code> tag (i.e., ignore repeated declarations). </p>
							<p> If the <code>viewport meta</code> does not contain a width or a height value, or if
								these values are invalid, reading systems MAY supply the values. For example, a reading
								system might:</p>
							<ul>
								<li>consider these as having the values <code>device-width</code> and
										<code>device-height</code>, respectively; or</li>
								<li>look for the previous content document in the [=spine=], if applicable, and use the
									ICB value defined there; or</li>
								<li>consider the content document as erroneous XHTML content altogether.</li>
							</ul>
							<p id="confreq-fxl-rs-xhtml-multiple-icb-def"
								data-tests="#lay-fxl-xhtml-icb_multi_declarations">If an XHTML content document contains
								more than one <code>viewport meta</code> tags, reading systems MUST use the first in
								document order to obtain the height and width dimensions. Subsequent declarations MUST
								be ignored.</p>
							<p id="confreq-fxl-rs-xhtml-icb-ratio">When the ICB aspect ratio does not match the aspect
								ratio of the reading system [=content display area=], reading systems MAY position the
								ICB inside the area to accommodate the user interface; in other words, added
								letter-boxing space MAY appear on either side (or both) of the content.</p>
						</dd>

						<dt>SVG</dt>
						<dd>
							<p id="confreq-fxl-rs-svg" data-tests="#lay-fxl-svg-icb_multi">Reading systems MUST create
								the initial containing block (ICB) using the dimensions as defined in <a
									data-cite="epub-34#sec-fxl-icb-svg">Expressing the ICB in SVG</a> [[epub-34]] to
								render [=SVG content documents=]. </p>
							<p id="confreq-fxl-rs-svg-icb-ratio" class="note"> When the ICB aspect ratio does not match
								the aspect ratio of the reading system [=content display area=], it is advised to follow
								the rules for the <a href="https://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute"
										><code>viewBox</code></a> and the <a
									href="https://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute"
										><code>preserveAspectRatio</code></a> attributes, as defined in [[SVG]]. </p>
						</dd>

						<dt>Image foreign resources</dt>
						<dd>
							<p>If a reading system supports image [=foreign resources=] in the spine, it will have to
								create the initial containing block using the dimensions as defined in the width and
								height metadata for the images. Refer to the documentation for each supported image
								format for more information on how to obtain this metadata.</p>
						</dd>
					</dl>
				</section>

				<section id="sec-viewport-meta">
					<h3>The <code>viewport meta</code> tag</h3>

					<p id="viewport-meta-prop" data-tests="#lay-viewport-meta-prop">Except when obtaining the initial
						containing block dimensions for XHTML [=fixed-layout documents=], reading systems MUST ignore
						rendering instructions in <a data-cite="epub-34#app-viewport-meta"><code>viewport meta</code>
							declarations</a>.</p>

					<p>This restriction applies to both fixed-layout and reflowable [=XHTML content documents=].</p>
				</section>
			</section>

			<section id="sec-css">
				<h3>Cascading Style Sheets (CSS)</h3>

				<p id="confreq-rs-epub3-css" class="support">If a reading system has a [=viewport=], it MUST support the
						<a data-cite="epub-34#sec-css">visual rendering of XHTML content documents via CSS</a>
					[[epub-34]].</p>

				<p>To support CSS, a reading system:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-css-rs-support">MUST support the official definition of CSS as described in the
							[[csssnapshot]].</p>
					</li>
					<li>
						<p id="confreq-css-rs-modules">SHOULD support all applicable modules in [[csssnapshot]] that
							have reached at least <a href="https://www.w3.org/Consortium/Process/#RecsCR">Candidate
								Recommendation</a> status [[w3cprocess]] (and are widely implemented).</p>
					</li>
					<li>
						<p id="confreq-css-rs-fonts"
							data-tests="#cnt-css-fonts_ot, #cnt-css-fonts_tt, #cnt-css-fonts_woff, #cnt-css-fonts_woff2"
							>MUST support [[truetype]], [[opentype]], [[woff]], and [[woff2]] font resources referenced
							from <a data-cite="css-fonts-4#font-face-rule"><code>@font-face</code> rules</a>
							[[css-fonts-4]].</p>
					</li>
					<li>
						<p id="confreq-css-rs-prefixed"
							data-tests="#css-epub-hyphens, #css-epub-line-break, #css-epub-text-align-last, #css-epub-text-combine-horizontal, #css-epub-text-emphasis, #css-epub-text-orientation, #css-epub-text-transform, #css-epub-text-underline-position, #css-epub-word-break, #css-epub-writing-mode"
							>SHOULD support all prefixed properties defined in <a data-cite="epub-33#sec-css-prefixed"
								>CSS Style Sheets — Prefixed properties</a> [[epub-33]].</p>
					</li>
					<li>
						<p id="confreq-css-creator-styles">SHOULD apply style sheets referenced from [=EPUB content
							documents=] as written.</p>
					</li>
					<li>
						<p id="confreq-css-rs-html-default">SHOULD support the [[html]] <a data-cite="html#rendering"
								>suggested default rendering</a> in their user agent style sheet(s).</p>
					</li>
				</ul>

				<div class="note">
					<p>Reading system developers are expected to publicly document their user agent style sheet(s) and
						how they interact with the styling set in EPUB publications.</p>
				</div>

				<section id="sec-css-overrides">
					<h4>Author styling overrides</h4>

					<p id="confreq-css-overrides">A reading system MAY override parts of an [=EPUB publication|EPUB
						publication's] styling (e.g., for ergonomic or user interface reasons). Morevoer, they MAY allow
						users to set default themes and style preferences (e.g., for more accessible reading) that
						further alter the original design of a publication.</p>

					<!-- <p id="confreq-css-user-styles">These changes often make it impractical to render an EPUB
						publication exactly as designed by an author, even if that is what the user wants. To assist
						users in viewing an EPUB publication as closely as possible to the author intent, however,
						reading systems MAY provide an affordance that reverts as much reading system-applied styling as
						feasible.</p> -->
				</section>
			</section>

			<section id="sec-scripted-content">
				<h3>Scripting</h3>

				<p id="confreq-rs-scripted" class="support"
					data-test="#scr-support,#scr-support_iframe,#scr-support_svg">[=Reading systems=] SHOULD support <a
						data-cite="epub-34#sec-scripted-content">scripting</a> [[epub-34]].</p>

				<p>Reading system support for scripting depends on its usage context:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-rs-scripted-reflow-support">Reading systems SHOULD support <a
								data-cite="epub-34#sec-scripted-container-constrained">container-constrained
								scripting</a> [[epub-34]] in reflowable [=EPUB content documents=].</p>
					</li>
					<li>
						<p id="confreq-rs-scripted-fxl-support">Reading systems SHOULD support <a
								data-cite="epub-34#sec-scripted-spine">spine-level scripting</a> [[epub-34]] in XHTML
							and SVG <a data-cite="epub-34#sec-fixed-layouts">fixed-layout documents</a> [[epub-34]].</p>
					</li>
					<li>
						<p id="confreq-rs-scripted-scrolled">Reading systems SHOULD support spine-level scripting in
							reflowable EPUBs where content is rendered with scrollable overflow. <span
								id="confreq-rs-scripted-flow-scrolled"
								data-tests="#scr-support_scrolled-doc,#scr-support_scrolled-continuous">Similarly, if a
								reading system supports spine-level scripting in reflowable EPUBs, it MUST give users
								the option to scroll overflow content and SHOULD provide the option to view the
								publication as one continuous scroll from spine item to spine item.</span></p>
					</li>
					<li>
						<p id="confreq-rs-scripted-optional-support">Reading systems MAY support scripting in other
							contexts, but this specification does not address such scripting. As a result, the use of
							scripting in these contexts might not be consistent across reading systems.</p>
					</li>
				</ul>

				<p>If a reading system supports scripting:</p>

				<ul class="conformance-list">
					<li>
						<p id="confreq-rs-scripted-ua">It MAY render [=scripted content documents=] as an interactive,
							scripted user agent according to [[html]].</p>
					</li>

					<li>
						<p id="confreq-rs-scripted-origin">
							<span id="confreq-rs-scripted-origin-shared"
								data-tests="#scr-support_origin,#scr-support_origin_unique">It MUST assign a unique <a
									data-cite="html#origin">origin</a> [[html]], shared by all <a
									data-cite="epub-34#sec-scripted-spine">spine-level scripts</a> of the [=EPUB
								publication=].</span>
							<span id="confreq-rs-scripted-origin-user" data-tests="#ocf-url_origin">That <a
									data-cite="html#origin">origin</a> [[html]] MUST be <em>unique</em> for each
								user-specific instance of an EPUB publication in a reading system.</span>
						</p>
					</li>

					<li>
						<p id="confreq-rs-scripted-container">
							<span id="confreq-rs-scripted-container-dom"
								data-tests="#scr-not-support_ccscript-modify-host"> It MUST NOT allow a
								container-constrained script to modify the [[dom]] of the host EPUB content document or
								other contents in the EPUB publication </span> and <span
								id="confreq-rs-scripted-container-size"
								data-tests="#scr-not-support_ccscript-modify-size"> MUST NOT allow it to manipulate the
								size of its containing rectangle </span>. (Note: Even if a script is not
							container-constrained, a reading system might impose restrictions on modifications. See the
								<a href="#feature-dom-manipulation">dom-manipulation feature</a>.)</p>
					</li>
					<li>
						<p id="confreq-rs-scripted-limit">It MAY place additional limitations on the capabilities
							provided to scripts during execution (e.g., limiting networking).</p>
					</li>
					<li>
						<p id="confreq-rs-scripted-readingsystem-object"
							data-tests="#scr-readingsystem-features,#scr-readingsystem-support,#scr-readingsystem-support_svg"
							>It MUST extend the <a data-cite="html#the-navigator-object">navigator object</a> [[!html]]
							with the <code>epubReadingSystem</code> interface defined in <a
								href="#app-epubReadingSystem"></a>. It also MUST support the
								<code>dom-manipulation</code> and <code>layout-change</code> features defined in <a
								href="#app-ers-hasFeature-features"></a> in container-constrained scripting
							contexts.</p>
					</li>
				</ul>

				<p id="confreq-rs-scripted-flbk" data-tests="#scr-support-fallback">If a reading system does not support
					scripting, it MUST process fallbacks for scripted content as defined in <a
						data-cite="epub-34#confreq-cd-scripted-flbk">Fallbacks for scripted content documents</a>
					[[epub-34]].</p>

				<section id="sec-local-storage">
					<h4>Local storage</h4>

					<p id="confreq-rs-scripted-storage-block">Reading systems MAY block scripts from saving persistent
						data through <a data-cite="html#dom-document-cookie">cookies</a> and <a
							data-cite="html#webstorage">web storage</a> [[html]].</p>

					<p id="confreq-rs-scripted-storage-delete" data-tests="#scr-storage-delete">Reading systems that
						allow <a data-cite="html#dom-localstorage">local storage</a> [[html]] SHOULD provide methods for
						users to inspect or delete that data.</p>
				</section>

				<section id="sec-scripted-content-events">
					<h4>Event model</h4>

					<p>Reading systems SHOULD follow the DOM Event model as per [[html]] and pass UI events to the
						scripting environment before performing any default action associated with these events.</p>

					<p>Reading system developers have to ensure that scripts cannot disable critical functionality (such
						as navigation) to constrain the extent to which a <a href="#sec-scripted-content-security"
							>potentially malicious</a> script could impact their reading systems. As a result, although
						the scripting environment ought to be able to cancel the default action of any event, some
						events either might not be passed through or might not be cancelable.</p>
				</section>

				<section id="sec-scripted-content-security" class="informative">
					<h3>Security considerations</h3>

					<p>Reading system developers who also support scripting need to be aware of the security issues that
						arise when reading systems execute scripted content. As the underlying scripting model employed
						by reading systems and browsers is the same, developers have to take into consideration the same
						kinds of issues encountered in web contexts.</p>

					<p>Each reading system has to establish if it can trust the scripts in a particular document. It is
						advised to treat all scripts as untrusted (and potentially malicious) and to examine and protect
						against all vectors of attack, in particular:</p>

					<ul>
						<li>
							<p>an attack against the runtime environment (e.g., stealing files from a user's hard
								drive);</p>
						</li>
						<li>
							<p>an attack against the reading system itself (e.g., stealing a list of a user's books or
								causing unexpected behavior);</p>
						</li>
						<li>
							<p>an attack of one [=EPUB content document=] against another (e.g., stealing data that
								originated in a different document);</p>
						</li>
						<li>
							<p>an attack of an unencrypted script against an encrypted portion of a document (e.g., an
								injected malicious script extracting protected content);</p>
						</li>
						<li>
							<p>an attack against the local network (e.g., stealing data from a server behind a
								firewall).</p>
						</li>
					</ul>

					<p>To limit the possible damage of untrusted scripts, this specification recommends that reading
						systems establish a unique <a data-cite="html#origin">origin</a> [[html]] allocated to each
						[=EPUB publication=] (see <a href="#sec-container-iri"></a>). Assigning a unique origin ensures
						that <a data-cite="epub-34#sec-scripted-spine">spine-level scripts</a> [[epub-34]] are isolated
						from other EPUB publications, and limits access to <a data-cite="html#dom-document-cookie"
							>cookies</a> [[html]], <a data-cite="html#webstorage">web storage</a> [[html]], etc.</p>

					<p>Examples of web APIs that are tied to the concept of "origin" include web storage [[html]] and
						IndexedDB [[indexeddb]], which EPUB content documents can interact with via scripting. Reading
						systems that allow users to add/remove publications from a managed library (their "bookshelf")
						might maintain the publication's unique origin when the publication is removed and subsequently
						re-imported into the content library. Conversely, reading systems might create a new unique
						origin for every newly added publication.</p>

					<p>This specification also recommends that <a data-cite="epub-34#sec-scripted-container-constrained"
							>container-constrained scripts</a> [[epub-34]] not be allowed to modify the DOM of the host
						EPUB content document and/or manipulate the containing rectangle (see <a
							href="#sec-scripted-content"></a>).</p>

					<p>Note that compliance with these recommendations does not guarantee protection from the possible
						attacks listed above; developers have to examine each potential vulnerability within the context
						of their reading system.</p>
				</section>
			</section>
		</section>
		<section id="sec-nav">
			<h3>Navigation document processing</h3>

			<p id="sec-nav-rs-conf" class="support" data-tests="#nav-spine_in-spine">[=Reading systems=] MUST process <a
					data-cite="epub-34#sec-nav">EPUB navigation documents</a> [[epub-34]].</p>

			<p>To process the EPUB navigation document, a reading system:</p>

			<ul class="conformance-list">
				<li>
					<p id="confreq-nav-toc-access" data-tests="#nav-access">MUST provide users access to the <a
							data-cite="epub-34#confreq-nav-a">links and headings</a> in the <a
							data-cite="epub-34#sec-nav-toc"><code>toc nav</code> element</a> [[epub-34]].</p>
				</li>
				<li>
					<p id="confreq-nav-alt-text" data-tests="#nav-non-text_img,#nav-non-text_img_title">SHOULD, when
						generating non-HTML based navigation widgets, replace unsupported non-text elements in headings
						and labels with their <a data-cite="epub-34#confreq-nav-a-cnt">alternative text</a> [[epub-34]].
						If both <code>alt</code> and <code>title</code> attributes are present on an element, preference
						SHOULD be given to the <code>alt</code> attribute. If neither attribute is present, reading
						systems MAY provide their own text or ignore the element.</p>
				</li>
				<li>
					<p id="confreq-nav-pagelist-access">SHOULD provide a method to navigate to the listed page breaks
						when a <a data-cite="epub-34#sec-nav-pagelist"><code>page-list nav</code> element</a>
						[[epub-34]] is present.</p>
				</li>
				<li>
					<p id="confreq-nav-landmarks-access">MAY provide users access to the links in the <a
							data-cite="epub-34#sec-nav-landmarks"><code>landmarks nav</code> element</a> [[epub-34]] and
						MAY use the links to enable functionality in the application.</p>
				</li>
				<li>
					<p id="confreq-nav-other-access">MAY provide access to <code>nav</code> elements that do not specify
						an [^/epub:type^] attribute or that <a data-cite="epub-34#sec-nav-def-types-other">declare an
							unknown value</a> [[epub-34]].</p>
				</li>
				<li>
					<p id="confreq-nav-activation" data-tests="#nav-activation">MUST relocate the current reading
						position to the destination identified by an activated link when the link is to a [=publication
						resource=].</p>
				</li>
				<li>
					<p id="confreq-nav-ol-style" data-tests="#nav-spine_in-spine-no-list-style">MUST NOT show list item
						numbering on <code>nav</code> elements when presenting them outside of the spine, regardless of
						support for CSS, as the default display style of list items is equivalent to the <a
							href="https://www.w3.org/TR/CSS2/generate.html#propdef-list-style"><code>list-style:
								none</code> property</a> [[csssnapshot]].</p>
				</li>
				<li>
					<p id="confreq-nav-hidden"
						data-tests="#nav-spine_in-spine-hidden-toc-html,#nav-spine_in-spine-hidden-toc-css">MUST ignore
						markup and styling intended to hide elements of the navigation document from rendering in the
						spine (e.g., the [[html]] [^html-global/hidden^] attribute and CSS <a
							href="https://www.w3.org/TR/CSS2/visuren.html#propdef-display"><code>display</code>
							property</a> [[csssnapshot]]).</p>
				</li>
			</ul>

			<p id="confreq-nav-spine" data-tests="#nav-spine_in-spine,#nav-spine_not-in-spine">Reading systems MUST
				honor the above requirements irrespective of whether the EPUB navigation document is also included in
				the [=EPUB spine | spine=].</p>
		</section>
		<section id="sec-media-overlays">
			<h2>Media overlays processing</h2>

			<p id="confreq-rs-epub3-mo" class="support" data-tests="#mol-css">[=Reading systems=] with the capability to
				render prerecorded audio SHOULD support <a data-cite="epub-34#sec-media-overlays">media overlays</a>
				[[epub-34]].</p>

			<div id="confreq-rs-epub3-mo-ignore" data-tests="#mol-ignore">
				<p>If a reading system does not support media overlays, it MUST ignore both:</p>
				<ul>
					<li>the <a data-cite="epub-34#attrdef-item-media-overlay"><code>media-overlay</code> attribute</a>
						on [=EPUB manifest | manifest=] [^item^] elements [[epub-34]]; and</li>
					<li><code>item</code> elements where the <code>media-type</code> attribute value equals
							<code>application/smil+xml</code>.</li>
				</ul>
			</div>

			<section id="sec-behaviors-loading">
				<h4>Loading the media overlay</h4>

				<p id="confreq-rs-loading-mol" data-tests="#mol-support_xhtml,#mol-support_xhtml-fxl">When a reading
					system loads a [=package document=], it MUST refer to the [=EPUB manifest | manifest=] [^item^]
					elements' [[epub-34]] <code>media-overlay</code> attributes to discover the corresponding media
					overlays for [=EPUB content documents=].</p>

				<p id="confreq-rs-xhtml-svg">
					<span id="mol-xhtml-support" data-tests="#mol-support_xhtml,#mol-support_xhtml-fxl">Reading systems
						MUST support playback for [=XHTML content documents=], and</span>
					<span id="mol-svg-support">MAY support [=SVG content documents=].</span>
				</p>

				<p>
					<span id="mol-support-xhtml-load" data-tests="#mol-support_xhtml-load,#mol-support_xhtml-load-fxl">
						Playback MUST start at the media overlay element which corresponds to the desired EPUB content
						document starting point. Note that the start of an EPUB content document could correspond to an
						element at the start or in the middle of a media overlay. </span>
					<span id="mol-support-xhtml-load-next"
						data-tests="#mol-support_xhtml-load-next,#mol-support_xhtml-load-next-fxl"> When the media
						overlay document finishes playing, the reading system SHOULD load the next EPUB content document
						(as specified in the package document [=EPUB spine | spine=]) and also load its corresponding
						media overlay document, provided that one is given. </span>
				</p>
			</section>

			<section id="sec-behaviors-playback">
				<h4>Basic playback</h4>

				<section id="sec-rsconf-timing-synch">
					<h3>Timing and synchronization</h3>

					<p id="mol-timing-sync" data-cite="epub-34"
						data-tests="#mol-timing-synchronization,#mol-timing-synchronization_fxl,#mol-timing-synchronization_svg,#mol-timing-synchronization_svg-fxl,#mol-timing-synchronization_multiple_audio,#mol-timing-synchronization_multiple_audio-fxl"
						>Reading systems MUST render immediate children of the [^body^] element [[epub-34]] in a
						sequence. A [^seq^] element's [[epub-34]] children MUST be rendered in sequence, and playback
						completes when the last child finishes playing. Reading system MUST render a [^par^] element's
						[[epub-34]] children in parallel (with each starting at the same time), and playback completes
						when all the children finish playing. Reading system playback of the media overlay document
						completes when the <code>body</code> element's last child finishes playing.</p>
				</section>

				<section id="sec-rsconf-rendering-audio">
					<h5>Rendering audio</h5>

					<p id="mol-audio" data-cite="epub-34" data-tests="#mol-audio">When presented with a media overlay
						[^audio^] element [[EPUB-34]], reading systems MUST play the audio resource referenced by the
							<code>src</code> attribute, starting at the clip offset time given by the <a
							data-cite="epub-34#attrdef-smil-clipBegin"><code>clipBegin</code></a> attribute and ending
						at the clip offset time given by the <a data-cite="epub-34#attrdef-smil-clipEnd"
								><code>clipEnd</code></a> attribute [[epub-34]].</p>

					<p>In addition:</p>

					<ul>
						<li id="mol-audio-no-clipbegin" data-tests="#mol-audio-no-clipbegin">
							<p>If a <code>clipBegin</code> attribute is not set, reading systems MUST assume the value
									"<code>0</code>".</p>
						</li>
						<li id="mol-audio-no-clipend" data-tests="#mol-audio-no-clipend">
							<p>If a <code>clipEnd</code> attribute is not set, reading systems MUST assume the value to
								be the full duration of the physical media.</p>
						</li>
						<li id="mol-audio-exceeding-clipend" data-tests="#mol-audio-exceeding-clipend">
							<p>If the value of <code>clipEnd</code> exceeds the full duration of the physical media,
								reading systems MUST assume its value to be the full duration of the physical media.</p>
						</li>
					</ul>

					<p>User-controllable audio playback options SHOULD include timescale modification, in which the user
						can alter the playback rate without distorting the pitch. The suggested range is half-speed to
						double-speed.</p>
				</section>

				<section id="sec-rsconf-rendering-text">
					<h5>Rendering EPUB content document elements</h5>

					<p>When presented with a media overlay [^text^] element [[epub-34]] whose <code>src</code> attribute
						contains a <a>URL-fragment string</a> referencing a specific part of an EPUB content document,
						reading systems SHOULD ensure the referenced portion is visible in the [=viewport=]. In addition
						to [[html]] element ID references and <a
							href="https://www.w3.org/TR/SVG/linking.html#SVGFragmentIdentifiers">SVG Fragment
							Identifiers</a> [[svg]], reading systems MAY support other fragment identifier schemes.</p>

					<p id="mol-rendering-with-styling"
						data-tests="#mol-css,#mol-timing-synchronization_fxl,#mol-timing-synchronization_svg,#mol-timing-synchronization_svg-fxl"
						>During media overlays playback, reading systems with a viewport SHOULD add the class names
						given by the metadata properties <a data-cite="epub-34#active-class"
							><code>active-class</code></a> and <a data-cite="epub-34#playback-active-class"
								><code>playback-active-class</code></a> [[epub-34]] to the appropriate elements, when
						specified, in the [=EPUB content document=]. Conversely, the class names SHOULD be removed when
						the playback state changes, as described in <a data-cite="epub-34#sec-docs-assoc-style"
							>Associating style information</a> [[epub-34]].</p>

					<p>The <code>active-class</code> and <code>playback-active-class</code> metadata properties are
						OPTIONAL, and if omitted, reading system behavior is implementation-specific.</p>

					<p>Reading system behavior when a <a data-cite="epub-34#sec-media-overlays-fragids">fragment
							identifier</a> [[epub-34]] does not reference an element is also
						implementation-specific.</p>
				</section>
			</section>

			<section id="sec-behaviors-interaction">
				<h4>Interacting with the EPUB content document</h4>

				<section id="sec-rsconf-navigation">
					<h5>Navigation</h5>

					<p id="mol-navigation" data-tests="#mol-navigation">Because the media overlay is closely linked to
						the [=EPUB content document=], it is very easy for reading systems to locate a position in the
						EPUB content document based on the current position in the media overlay playback. If the user
						pauses synchronized playback and navigates to a different part of the [=EPUB publication=],
						synchronized playback MUST resume at that point. For example, if a specific page number in the
						EPUB content document is the desired location, then this same point is located in the media
						overlay and playback started there.</p>

					<p>This same approach allows for synchronizing the media overlay playback with user selection of a
						navigation point in the [=EPUB navigation document=]. The reading system loads the media overlay
						for that file and finds the correct point for starting playback based on the ID of the
						navigation point target.</p>

					<div class="note">
						<p>A [=media overlay document=] can be associated directly with an <a>EPUB navigation
								document</a> in order to provide synchronized playback of its contents regardless of
							whether the [=XHTML content document=] in which it resides is included in the [=EPUB spine |
							spine=]. See <a data-cite="epub-34#sec-mo-nav-doc">EPUB navigation document</a> [[epub-34]]
							for more information.</p>
					</div>

					<div class="note" id="note-table-reading-mode">
						<p>Media overlay document elements can be associated with EPUB content document structures such
							as tables. Reading systems need to ensure that media overlay playback remains synchronized
							with user navigation of table rows and cells. The reading system might also play the
							corresponding table header preceding the contents of the cell.</p>
					</div>
				</section>

				<section id="sec-text-to-speech">
					<h5>Text-to-speech</h5>

					<p id="mol-tts" data-cite="epub-34" data-tests="#mol-tts_multi,#mol-tts_single">When a media overlay
						[^text^] element with no [^audio^] [[epub-34]] sibling element references text within the target
						[=EPUB content document=], reading systems capable of text-to-speech (TTS) playback SHOULD
						render the referenced text using TTS.</p>

					<p>Reading systems SHOULD use the speech-related information provided in the target EPUB content
						document to play the audio stream as part of the media overlay rendering.</p>

					<div class="note">
						<p>See <a data-cite="epub-tts-10#">EPUB 3 Text-to-Speech Support</a> [[epub-tts-10]] for more
							information about supporting TTS technologies in [=EPUB publications=].</p>
					</div>

					<p>The media overlay <code>text</code> element's lifespan corresponds to the rendering time of the
						associated speech synthesis. The implicit duration of the <code>text</code> element (and by
						inference, of the parent <code>par</code> element) is therefore determined by the execution of
						the Text-to-Speech engine, and cannot be known at authoring time (factors like speech rate,
						pauses and other prosody parameters influence the audio output). This also means that reading
						systems need to treat the <a data-cite="epub-34#duration"><code>duration</code></a> property
						values set in the package document as approximative when making use of them.</p>
				</section>
			</section>

			<section id="sec-behaviors-skip-escape">
				<h4>Skippability and escapability</h4>

				<section id="sec-skippability">
					<h5>Skippability</h5>

					<p id="mol-skipping-support">Reading systems SHOULD use the semantic information provided by media
						overlay elements' [^/epub:type^] attribute to offer users the option of skipping content.</p>

					<p id="mol-skipping-structure">When skipping of content is enabled, reading systems MUST suppress
						playback of any <code>par</code> and <code>seq</code> elements whose <code>epub:type</code>
						attribute contains a semantic that matches a skippable structure.</p>
				</section>

				<section id="sec-escapability">
					<h5>Escapability</h5>

					<p>
						<span id="mol-escaping-support">While playing media overlays, reading systems SHOULD offer users
							the option to leave ("escape") <a data-cite="epub-34#sec-escapability">escapable
								structures</a> [[epub-34]], which are determined by the presence of an [^/epub:type^]
							attribute [[epub-34]] with a value from the escapable structures list.</span>
						<span id="mol-escaping-structure">If a user opts to escape from an escapable structure, then the
							reading system MUST continue playback with the next sequential element after the
							structure.</span>
					</p>
				</section>
			</section>
		</section>
		<section id="sec-structural-semantics">
			<h2>Processing structural semantics</h2>

			<p id="confreq-rs-epub-epub-type" class="support" data-tests="#pss-support">[=Reading systems=] MAY support
					<a data-cite="epub-34#sec-structural-semantics">structural semantics</a> [[epub-34]] in <a>EPUB
					content documents</a>.</p>

			<p>When processing the [^/epub:type^] attribute, a reading system:</p>

			<ul class="conformance-list">
				<li>
					<p id="confreq-rs-epubtype-expand">MAY <a>obtain an expanded URL</a> for each value.</p>
				</li>
				<li>
					<p id="confreq-rs-epubtype-ignore-element" data-tests="#pss-support_ignore-title">MUST ignore the
						terms if used on an element whose usage is not allowed in the <a
							data-cite="epub-34#sec-epub-type-attribute">definition of
						<code>epub:type</code></a> [[epub-34]].</p>
				</li>
				<li>
					<p id="confreq-rs-epubtype-beh" data-tests="#pss-support">MAY associate behaviors with none, some,
						or all of the terms defined in the <a data-cite="epub-34#sec-epub-type-attribute">default
							vocabulary</a> [[epub-34]].</p>
				</li>
				<li>
					<p id="confreq-rs-epubtype-oth">MAY associate behaviors with terms from other vocabularies.</p>
				</li>
			</ul>
		</section>
		<section id="sec-compact-url-values">
			<h2>Processing compact URLs</h2>

			<p id="confreq-rs-vocab-assoc" class="support">[=Reading systems=] MAY support the <a
					data-cite="epub-34#sec-vocab-assoc">vocabulary association mechanisms</a> for processing <a
					data-cite="epub-34#sec-compact-url-datatype">compact URLs</a> [[epub-34]].</p>

			<p>This section defines an algorithm for obtaining an expanded URL from a compact URL. It applies only to
				[=reading systems=] that support the [[epub-34]] vocabulary association mechanisms.</p>

			<p>Reading systems that do not support the [[epub-34]] vocabulary association mechanisms MAY process compact
				URLs as plain [=string=] values [[infra]]. They do not have to support the expansion of these values to
				URLs or add reading system behaviors based on their presence.</p>

			<p>The algorithm describes the process using the terminology and data types defined in [[infra]], and, if
				successful, results in a [=string=] value with the expanded URL being returned. A <a
					data-cite="infra#nulls">null</a> value is returned for invalid properties.</p>

			<p>This algorithm takes the following arguments:</p>

			<ul>
				<li><var>value</var>: the compact URL to process.</li>
				<li><var>attr</var>: the name of the attribute that contains <var>value</var>.</li>
				<li><var>elem</var>: the name of the element that <var>attr</var> is attached to.</li>
				<li><var>doc</var>: the document being processed (e.g., [=package document=], [=media overlay
					document=], [=epub content document=]).</li>
			</ul>

			<p>To <dfn>obtain an expanded URL</dfn>, apply the following steps:</p>

			<ol class="algorithm">
				<li>
					<p>Let <var>baseURL</var>, <var>expandedURL</var>, <var>prefix</var>, and <var>reference</var> be
						empty [=strings=].</p>
					<details class="explanation">
						<summary>Explanation</summary>
						<p>In this algorithm:</p>
						<ul>
							<li><var>baseURL</var> will hold the base URL associated with the value, whether this URL is
								assigned in a <code>prefix</code> attribute, corresponds to a default vocabulary, or
								comes from a reserved prefix.</li>
							<li><var>expandedURL</var> will hold the final URL that results from the concatenation of
								the base URL and reference.</li>
							<li><var>prefix</var> will hold the compact URL's <a
									data-cite="epub-34#compact-url.ebnf.prefix">prefix</a> [[epub-34]] (i.e., the value
								before the colon). Properties from a default vocabulary will not have a prefix, but all
								others will.</li>
							<li><var>reference</var> will hold the compact URL's <a
									data-cite="epub-34#compact-url.ebnf.reference">reference</a> [[epub-34]] (i.e., the
								value after the prefix). All valid properties require a reference.</li>
						</ul>
					</details>
				</li>
				<li>
					<p>Obtain the values of <var>prefix</var> and <var>reference</var> as follows:</p>
					<ol>
						<li>
							<p>If <var>value</var> does not contain a colon (U+003A), set <var>reference</var> to
									<var>value</var>.</p>
							<details class="explanation">
								<summary>Explanation</summary>
								<p>If a compact URL value does not have a colon, it does not have a prefix. In this
									case, the value is drawn from the default vocabulary as described in the next step
									of the algorithm.</p>
							</details>
						</li>
						<li>
							<p>Otherwise, if <var>value</var> begins with a colon, the value is invalid. Return <a
									data-cite="infra#nulls">null</a>.</p>
							<details class="explanation">
								<summary>Explanation</summary>
								<p>A colon at the beginning of the value is invalid as it indicates the prefix is not
									set.</p>
							</details>
						</li>
						<li>
							<p>Otherwise, split <var>value</var> on the first colon and set <var>prefix</var> to the
								string before the colon and set <var>reference</var> to the string after the colon.</p>
						</li>
					</ol>
					<p>If <var>reference</var> is not a valid [=path-relative-scheme-less-URL string=], as the <a
							data-cite="epub-34#compact-url.ebnf.reference">compact URL definition</a> [[epub-34]]
						requires, the value is invalid. Return <a data-cite="infra#nulls">null</a>.</p>
					<details class="explanation">
						<summary>Explanation</summary>
						<p>The path-relative-scheme-less-URL string definition has a number of restrictions that apply
							to the reference whether it has a prefix or not.</p>
						<p>For example, the reference is not allowed to begin with a [=URL-scheme string=] followed by a
							colon. This restriction means that the following is not a valid <code>property</code> value
							as the second colon could represent a scheme: <code>foo:bar:baz/qux</code>.</p>
						<p>There are also restrictions on what characters have to be percent encoded.</p>
					</details>
				</li>
				<li>
					<p>Obtain the value of <var>baseURL</var> as follows:</p>
					<ol>
						<li>
							<p>If <var>prefix</var> is an empty string:</p>
							<ol data-cite="epub-34">
								<li>If <var>attr</var> is [^/epub:type^] [[epub-34]], set <var>baseURL</var> to
										<br /><code>http://idpf.org/epub/vocab/structure/#</code></li>
								<li>Otherwise, if <var>elem</var> is the package document [^meta^] element [[epub-34]]
									and <var>attr</var> is <code>scheme</code>, the property value is invalid. Return <a
										data-cite="infra#nulls">null</a>.</li>
								<li>Otherwise, if <var>elem</var> is the package document [^meta^] element [[epub-34]],
									set <var>baseURL</var> to
										<br /><code>http://idpf.org/epub/vocab/package/meta/#</code></li>
								<li>Otherwise, if <var>elem</var> is the package document [^link^] element [[epub-34]],
									set <var>baseURL</var> to
										<br /><code>http://idpf.org/epub/vocab/package/link/#</code></li>
								<li>Otherwise, if <var>elem</var> is the package document [^item^] element [[epub-34]],
									set <var>baseURL</var> to
										<br /><code>http://idpf.org/epub/vocab/package/item/#</code></li>
								<li>Otherwise, if <var>elem</var> is the package document [^itemref^] element
									[[epub-34]], set <var>baseURL</var> to
										<br /><code>http://idpf.org/epub/vocab/package/itemref/#</code></li>
							</ol>
							<details class="explanation">
								<summary>Explanation</summary>
								<p>If the compact URL does not have a prefix, then this step assigns the default
									vocabulary URL to use based on the attribute or element to which it belongs. When an
									element in the package document has more than one attribute that takes a compact URL
									data type, those attributes share the same default vocabulary. For this reason, it
									is not necessary to check both the element and attribute to determine what URL to
									assign.</p>
								<p>The one attribute in EPUB 3 that does not have a default vocabulary is the <a
										data-cite="epub-34#attrdef-scheme"><code>scheme</code> attribute</a>
									[[epub-34]]. A scheme value without a prefix is invalid.</p>
							</details>
						</li>
						<li>
							<p>Otherwise:</p>
							<ol>
								<li>
									<p>If a <code>prefix</code> attribute is declared on the document element of
											<var>doc</var>, and the attribute contains a prefix that matches
											<var>prefix</var>, set <var>baseURL</var> to the URL associated with the
										prefix declaration.</p>
								</li>
								<li>
									<p>Otherwise, if <var>prefix</var> matches a <a
											data-cite="epub-34#sec-reserved-prefixes">reserved prefix</a> [[epub-34]]
										for <var>doc</var>, set <var>baseURL</var> to the URL associated with the
										reserved prefix.</p>
								</li>
							</ol>
							<details class="explanation">
								<summary>Explanation</summary>
								<p>When a compact URL has a prefix, the first place to check for its base URL is in a
										<code>prefix</code> attribute declaration on the document element.</p>
								<p>If the author has not assigned a URL for the prefix, the next step is to check if the
									prefix matches one of the reserved prefixes.</p>
								<p>Note that author-assigned prefix URLs override the reserved prefix URLs.</p>
							</details>
						</li>
					</ol>
					<p>If <var>baseURL</var> is an empty string, the property value is invalid. Return <a
							data-cite="infra#nulls">null</a>.</p>
					<details class="explanation">
						<summary>Explanation</summary>
						<p>If the base URL is empty at the end of this processing step, then either the prefix is not
							mapped or reserved, or the element or attribute being processed does not accept compact URL
							data types as defined in [[epub-34]].</p>
						<p>Without a base URL, it is impossible to generate an expanded URL, so the value is
							invalid.</p>
					</details>
				</li>
				<li>Set <var>expandedURL</var> to the concatenated values of <var>baseURL</var> and
					<var>reference</var>. Do not add a separator when concatenating the values.</li>
				<li>
					<p>If <var>expandedURL</var> is not a [=valid URL string=], the value is invalid. Return <a
							data-cite="infra#nulls">null</a>.</p>
					<p>Otherwise, return <var>expandedURL</var>.</p>
					<details class="explanation">
						<summary>Explanation</summary>
						<p>Although an expanded value might be obtained, it is not necessarily the case that it is a
							valid URL. This is only likely to occur when an invalid base URL is assigned to a
							prefix.</p>
					</details>
				</li>
			</ol>

			<div class="note">
				<p>Reading systems do not have to [=url parser | parse the resulting URL=] [[url]] or attempt to
					dereference the resulting expanded URL. Expanding a compact URL to a full URL only ensures a reading
					system has encountered the value it expects (i.e., because different EPUB publications might assign
					the same prefix to different URLs, two values might appear the same until expanded).</p>
			</div>
		</section>
		<section id="sec-epub-rs-conf-backward">
			<h3>Backward compatibility</h3>

			<p id="confreq-rs-backward-epub" data-tests="#pkg-version-backward">[=Reading systems=] MUST attempt to
				process an [=EPUB publication=] whose [=package document=] <a
					data-cite="epub-34#attrdef-package-version"><code>version</code> attribute</a> [[epub-34]] is less
				than "<code>3.0</code>".</p>

			<p id="confreq-rs-backward-conf">EPUB publications with older version numbers will not always render exactly
				as intended unless processed according to their respective specifications. Reading systems SHOULD
				support such EPUB publications as defined by those specifications.</p>
		</section>
		<section id="sec-epub-rs-conf-forward">
			<h3>Forward compatibility</h3>

			<p id="confreq-rs-forward-epubn">[=Reading systems=] SHOULD attempt to process an [=EPUB publication=] whose
				[=package document=] <a data-cite="epub-34#attrdef-package-version"><code>version</code> attribute</a>
				[[epub-34]] is greater than "<code>3.0</code>".</p>
		</section>
		<section id="sec-accessibility" class="informative">
			<h2>Accessibility</h2>

			<p>Although the primary focus of this specification is on how to process and render [=EPUB publications=],
				it does not mandate specific user interfaces that all [=reading systems=] have to offer. This does not
				mean that there are not common accessibility issues that all reading systems developers need to be aware
				of or seek to avoid in their applications.</p>

			<p>The W3C's User Agent Accessibility Guidelines [[uaag20]] provides many useful practices developers can
				apply to improve their reading systems as many browser accessibility issues have parallels in
				EPUB-specific user agents.</p>

			<p>The following list outlines some additional EPUB-specific areas where a lack of accessibility impacts the
				reading experience for users:</p>

			<ul>
				<li>Bookshelf &#8212; Ensure that the process for accessing and opening the user's content is
					accessible. For example, do not rely on a visual-only display like cover images. Exposing text
					representations of the title(s) and author(s), including the language they are expressed in, allows
					assistive technologies to properly announce the content.</li>
				<li>User Interface Controls &#8212; Ensure that all controls (e.g., search boxes, annotation controls,
					and buttons to load features such as the table of contents) are exposed to assistive technologies
					and that their actions do not rely on specific modalities (e.g., they only operate through touch or
					a mouse).</li>
				<li>Search &#8212; Search access to the full text content of all [=EPUB content documents=] is necessary
					to ensure users can locate information easily.</li>
				<li>Display Control &#8212; Provide methods for users to tailor the styling of the content to their
					preferences (e.g., to change and increase fonts, increase line and word spacing, and apply alternate
					contrasts).</li>
				<li>Zoom &#8212; Allow users to zoom the content to better size it to their needs, especially for
					[=fixed-layout documents=].</li>
				<li>Reading Control &#8212; Ensure that the ability to read from page-to-page and document-to-document
					does not depend on physical interaction (i.e., users of assistive technologies can read the content
					without getting trapped at the end of pages or documents).</li>
				<li>API Integration &#8212; Ensure that the accessibility tree, including support for roles, states and
					properties [[wai-aria-11]], is exposed to the underlying operating system's accessibility API so
					that users can fully interact with the content when using assistive technologies.</li>
				<li>Document Object Model (DOM) &#8212; Provide access to the [[dom]] of EPUB content documents so that
					users can investigate the semantics and structure expressed in the source.</li>
				<li>Table of Contents &#8212; Ensure that users can access the link text, including <a
						data-cite="epub-34#confreq-nav-a-title">text alternatives for visual content</a>, and that users
					can activate the table of contents links using different inputs.</li>
			</ul>

			<p>The DAISY Consortium maintains an <a href="https://epubtest.org/test-books">accessibility test suite</a>
				to aid in evaluating these issues and more.</p>
		</section>
		<section id="sec-security-privacy">
			<h2>Security and privacy</h2>

			<section id="security-privacy-overview" class="informative">
				<h3>Overview</h3>

				<p>The particularity of an [=EPUB publication=] is its structure. The EPUB format provides a means of
					representing, packaging, and encoding structured and semantically enhanced web content — including
					HTML, CSS, SVG, and other resources — for distribution in a single-file container.</p>

				<p>For [=reading systems=], this means that the security and privacy issues are primarily based on the
					features of those formats, and closely mirror the threats presented by web content generally.</p>

				<p>Reading system developers also have a dual responsibility of both ensuring the security and privacy
					of their applications and helping limit the threats to users from the content that renders within
					them. The rest of this section explores the risk model of EPUB 3 with the aim of helping developers
					recognize and mitigate these risks.</p>

				<div class="note">
					<p>For the risks associated with the authoring of EPUB publications, refer to the <a
							data-cite="epub-34#sec-security-privacy">security and privacy section</a> of
						[[epub-34]].</p>
				</div>
			</section>

			<section id="epub-threat-model" class="informative">
				<h3>Threat model</h3>

				<p>The greatest threats to users come from the <a data-cite="epub-34#epub-threat-model">content they
						read</a> [[epub-34]], and the first line of defense against these attacks is the reading systems
					they use. Users expect that reading systems act as safeguards against malicious content and are
					often unaware that [=EPUB publications=] are susceptible to the same security risks as web
					sites.</p>

				<p>But although reading systems are relied on to provide security and privacy, they can also pose
					unintended threats to users depending on how information is handled. Tracking user information to
					optimize experiences is a common need, for example, but done without user permission and reading
					systems can run afoul of legal privacy requirements.</p>

				<p>This section outlines some of the key threats that reading system developers need to take into
					consideration, with further details and recommendations in the following sections.</p>

				<dl>
					<dt>Scripting</dt>
					<dd>
						<p>Malicious scripts present several attack vectors against reading systems. If local storage is
							not secure, for example, they can attempt to compromise the user's data. Provided with
							network access, they could attempt unauthorized collection of user data.</p>
						<p>More detailed discussion of these issues and how to mitigate them is provided in <a
								href="#sec-scripted-content-security"></a>.</p>
					</dd>

					<dt>Malicious content</dt>
					<dd>
						<p>EPUB publications could contain resources designed to exploit security flaws in reading
							systems or the operating systems they run on. Attackers could also try to gain access to
							[=remote resources=] using file indirection techniques, such as symbolic links or file
							aliases. </p>
						<p>The lack of a standard method of signing EPUB publications means that reading systems cannot
							always verify whether the content has been tampered with between authoring and loading in
							the device.</p>
					</dd>

					<dt>Remote resources</dt>
					<dd>
						<p>[=Remote resources=] present the same risks as any EPUB publication loaded from an untrusted
							source. Even if the publisher of the EPUB publication is trusted, remote resources could be
							compromised.</p>
						<p>Calls to remote resources can also be used to track information about users (e.g., through
							server logs). It is advised to limit the information exposed through HTTP requests to only
							what is essential to obtain the resource.</p>
						<p>The <a href="#sec-container-iri">origin</a> of an EPUB is both specific to each reading
							system implementation and not known outside that implementation. Consequently, even when
							remote resources are hosted on a trusted web server, the server effectively cannot use
							security features that require specifying allowable origins, such as headers for <a
								href="https://fetch.spec.whatwg.org/#cors-protocol">CORS</a>, <a
								href="https://www.w3.org/TR/CSP2/#content-security-policy-header-field"
									><code>Content-Security-Policy</code></a>, or <a
								href="https://www.rfc-editor.org/rfc/rfc7034"><code>X-Frame-Options</code></a>.</p>
					</dd>

					<dt>External links</dt>
					<dd>
						<p>Like remote resources, external links could be used to trick unwitting users into opening
							malicious resources on the web designed to exploit the reading system or operating
							system.</p>
						<p>Likewise, it is advised to also avoid exposing potentially identifying information about
							users through the traversal of links (e.g., not using tracking identifiers or exposing
							unnecessary information about the user's environment).</p>
					</dd>

					<dt>User-generated content</dt>
					<dd>
						<p>User-generated content within a reading experience, for example through text areas or other
							interactive components, could pose a threat to reading system security or user privacy if
							the content is not properly secured. More details on scripting security are provided in <a
								href="#sec-scripted-content-security"></a>.</p>
					</dd>

					<dt>Collection of user data</dt>
					<dd>
						<p>Collecting information about the user and their reading habits without obtaining their
							permission can violate their privacy, even if the information is only intended for internal
							use.</p>
						<p>Attempting to profile users based on their reading habits or through metadata in their
							publication (e.g., accessibility preferences) can expose users to unintended harms.</p>
					</dd>
				</dl>

				<p>Additionally, the security considerations that apply to [[xml]] and [[zip]] files also apply to the
						<a data-cite="epub-34#sec-package-doc">package document</a> and the <a
						data-cite="epub-34#sec-ocf">Open Container Format</a>, respectively. See the "Security
					Consideration" sections of the Media Type registrations for the <a
						data-cite="epub-34#app-media-type-app-oebps-package"
						><code>application/oebps-package+xml</code></a> and the <a data-cite="epub-34#app-media-type"
							><code>application/epub+zip</code></a> formats for further details.</p>
			</section>

			<section id="security-privacy-recommendations">
				<h3>Recommendations</h3>

				<p>The strongest measure that reading system developers can take for privacy is to specify the data they
					intend to collect and use about the user and/or their reading behavior and seek the consent of users
					to obtain it. They SHOULD also allow personalization and control over this information.</p>

				<p>If a reading system allows users to store persistent data, especially personally identifiable
					information, it SHOULD treat that data as sensitive and not allow access to it by third parties.</p>

				<p>It is understood that the collection of some user data is often necessary for the sale, delivery, and
					operation of an [=EPUB publication=], particularly on platforms where the sale of an EPUB
					publication and the method of reading it are connected. In these cases, the reading system SHOULD
					identify the data being collected, how it is used, and allow for user opt-outs (retailers could
					choose to inform users by other means, such as when a user creates an account on their web site).
					Anonymization of any collected data is RECOMMENDED for the privacy and the security of the user and
					reading system.</p>

				<p>It is also understood that user data could be necessary or helpful for some reading system
					affordances. In these cases, anonymization is also RECOMMENDED. Reading systems SHOULD also inform
					users of what data is needed, what it is to be used for, and to provide methods to opt-out.</p>

				<p>Content processors &#8212; defined as entities that handle the ingestion of EPUB content for
					distribution, display, or sale &#8212; also need to be aware of the potential risks in ingestion. It
					is advised that content processors check content for malicious content on ingestion, in addition to
					the validation steps that usually occur. This could include running virus scans, validating external
					links and remote resources, and other precautions.</p>

				<p id="security-privacy-recommendations-sideloaded-consent"
					data-tests="#sec-untrusted-consent_network,#sec-untrusted-consent_scripting">Reading systems SHOULD
					treat content from any new source, including from an integrated bookstore, as insecure (e.g., prompt
					users to allow scripting and network access the first time the source is accessed). If a reading
					system allows users to load their own content (e.g., through the process of "sideloading"), each
					instance SHOULD be treated as insecure. </p>

				<p>When processing XML documents, a reading system SHOULD NOT resolve <a data-cite="xml#NT-ExternalID"
						>external identifiers</a> in DOCTYPE, ENTITY and NOTATION declarations [[xml]]. Reading systems
					SHOULD also consider security risks related to <a data-cite="xml#sec-internal-ent">internal</a> or
						<a data-cite="xml#sec-external-ent">external</a> XML entities like, for example, DoS attacks
					also known as <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack">"Billion laughs
						attacks"</a> or <a href="https://en.wikipedia.org/wiki/XML_external_entity_attack">"XML external
						entity attacks"</a>. </p>

				<div class="note">
					<p>Additional security recommendations for external links, network access and scripting are
						available in <a href="#sec-epub-rs-external-links"></a>, <a href="#sec-epub-rs-network-access"
						></a>, and <a href="#sec-scripted-content-security"></a>, respectively.</p>
				</div>
			</section>
		</section>
		<section id="app-obsolete" class="appendix">
			<h2>Obsolete features</h2>

			<section id="sec-outdated">
				<h3>Outdated features</h3>

				<p>Reading systems MAY support <a data-cite="epub-34#outdated">outdated features</a> [[epub-34]] with
					the exception of the <a data-cite="epub-34#sec-pkg-legacy">legacy features</a>.</p>

				<p>Legacy features are only allowed for compatibility with EPUB 2 reading systems and MUST be ignored by
					EPUB 3 reading systems.</p>
			</section>

			<section id="sec-obs-deprecated">
				<h3>Deprecated features</h3>

				<p id="confreq-rs-deprecated">[=reading systems=] MAY support <a data-cite="epub-34#deprecated"
						>deprecated authoring features</a> [[epub-34]].</p>

				<p id="sec-embedded-media">In addition, the following reading system features are now deprecated:</p>

				<dl>
					<dt>Media overlays processing</dt>
					<dd>
						<ul>
							<li>
								<p><a
										href="https://www.w3.org/publishing/epub32/epub-mediaoverlays.html#sec-embedded-media"
										>Automatic playback of embedded audio and video</a> [[epubmediaoverlays-32]]</p>
							</li>
						</ul>
					</dd>

					<dt><code>epubReadingSystem</code> object</dt>
					<dd>
						<ul>
							<li>
								<p><a href="https://idpf.org/epub/301/spec/epub-contentdocs.html#app-ers-properties"
											><code>layoutStyle</code> property</a> [[epubcontentdocs-301]]</p>
							</li>
							<li>
								<p><a
										href="https://www.w3.org/publishing/epub32/epub-contentdocs.html#app-ers-properties"
											><code>name</code> and <code>version</code> properties</a>
									[[epubcontentdocs-32]]</p>
							</li>
						</ul>
					</dd>
				</dl>

				<div class="note">
					<p>Developers need to consider the unlikelihood of encountering content with deprecated features
						before adding new support for them.</p>
				</div>
			</section>
		</section>
		<section id="app-epubReadingSystem" class="appendix">
			<h2><dfn class="export">epubReadingSystem</dfn> object</h2>

			<p class="note">[=Reading systems=] act as the core rendering engines of EPUB publications and provide a
				scripting environment based on the [[dom]] specification. So, although this interface definition uses
				the [[webidl]] notation for implementation by reading systems, web browsers generally do not have to
				implement these objects.</p>

			<section id="app-ers-idl">
				<h3>Interface definition</h3>

				<p>This specification extends the {{Navigator}} object [[html]] as follows.</p>

				<pre class="idl">[Exposed=(Window)]
interface EpubReadingSystem {
    boolean hasFeature(DOMString feature, optional DOMString version);
};

partial interface Navigator {
    [LegacyUnforgeable, SameObject] readonly attribute EpubReadingSystem epubReadingSystem;
};</pre>

				<div class="note">
					<p>This specification does not define an <code>epubReadingSystem</code> property extension for the
						{{WorkerNavigator}} object [[html]]. Therefore, reading systems do not have to expose the
							<code>epubReadingSystem</code> object in the scripting context of Workers, so its presence
						cannot be relied on.</p>
				</div>
			</section>

			<section id="app-ers-desc">
				<h3>Description</h3>

				<p>The <code><dfn class="export">Navigator.epubReadingSystem</dfn></code> object provides an interface
					through which a [=scripted content document=] can query information about a user's reading
					system.</p>


				<p id="scripting-req-readingsystem"
					data-tests="#scr-readingsystem-features,#scr-readingsystem-support_svg,#scr-readingsystem-support_iframe,#scr-readingsystem-support_iframe_svg"
					>Reading systems MUST expose the <code>epubReadingSystem</code> object on the <code>navigator</code>
					object of all loaded scripted content documents, including any nested <a
						data-cite="epub-34#sec-scripted-container-constrained">container-constrained scripting
						contexts</a> [[epub-34]]. Reading systems MUST ensure that the <code>epubReadingSystem</code>
					object is available no later than when the <a data-cite="html#the-end"><code>DOMContentLoaded</code>
						event is triggered</a> [[html]].</p>

				<div class="note">
					<p>Reading system implementations can create cloned instances of the <code>epubReadingSystem</code>
						object in scripted content documents for technical feasibility reasons. In such cases, the
						reading system has to consistently maintain the object's state — as reflected by the values of
						its properties and methods — across all copied instances.</p>
				</div>
			</section>

			<section id="app-ers-methods">
				<h3>Methods</h3>

				<section id="app-ers-hasFeature">
					<h4>hasFeature</h4>

					<section id="app-ers-hasFeature-desc">
						<h5>Description</h5>

						<p data-dfn-for="EpubReadingSystem">The <code><dfn>hasFeature</dfn></code> method returns a
							boolean value indicating whether the reading system supports any version of the specified
							feature, or <code>undefined</code> if the reading system does not recognize the specified
							feature.</p>

						<p>The <code>version</code> parameter allows querying of custom features that could change in
							incompatible ways over time. The return value indicates support only for the specified
							version of the feature.</p>

						<p><a href="#app-ers-hasFeature-features">Features defined in this specification</a> are
							versionless. If a reading system supports a feature defined in this specification, it MUST
							ignore any supplied <code>version</code> parameter and return a <code>true</code> value.</p>

						<aside class="example"
							title="JavaScript function to display support for scripted manipulation of the DOM">
							<pre>var feature = "dom-manipulation";

var conformTest = navigator.epubReadingSystem.hasFeature(feature);

alert("Feature " + feature + " supported?: " + conformTest);</pre>
						</aside>
					</section>

					<section id="app-ers-hasFeature-features">
						<h5>Features</h5>

						<p id="scripting-req-readingsystem-features" data-tests="#scr-readingsystem-features">The
							following table lists the set of features that reading systems that support the
								<code>epubReadingSystem</code> object MUST recognize. When the features are queried from
							the <code>hasFeature</code> method, reading systems MUST return a boolean value indicating
							their support.</p>

						<table>
							<thead>
								<tr>
									<th>Name</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td id="feature-dom-manipulation">
										<code>dom-manipulation</code>
									</td>
									<td>Scripts can make structural changes to the document’s DOM (applies to <a
											data-cite="epub-34#sec-scripted-spine">spine-level scripting</a> [[epub-34]]
										only).</td>
								</tr>
								<tr>
									<td id="feature-layout-changes">
										<code>layout-changes</code>
									</td>
									<td>Scripts can modify attributes and CSS styles that affect content layout (applies
										to <a data-cite="epub-34#sec-scripted-spine">spine-level scripting</a>
										[[epub-34]] only).</td>
								</tr>
								<tr>
									<td id="feature-touch-events">
										<code>touch-events</code>
									</td>
									<td>The device supports touch events, and the reading system passes touch events to
										the content.</td>
								</tr>
								<tr>
									<td id="feature-mouse-events">
										<code>mouse-events</code>
									</td>
									<td>The device supports mouse events, and the reading system passes mouse events to
										the content.</td>
								</tr>
								<tr>
									<td id="feature-keyboard-events">
										<code>keyboard-events</code>
									</td>
									<td>The device supports keyboard events, and the reading system passes keyboard
										events to the content.</td>
								</tr>
								<tr>
									<td id="feature-spine-scripting">
										<code>spine-scripting</code>
									</td>
									<td>Indicates whether the reading system supports <a
											data-cite="epub-34#sec-scripted-spine">spine-level scripting</a> [[epub-34]]
										(e.g., so a <a data-cite="epub-34#sec-scripted-container-constrained"
											>container-constrained script</a> [[epub-34]] can determine whether any
										actions that depend on scripting support in a [=top-level content document=]
										have any chance of success before attempting them).</td>
								</tr>
							</tbody>
						</table>

						<p>Reading system developers MAY add additional features, but future versions of this
							specification could append to this list in ways that might conflict or be incompatible with
							any such custom additions.</p>
					</section>
				</section>
			</section>
		</section>
		<section id="index"></section>
		<section id="change-log" class="appendix informative">
			<h2>Change log</h2>

			<p>Note that this change log only identifies substantive changes since <a
					href="https://www.w3.org/TR/epub-rs-33/">EPUB 3.3</a> — those that can affect the conformance of
				[=EPUB reading systems=].</p>

			<p>For a list of all issues addressed, refer to the <a
					href="https://github.com/w3c/epub-specs/issues?q=is%3Aissue%20is%3Aclosed%20label%3ASpec-ReadingSystems%20closed%3A2025-02-11%20..2027-02-11"
					>working group's issue tracker</a>.</p>

			<details id="changes-epub-rs-33" open="open">
				<summary>Substantive changes since <a href="https://www.w3.org/TR/epub-rs-33/">EPUB Reading Systems
						3.3</a></summary>
				<ul>
					<li>18-Dec-2025: Removed references to reflowable documents being allowed in spreads and clarified
						that spread placement properties only apply to pre-paginated documents. See <a
							href="https://github.com/w3c/epub-specs/pull/2844#issuecomment-3632673767">pull request
							2844</a>.</li>
					<li>18-Dec-2025: Clarified support for outdated features.</li>
					<li>18-Dec-2025: Removed processing for <code>rendition:align-x-center</code> as it now marked as a
						deprecated feature. See <a href="https://github.com/w3c/epub-specs/issues/2847">issue
						2847</a>.</li>
					<li>18-Dec-2025: Removed processing for the <code>rendition:align-x-center</code>,
							<code>rendition:flow</code>, <code>rendition:orientation</code> and
							<code>rendition:spread</code> properties and their overrides as these are now marked as
						outdated features. See <a href="https://github.com/w3c/epub-specs/issues/2841">issue
						2841</a>.</li>
					<li>18-Dec-2025: Added support for roll layouts in a new section under fixed layouts. See <a
							href="https://github.com/w3c/epub-specs/issues/2791">issue 2791</a>.</li>
					<li>18-Dec-2025: Added a new "Layout" section to cover reflowable and fixed layouts. See <a
							href="https://github.com/w3c/epub-specs/pull/2844">pull request 2844</a>.</li>
					<li>06-August-2025: Updated the <a href="#sec-css">section on handling CSS</a>, in particular the
						relationships between the user agent's and the creators' style sheets. See discussion in <a
							href="https://github.com/w3c/epub-specs/issues/2762">issue 2762</a> and <a
							href="https://github.com/w3c/epub-specs/pull/2771">pull request 2771</a>. </li>
					<li>05-June-2025: Consolidated all deprecated features under the unsupported features section. See
						the comments in <a href="https://github.com/w3c/epub-specs/pull/2735#issuecomment-2944066035"
							>pull request 2735</a>.</li>
					<li>04-June-2025: Added section on optional ITS markup support. See <a
							href="https://github.com/w3c/epub-specs/issues/2732">issue 2732</a>.</li>
					<li>08-Apr-2025: Added a requirement that reading systems ignore markup and styling intended to hide
						content in the EPUB navigation document when it is included in the spine. See <a
							href="https://github.com/w3c/epub-specs/issues/2687">issue 2687</a>.</li>
				</ul>
			</details>
		</section>
		<div data-include="../acknowledgements.html" data-include-replace="true"></div>
	</body>
</html>
