<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>EPUB Content Documents 3.2</title>
		<script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
		<script src="common/js/biblio.js" class="remove"></script>
		<script src="common/js/dfn-crossref.js" class="remove"></script>
		<script src="common/js/confreq-permalinks.js" class="remove"></script>
		<script src="common/js/copyright.js" class="remove"></script>
		<link href="common/css/common.css" rel="stylesheet" type="text/css" />
		<script class="remove">
          var respecConfig = {
              wg: "EPUB 3 Community Group",
              wgURI: "https://www.w3.org/community/epub3/",
              wgPublicList: "public-epub3",
              specStatus: "CG-FINAL",
              noRecTrack: true,
              shortName: "epub-contentdocs",
              prevRecURI: "https://www.idpf.org/epub/31/spec/epub-contentdocs-20170105.html",
              edDraftURI: "https://w3c.github.io/publ-epub-revision/epub32/spec/epub-contentdocs.html",
              copyrightStart: "1999",
              editors: [
                  {
                      name: "Dave Cramer",
                      company: "Hachette Book Group",
                      companyURL: "https://www.hachettebookgroup.com"
                  },
                  {
                      name: "Matt Garrish",
                      company: "DAISY Consortium",
                      companyURL: "https://www.daisy.org"
                  }
              ],
              formerEditors: [
                  {
                      name: "Elika J. Etemad",
                      company: "Invited Expert"
                  },
                  {
                      name: "Markus Gylling",
                      company: "International Digital Publishing Forum (IDPF)",
                      companyURL: "https://www.idpf.org"
                  },
                  {
                      name: "William McCoy",
                      company: "International Digital Publishing Forum (IDPF)",
                      companyURL: "https://www.idpf.org"
                  }
              ],
              processVersion: 2017,
              includePermalinks: true,
              permalinkEdge:     true,
              permalinkHide:     false,
              diffTool:          "http://www.aptest.com/standards/htmldiff/htmldiff.pl",
			  github:			 {
				  repoURL: "https://github.com/w3c/publ-epub-revision",
				  branch: "master"
			  },
              localBiblio: biblio,
              preProcess: [fixDefinitionCrossrefs, addConformanceLinks],
              postProcess: [fixCopyright]
          };
      </script>
	</head>
	<body>
		<section id="abstract">
			<p>This specification defines profiles of HTML, SVG, and CSS for use in the context of <a
					data-lt="EPUB Publication">EPUB® Publications</a>.</p>
			<p>This specification is one of a <a href="epub-spec.html#sec-intro-epub-specs">family of specifications</a>
				that compose [[EPUB32]], an interchange and delivery format for digital publications based on XML and
				Web Standards. It is meant to be read and understood in concert with the other specifications that make
				up EPUB 3.</p>
			<p>Refer to [[EPUB32Changes]] for more information on the differences between this specification and its
				predecessor.</p>
		</section>
		<section id="sotd"></section>
		<section id="sec-introduction">
			<h1>Introduction</h1>

			<section id="sec-overview-relations" class="informative">
				<h2>Relationship to Other Specifications</h2>

				<section id="sec-overview-relations-html">
					<h3>Relationship to HTML</h3>
					<p>This specification does not reference a specific version of W3C [[HTML]], but instead uses an
						undated reference that will always point to the latest recommendation. This approach ensures
						that EPUB will always keep pace with changes to the HTML standard. Authors and Reading System
						developers will need to keep track of changes to HTML, and ensure that their processes and
						systems are kept up to date.</p>

					<div class="caution">
						<p>As HTML evolves, it is possible that features that were valid in previous versions could
							become obsolete or be removed. It is anticipated that the W3C will make any such changes
							carefully to ensure minimal disruption for Authors, but in the case of a
							backwards-incompatible revision the use of an undated reference could be revisited.</p>
					</div>


					<p>The <a href="#sec-xhtml">XHTML profile defined by this specification</a> inherits all definitions
						of semantics, structure and processing behaviors from [[HTML]] unless otherwise specified.</p>
					<p>In addition, this specification <a href="#sec-xhtml-extensions">defines a set of extensions</a>
						to the W3C HTML document model that <a>Authors</a> can include in <a>XHTML Content
						Documents</a>.</p>
					<p>This specification does not require <a>EPUB Reading Systems</a> to support scripting, HTML forms
						or the HTML DOM. Reading Systems conformant with this specification are only expected to be able
						to process a conforming <a>EPUB Content Document</a>. As <a href="#sec-scripted-content-rs-reqs"
							>support for scripting and HTML forms</a> is not compulsory, a conformant Reading System
						might not be a fully-conformant HTML user agent.</p>
				</section>

				<section id="sec-overview-relations-svg">
					<h3>Relationship to SVG</h3>
					<p>This specification does not reference a specific version of [[SVG]], but instead uses an undated
						reference. Whenever there is any ambiguity in this reference, the latest recommended
						specification is the authoritative reference.</p>
					<p>This approach ensures that EPUB will always keep pace with changes to the SVG standard. Authors
						and Reading System developers will need to keep track of changes to the SVG standard, and ensure
						that their processes and systems are kept up to date.</p>

					<div class="caution">
						<p>As SVG evolves, it is possible that features that were valid in previous versions could
							become obsolete or be removed. It is anticipated that the W3C will make any such changes
							carefully to ensure minimal disruption for Authors, but in the case of a
							backwards-incompatible revision the use of an undated reference could be revisited.</p>
					</div>
				</section>

				<section id="sec-overview-relations-css">
					<h3>Relationship to CSS</h3>
					<p>EPUB 3 supports CSS as defined by the CSS Working Group Snapshot [[CSSSnapshot]]. EPUB 3 also
						maintains some prefixed CSS properties, to ensure consistent support for global languages.</p>
				</section>
			</section>

			<section id="sec-terminology">
				<h2>Terminology</h2>
				<p>Terms with meanings specific to EPUB 3 are capitalized in this document (e.g., "Author", "Reading
					System"). A complete list of these <a href="epub-spec.html#sec-terminology">terms and
						definitions</a> is provided in [[!EPUB32]].</p>
				<p>Only the first instance of a term in a section is linked to its definition.</p>
			</section>

			<section id="conformance"></section>

			<section id="sec-overview-pfx">
				<h2>Namespace prefix mapping</h2>
				<p>For convenience, the following namespace prefixes [[!XML-NAMES]] are used in this specification
					without explicitly being declared. To use any of these prefixes in an <a>EPUB Content Document</a>,
					a declaration is REQUIRED.</p>
				<table class="mapping">
					<tr>
						<th>prefix</th>
						<th>URI</th>
					</tr>
					<tr>
						<td><code>epub</code></td>
						<td><code>http://www.idpf.org/2007/ops</code></td>
					</tr>
					<tr>
						<td><code>ssml</code></td>
						<td><code>https://www.w3.org/2001/10/synthesis</code></td>
					</tr>
				</table>
			</section>
		</section>
		<section id="sec-xhtml">
			<h1>XHTML Content Documents</h1>

			<section id="sec-xhtml-intro">
				<h2>Introduction</h2>

				<p>This section defines a profile of [[!HTML]] for creating XHTML Content Documents. An instance of an
					XML document that conforms to this profile is a <a>Core Media Type Resource</a> and is referred to
					in this specification as an <a>XHTML Content Document</a>.</p>

				<p>Unless otherwise specified, this specification inherits all definitions of semantics, structure and
					processing behaviors from the [[!HTML]] specification.</p>
			</section>

			<section id="sec-xhtml-conf-content">
				<h2>Content Conformance</h2>

				<p>An <a>XHTML Content Document</a> MUST meet all of the following criteria:</p>

				<dl class="conformance-list">
					<dt id="confreq-cd-html-docprops">Document Properties</dt>
					<dd><p id="confreq-cd-html-docprops-syntax">It MUST be an [[!HTML]] document that conforms to the <a
								href="https://www.w3.org/TR/html/xhtml.html#xhtml">XHTML</a> syntax.</p><p
							id="confreq-cd-html-xml">It MUST meet the conformance constraints for XML documents defined
							in <a href="epub-spec.html#sec-xml-constraints">XML Conformance</a> [[!EPUB32]].</p><p
							id="confreq-cd-html-docprops-html">For all document constructs used that are defined by
							[[!HTML]], it MUST conform to the conformance criteria defined for those constructs in that
							specification, unless explicitly overridden in <a href="#sec-xhtml-deviations">HTML
								Deviations and Constraints</a>.</p><p id="confreq-cd-html-docprops-schema">It MAY
							include extensions to the [[!HTML]] grammar as defined in <a href="#sec-xhtml-extensions"
								>HTML Extensions</a>, and MUST conform to all content conformance constraints defined
							therein.</p>
						<div class="note">
							<p>The recommendation that EPUB Publications follow the accessibility requirements in
								[[EPUBAccessibility]] applies to XHTML Content Documents. See <a
									href="epub-spec.html#sec-epub-a11y">Accessibility</a> [[EPUB32]].</p>
						</div>
					</dd>
					<dt id="confreq-cd-html-fileprops">File Properties</dt>
					<dd><p id="confreq-cd-xhtml-fileprops-name">The XHTML Content Document filename SHOULD use the file
							extension <code>.xhtml</code></p></dd>
				</dl>
			</section>

			<section id="sec-xhtml-conf-rs">
				<h2>Reading System Conformance</h2>
				<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for processing
						<a>XHTML Content Documents</a>:</p>
				<ul class="conformance-list">
					<li><p id="confreq-html-rs-behavior">Unless explicitly defined by this specification as overridden,
							it MUST process XHTML Content Documents using semantics defined by the [[!HTML]]
							specification and honor any applicable user agent conformance constraints expressed
							therein.</p></li>
					<li><p id="confreq-html-rs-behavior-add">It MUST meet all Reading System conformance criteria
							defined in <a href="#sec-xhtml-extensions">HTML Extensions</a>.</p></li>
					<li><p id="confreq-html-rs-behavior-restr">It MUST recognize and adapt behaviorally to the
							constraints defined in <a href="#sec-xhtml-deviations">HTML Deviations and
							Constraints</a>.</p></li>
					<li><p id="confreq-html-rs-scrpt">It MUST meet the Reading System conformance criteria defined in <a
								href="#sec-scripted-content-rs-reqs">Scripted Content Documents — Reading System
								Conformance</a>.</p></li>
					<li><p id="confreq-html-rs-css">It MUST support visual rendering of XHTML Content Documents as
							defined in <a href="#sec-css-rs-conf">CSS Style Sheets — Reading System
						Conformance</a>.</p></li>
					<li><p id="confreq-html-rs-a11y">It SHOULD recognize embedded ARIA markup and support exposure of
							any given ARIA roles, states and properties to platform accessibility APIs
							[[!WAI-ARIA]].</p></li>
				</ul>
			</section>

			<section id="sec-xhtml-extensions">
				<h2>HTML Extensions</h2>

				<p>This section defines EPUB 3 <a>XHTML Content Document</a> extensions to the underlying [[!HTML]]
					document model.</p>

				<div class="note">
					<p>Although [[HTML]] allows user agents to support <a
							href="https://www.w3.org/TR/html5/infrastructure.html#conformance-requirements-extensibility"
							>vendor-neutral extensions</a>, unless such extensions are listed in this section they are
						not supported features of EPUB 3.</p>
				</div>

				<section id="sec-xhtml-semantic-inflection">
					<h3>Semantic Inflection</h3>

					<section id="sec-xhtml-semantic-inflection-intro" class="informative">
						<h4>Introduction</h4>
						<p>Semantic inflection is the process of attaching additional meaning about the specific purpose
							and/or nature an element plays in an <a>XHTML Content Document</a>. The <a
								href="#sec-epub-type-attribute"><code>epub:type</code> attribute</a> is used to express
							domain-specific semantics in XHTML Content Documents, with the inflection(s) it carries
							complementing the underlying [[HTML]] vocabulary.</p>
						<p>The applied semantics are intended to refine the meaning of their containing elements; they
							are not provided to override their nature (e.g., the attribute can be used to indicate a
								<code>section</code> is a chapter in a work, but is not designed to turn <code>p</code>
							elements into list items to avoid proper list structures).</p>
						<p>Semantic metadata is intended to enrich content for use in publishing workflows 
						and for author-defined purposes. While it also allows Reading Systems to learn more 
						about the structure and content of a document, no specific behaviors are defined 
						for the semantics by this specification. 
						Any such behaviors are Reading System-dependent.</p>
						<p>This specification defines a method for semantic inflection using <em>the attribute
							axis</em>: instead of adding new elements, the <code>epub:type</code> attribute can be
							appended to existing elements to inflect the desired semantics. A mechanism to identify
							external vocabularies that provide controlled values for the attributes is also defined.</p>
					</section>

					<section id="sec-epub-type-attribute">
						<h4>The <code>epub:type</code> Attribute</h4>

						<dl class="elemdef" id="attrdef-epub-type">
							<dt>Attribute Name</dt>
							<dd><p><code>type</code></p></dd>
							<dt>Namespace</dt>
							<dd><p><code>http://www.idpf.org/2007/ops</code></p></dd>
							<dt>Usage</dt>
							<dd><p><a href="https://www.w3.org/TR/html/dom.html#global-attributes">Global attribute</a>.
									MAY be specified on all elements.</p></dd>
							<dt>Value</dt>
							<dd><p>A white space-separated list of <a href="epub-packages.html#sec-property-datatype"
										>property</a> [[!Packages32]] values, with restrictions as defined in <a
										href="#sec-contentdocs-vocab-association">Vocabulary Association</a>.</p>
								<p>White space is the set of characters as defined in [[!XML]].</p></dd>
						</dl>
						<p>The <code>epub:type</code> attribute inflects semantics on the element on which it appears.
							Its value is one or more white space-separated terms stemming from external vocabularies
							associated with the document instance, as defined in <a
								href="#sec-contentdocs-vocab-association">Vocabulary Association</a>.</p>
						<p>The inflected semantic MUST express a subclass of the semantic of the carrying element. In
							the case of semantically neutral elements, such as the [[!HTML]] <a
								href="https://www.w3.org/TR/html/grouping-content.html#the-div-element"
								><code>div</code></a> and <a
								href="https://www.w3.org/TR/html/textlevel-semantics.html#the-span-element"
									><code>span</code></a> elements, the inflected semantic MUST NOT attach a meaning
							that is already conveyed by an existing element (e.g., that a <code>div</code> represents a
							paragraph or section). Reading Systems MUST <a href="#confreq-rs-epubtype-prec">ignore
								inflected semantics</a> that conflict with the carrying element.</p>
						<p>As the [[!HTML]] <a href="https://www.w3.org/TR/html/document-metadata.html#the-head-element"
									><code>head</code></a> element contains metadata for the document, structural
							semantics expressed on this element or any descendant of it have no meaning. Reading Systems
							MUST ignore such semantics.</p>

						<h4>Examples</h4>

						<aside class="example" id="ex.epubtype.note">
							<p>The following example shows how a preamble could be marked up with the
									<code>epub:type</code> attribute on its containing [[!HTML]] <code>section</code>
								element.</p>
							<pre>
&lt;html … xmlns:epub="http://www.idpf.org/2007/ops"&gt;
    …
    &lt;section epub:type="preamble"&gt;
        …    
    &lt;/section&gt;
    …
&lt;/html&gt;</pre>
						</aside>



						<aside class="example" id="ex.epubtype.gloss">
							<p>The following example shows the <code>epub:type</code> attribute used to add glossary
								semantics on an [[!HTML]] definition list.</p>
							<pre>
&lt;html … xmlns:epub="http://www.idpf.org/2007/ops"&gt;
    …
    &lt;dl epub:type="glossary"&gt;
        …    
    &lt;/dl&gt;        
    …
&lt;/html&gt;</pre>
						</aside>



						<aside class="example" id="ex.epubtype.pg">
							<p>The following example shows the <code>epub:type</code> attribute used to add pagebreak
								semantics.</p>
							<pre>
&lt;html … xmlns:epub="http://www.idpf.org/2007/ops"&gt;
   …
  &lt;p&gt; … &lt;span epub:type="pagebreak" id="p234"/&gt; … &lt;/p&gt;    
   … 
&lt;/html&gt;</pre>
						</aside>

					</section>

					<section id="sec-contentdocs-vocab-association">
						<h4>Vocabulary Association</h4>

						<p>This specification adopts the vocabulary association mechanisms defined in <a
								href="epub-packages.html#sec-metadata-assoc">Vocabulary Association Mechanisms</a>
							[[!Packages32]], with the following modifications:</p>

						<section id="sec-contentdocs-default-vocab">
							<h5>Default Vocabulary</h5>

							<p>The default vocabulary for Content Documents is defined to be the [[!EPUB-SSV]].
								Unprefixed terms that are not part of the [[!EPUB-SSV]] MAY be included, but their use
								is discouraged. The use of prefixes is the preferred method for adding custom
								semantics.</p>
						</section>

						<section id="sec-contentdocs-reserved-prefixes">
							<h5>Reserved Prefixes</h5>

							<p>Authors MAY use the following reserved prefixes in the <code>epub:type</code> attribute
								without having to declare them.</p>

							<p class="warning">Although reserved prefixes are an authoring convenience, reliance on them
								can lead to interoperability issues. Validation tools will often reject new prefixes
								until the tools are updated, for example. Authors are strongly encouraged to declare all
								prefixes they use to avoid such issues.</p>

							<table id="tbl-reserved-prefixes" class="prefix">
								<thead>
									<tr>
										<th>Prefix</th>
										<th>IRI</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>msv</td>
										<td>http://www.idpf.org/epub/vocab/structure/magazine/#</td>
									</tr>
									<tr>
										<td>prism</td>
										<td>http://www.prismstandard.org/specifications/3.0/PRISM_CV_Spec_3.0.htm#</td>
									</tr>
								</tbody>
							</table>
						</section>

						<section id="sec-contentdocs-prefix-attr">
							<h5>The prefix Attribute</h5>

							<p>The <code>prefix</code> attribute definition is unchanged, but the attribute is defined
								to be in the namespace <code>http://www.idpf.org/2007/ops</code> when used in EPUB
								Content Documents.</p>

							<p>The <code>prefix</code> attribute is only valid on the [[!HTML]] root <code>html</code>
								element.</p>
						</section>
					</section>

					<section id="sec-contentdocs-semantic-inflection-processing-reqs">
						<h4>Processing Requirements</h4>

						<p>A Reading System MUST process the <code>epub:type</code> attribute as follows:</p>

						<ul class="conformance-list">
							<li><p id="confreq-rs-epubtype-beh">It MAY associate behaviors with none, some or all of the
									terms defined in the <a href="#sec-contentdocs-default-vocab">default
									vocabulary</a>.</p></li>
							<li><p id="confreq-rs-epubtype-oth">It MAY associate behaviors with terms from other
									vocabularies.</p></li>
							<li><p id="confreq-rs-epubtype-ign">It MUST ignore terms that it does not
								recognize.</p></li>
						</ul>

						<p id="confreq-rs-epubtype-prec">When Reading System behavior associated with a given
								<code>epub:type</code> value conflicts with an element's native behavior, the behavior
							associated with the element MUST be given precedence.</p>
					</section>
				</section>

				<section id="sec-xhtml-semantic-enrichment">
					<h3>Semantic Enrichment</h3>

					<section id="sec-xhtml-semantic-enrichment-intro" class="informative">
						<h4>Introduction</h4>

						<p>Unlike <a href="#sec-xhtml-semantic-inflection">semantic inflection</a>, which is about
							refining the structures within the markup, semantic enrichment enables the layering of
							meaning into the content in order to facilitate machine processing.</p>

						<p>The [[Microdata]] and [[RDFA-CORE]] specifications both define sets of attributes that can be
							used in <a>XHTML Content Documents</a> to semantically enrich the content.</p>
					</section>

					<section id="sec-xhtml-sementic-enrichment-rdfa">
						<h4>RDFa</h4>

						<p>The use of [[!RDFA-CORE]] attributes is allowed in <a>XHTML Content Documents</a>, but any
							usage MUST conform to the requirements defined in [[!HTML-RDFA]].</p>
	
						<p>The [[!RDFA-CORE]] specification defines changes to the [[!HTML]] content model when RDFa
							attributes are used. This modified content model is valid in XHTML Content Documents.</p>

						<p><a>EPUB Reading System</a> support for the <a
								href="https://www.w3.org/TR/2015/REC-rdfa-core-20150317/#s_model">attribute processing
								model</a> [[!RDFA-CORE]] is OPTIONAL.</p>
					</section>

					<section id="sec-xhtml-sementic-enrichment-microdata">
						<h4>Microdata</h4>

						<p>The use of [[!Microdata]] attributes is allowed in <a>XHTML Content Documents</a>, but any
							usage MUST conform to the requirements defined in that specification.</p>

						<p>The [[!Microdata]] specification defines changes to the [[!HTML]] content model when
							Microdata attributes are used. This modified content model is valid in XHTML Content
							Documents.</p>

						<p><a>EPUB Reading System</a> support for the <a
								href="https://www.w3.org/TR/microdata/#encoding-microdata">attribute processing
								model</a> is OPTIONAL, as is the <a href="https://www.w3.org/TR/microdata/#json"
								>conversion to JSON</a> [[!Microdata]].</p>
					</section>
				</section>

				<section id="sec-xhtml-ssml-attrib">
					<h3>SSML Attributes</h3>

					<section id="sec-cd-ssml-intro">
						<h4>Introduction</h4>

						<p>The W3C Speech Synthesis Markup Language [[!SSML]] is a language used for assisting
								<a>Text-to-Speech</a> (TTS) engines in generating synthetic speech. Although SSML is
							designed as a standalone document type, it also defines semantics suitable for use within
							other markup languages.</p>

						<p>This specification recasts the [[!SSML]] <a
								href="https://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.10"
									><code>phoneme</code> element</a> as two attributes — <code>ssml:ph</code> and
								<code>ssml:alphabet</code> — and makes them available within XHTML Content
							Documents.</p>

						<p>Reading Systems with <a>Text-to-Speech</a> (TTS) capabilities SHOULD support the SSML
							Attributes as defined below.</p>

						<div class="note">
							<p>For more information on EPUB 3 features related to synthetic speech, refer to <a
									href="epub-overview.html#sec-tts">Text-to-speech</a> [[EPUB3Overview]].</p>
						</div>

					</section>

					<section id="sec-cd-ssml-ph-attrib">
						<h4>The <code>ssml:ph</code> attribute</h4>

						<p>The <code>ssml:ph</code> attribute specifies a phonemic/phonetic pronunciation of the text
							represented by the element to which the attribute is attached.</p>

						<dl class="elemdef" id="attrdef-ssml-ph">
							<dt>Attribute Name</dt>
							<dd><p><code>ph</code></p></dd>
							<dt>Namespace</dt>
							<dd><p><code>https://www.w3.org/2001/10/synthesis</code></p></dd>
							<dt>Usage</dt>
							<dd><p><a href="https://www.w3.org/TR/html/dom.html#global-attributes">Global attribute</a>.
									MAY be specified on all elements with which a phonetic equivalent can logically be
									associated (e.g., elements that contain textual information).</p>
								<p>MUST NOT be specified on a descendant of an element that already carries this
									attribute.</p></dd>
							<dt>Value</dt>
							<dd><p>A phonemic/phonetic expression, syntactically valid with respect to <a
										href="#sec-cd-ssml-alphabet-attrib">the phonemic/phonetic alphabet being
										used</a>.</p></dd>
						</dl>

						<p>This attribute inherits all the semantics of the [[!SSML]] <code>phoneme</code> element <a
								href="https://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.10"
									><code>ph</code></a> attribute, with the following addition:</p>

						<ul class="conformance-list">
							<li><p id="ssml-ph-concat">When the <code>ssml:ph</code> attribute appears on an element
									that has text node descendants, the corresponding document text to which the
									pronunciation applies is the string that results from concatenating the descendant
									text nodes, in document order. The specified phonetic pronunciation MUST therefore
									logically match the element's textual data in its entirety (i.e., not just an
									isolated part of its content).</p></li>
						</ul>

						<p>Reading Systems that support the SSML Attributes and <a href="#sec-pls">PLS documents</a>
							MUST honor the defined <a href="#confreq-pls-rs-casc">precedence rules</a> for these two
							constructs.</p>
					</section>

					<section id="sec-cd-ssml-alphabet-attrib">
						<h4>The <code>ssml:alphabet</code> attribute</h4>

						<p>The <code>ssml:alphabet</code> attribute specifies which phonemic/phonetic pronunciation
							alphabet is used in the value of the <a href="#attrdef-ssml-ph"><code>ssml:ph</code></a>
							attribute.</p>

						<dl class="elemdef" id="attrdef-ssml-alphabet">
							<dt>Attribute Name</dt>
							<dd><p><code>alphabet</code></p></dd>
							<dt>Namespace</dt>
							<dd><p><code>https://www.w3.org/2001/10/synthesis</code></p></dd>
							<dt>Usage</dt>
							<dd><p><a href="https://www.w3.org/TR/html/dom.html#global-attributes">Global attribute</a>.
									MAY be specified on any element.</p></dd>
							<dt>Value</dt>
							<dd><p>The name of the pronunciation alphabet used in the value of <a
										href="#attrdef-ssml-ph"><code>ssml:ph</code></a> (inherited).</p></dd>
						</dl>

						<p>This attribute inherits all the semantics of the [[!SSML]] <code>phoneme</code> element <a
								href="https://www.w3.org/TR/2010/REC-speech-synthesis11-20100907/#S3.1.10"
									><code>alphabet</code></a> attribute, with the following addition:</p>

						<ul class="conformance-list">
							<li><p id="ssml-alphabet-inherit">The value of the <code>ssml:alphabet</code> attribute is
									inherited in the document tree. The pronunciation alphabet used in a given
										<code>ssml:ph</code> attribute value is determined by locating the first
									occurrence of the <code>ssml:alphabet</code> attribute starting with the element on
									which the <code>ssml:ph</code> attribute appears, followed by the nearest ancestor
									element.</p></li>
						</ul>

						<div class="note">
							<p>Although the [[SSML]] specification makes reference to a registry of alphabets, one has
								not been published. As the charter of the W3C Voice Browser Working Group has expired,
								the publication of such a registry is not anticipated. Authors therefore need to
								reference Reading System support documentation to determine what alphabet values are
								supported. Some common alphabets include: x-JEITA (also x-JEITA-IT-4002 and
								x-JEITA-IT-4006) and x-sampa.</p>
						</div>

						<p>Reading Systems that support the <a href="#sec-xhtml-ssml-attrib">SSML Attributes</a> feature
							of this specification SHOULD support the IPA alphabet [[!IPA]], as expressed by the value
								"<code>ipa</code>".</p>
					</section>
				</section>

				<section id="sec-xhtml-content-switch">
					<h3>Content Switching (Deprecated)</h3>

					<p>The <code>switch</code> element provides a simple mechanism through which <a>Authors</a> can
						tailor the content displayed to users, one that is not dependent on the scripting capabilities
						of the <a>EPUB Reading System</a>.</p>

					<p>Use of the <code>switch</code> element is <a href="epub-spec.html#deprecated">deprecated</a>.
						Refer to its definition in [[!ContentDocs301]] for usage information.</p>
				</section>

				<section id="sec-xhtml-epub-trigger">
					<h3>The <code>epub:trigger</code> Element (Deprecated)</h3>

					<p>The <code>trigger</code> element enables the creation of markup-defined user interfaces for
						controlling multimedia objects, such as audio and video playback, in both scripted and
						non-scripted contexts.</p>

					<p>Use of the <code>trigger</code> element is <a href="epub-spec.html#deprecated">deprecated</a>.
						Refer to its definition in [[!ContentDocs301]] for usage information.</p>
				</section>

				<section id="sec-xhtml-custom-attributes">
					<h3>Custom Attributes</h3>

					<p><a>Reading Systems</a> MAY introduce functionality not defined in this specification to enhance
						the rendering of <a>EPUB Publications</a>. To facilitate this experimentation, vendors MAY
						define custom attributes for use in <a>XHTML Content Documents</a>.</p>

					<p>Custom attributes MAY be included on any element in an XHTML Content Document provided such
						attributes are from a foreign namespace, which is defined as a namespace [[!XML-NAMES]] that
						does not map to either of the following URIs:</p>

					<ul>
						<li>
							<p><code>http://www.w3.org/1999/xhtml</code></p></li>
						<li>
							<p><code>http://www.idpf.org/2007/ops</code></p></li>
					</ul>

					<p>Custom attributes, and the behaviors associated with them, MUST NOT alter the integrity of an
						EPUB Publication. The content MUST remain consumable by a user without any information loss or
						other significant deterioration, regardless of the Reading System it is rendered on.</p>

					<div class="note">
						<p>To facilitate interoperability of custom attributes across Reading Systems, vendors are
							strongly encouraged to document any extensions they implement in
							[[AttributeExtensions]].</p>
					</div>
				</section>
			</section>

			<section id="sec-xhtml-deviations">
				<h2>HTML Deviations and Constraints</h2>

				<p>This section defines deviations from, and constraints on, the underlying [[!HTML]] document model
					applicable to EPUB 3 <a>XHTML Content Documents</a>.</p>

				<section id="sec-xhtml-mathml">
					<h3>Embedded MathML</h3>

					<section id="sec-xhtml-mathml-intro" class="informative">
						<h4>Introduction</h4>

						<p>XHTML Content Documents support embedded [[MATHML3]] but limit its usage to a restricted
							subset of the full MathML markup language.</p>

						<p>This subset is designed to ease the implementation burden on Reading Systems and to promote
							accessibility, while retaining compatibility with [[HTML]] user agents.</p>

						<div class="note">
							<p>The <a href="epub-packages.html#mathml"><code>mathml</code> property</a> of the
									<a>manifest</a>
								<code>item</code> element indicates that an XHTML Content Document contains embedded
								MathML.</p>
						</div>

					</section>

					<section id="sec-xhtml-mathml-conf-content">
						<h4>Content Conformance</h4>

						<p>Any occurrence of MathML markup in XHTML Content Documents MUST conform to the constraints
							expressed in the MathML specification [[!MATHML3]], with the following additional
							restrictions:</p>

						<dl class="conformance-list">
							<dt id="math-pres">Presentation MathML</dt>
							<dd><p id="confreq-mathml-pres">The <code>math</code> element MUST contain only <a
										href="https://www.w3.org/TR/MathML3/chapter3.html">Presentation MathML</a>, with
									the exception of the <code>annotation-xml</code> element.</p></dd>
							<dt id="math-cont">Content MathML</dt>
							<dd><p id="confreq-mathml-annot-cont"><a href="https://www.w3.org/TR/MathML3/chapter4.html"
										>Content MathML</a> MAY be included within MathML markup in XHTML Content
									Documents, and, when present, MUST occur within an <code>annotation-xml</code> child
									element of a <code>semantics</code> element.</p><p
									id="confreq-mathml-annot-cont-attrs">When Content MathML is included as per the
									previous condition, the given <code>annotation-xml</code> element's
										<code>encoding</code> attribute MUST be set to either of the
									functionally-equivalent values <code>MathML-Content</code> or
										<code>application/mathml-content+xml</code>, and its <code>name</code> attribute
									MUST be set to <code>contentequiv</code>.</p></dd>
							<dt id="math-deprecated">Deprecated MathML</dt>
							<dd><p id="confreq-mathml-deprecated">Elements and attributes marked as deprecated in
									[[!MATHML3]] MUST NOT be included within MathML markup in XHTML Content
									Documents.</p></dd>
						</dl>
					</section>

					<section id="sec-xhtml-mathml-rs-conf">
						<h4>Reading System Conformance</h4>
						<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for
							supporting MathML embedded in XHTML Content Documents:</p>
						<ul class="conformance-list">
							<li><p id="confreq-mathml-rs-behavior">It MUST be an input-compliant renderer for <a
										href="https://www.w3.org/TR/MathML3/chapter3.html">Presentation MathML</a>, as
									defined in the [[!MATHML3]] specification.</p></li>
							<li><p id="confreq-mathml-rs-anno">It MAY support rendering of <a
										href="https://www.w3.org/TR/MathML3/chapter4.html">Content MathML</a> found in
										<code>annotation-xml</code> elements.</p></li>
							<li><p id="confreq-mathml-rs-render">If it has a <a>Viewport</a>, it MUST support visual
									rendering of Presentation MathML.</p></li>
						</ul>
						<p class="note"> EPUB Reading Systems may choose to use third-party libraries such as MathJax to
							provide MathML rendering. </p>
					</section>






				</section>

				<section id="sec-xhtml-svg">
					<h3>Embedded SVG</h3>

					<p><a>XHTML Content Documents</a> support the embedding of <a
							href="https://www.w3.org/TR/SVG/conform.html#ConformingSVGXMLFragments">SVG document
							fragments</a> [[!SVG]] <em>by reference</em> (embedding via reference, for example, from an
							<code>img</code> or <code>object</code> element) and <em>by inclusion</em> (embedding via
						direct inclusion of the <code>svg</code> element in the XHTML Content Document).</p>

					<p>The content conformance constraints for SVG embedded in XHTML Content Documents are the same as
						defined for <a>SVG Content Documents</a> in <a href="#sec-svg-restrictions">Restrictions on
							SVG</a>.</p>

					<p>Reading Systems MUST process SVG embedded in XHTML Content Documents as defined in <a
							href="#sec-svg-rs-conf">SVG Content Documents — Reading System Conformance</a>.</p>

					<div class="note">
						<p>The <a href="epub-packages.html#svg"><code>svg</code> property</a> of the <a>manifest</a>
							<a href="epub-packages.html#sec-item-elem"><code>item</code> element</a> [[Packages32]]
							indicates that an XHTML Content Document contains embedded SVG.</p>
					</div>



					<section id="sec-xhtml-svg-css">
						<h4>Embedded SVG and CSS</h4>
						<p id="confreq-svg-rs-css-embed-ref">For the purposes of styling SVG embedded in XHTML Content
							Documents <em>by reference</em>, Reading Systems MUST NOT apply CSS style rules of the
							containing document to the referenced SVG document.</p>
						<p id="confreq-svg-rs-css-embed-inc">For the purposes of styling SVG embedded in XHTML Content
							Documents <em>by inclusion</em>, Reading Systems MUST apply applicable CSS rules of the
							containing document to the included SVG elements.</p>

						<div class="note">
							<p>SVG included <em>by reference</em> is processed as a separate document, and can include
								its own CSS style rules just like an <a>SVG Content Document</a> would. Note that this
								is consistent with situations where an [[HTML]] <a
									href="https://www.w3.org/TR/html/semantics-embedded-content.html#elementdef-object"
										><code>object</code></a> element references an external [[HTML]] element.</p>
						</div>

					</section>
				</section>

				<section id="sec-xhtml-deviations-unicode">
					<h3>Unicode Restrictions</h3>
					<p>This section lists restrictions on the Unicode character repertoire.</p>

					<dl class="variablelist">
						<dt>Private Use Characters and Embedded Fonts</dt>
						<dd><p id="confreq-html-unicode-pua">Any included characters that map to a code point within one
								of the Private Use Area (PUA) ranges as defined in [[!Unicode]] MUST occur within a
								string that is styled or attributed in a manner that includes a reference to an embedded
								font [[!CSS-Fonts-3]] that contains an appropriate glyph for that code point.</p></dd>
					</dl>
				</section>

				<section id="sec-xhtml-deviations-discouraged" class="informative">
					<h3>Discouraged Constructs</h3>

					<section id="sec-xhtml-deviations-rp">
						<h4>The <code>rp</code> Element</h4>
						<p id="confreq-html-vocab-rp">The [[HTML]] <a
								href="https://www.w3.org/TR/html/textlevel-semantics.html#the-rp-element"
									><code>rp</code></a> element is intended to provide a fallback for older <a>Reading
								Systems</a> that do not recognize ruby markup (i.e., a parenthesis display around
								<code>ruby</code> markup). As EPUB 3 Reading Systems are ruby-aware, and can provide
							fallbacks, the use of <code>rp</code> elements is discouraged.</p>
					</section>

					<section id="sec-xhtml-deviations-embed">
						<h4>The <code>embed</code> Element</h4>
						<p id="confreq-html-vocab-embed">Since the [[!HTML]] <a
								href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-embed-element"
									><code>embed</code></a> element does not include intrinsic facilities to provide
							fallback content for Reading Systems that do not support scripting, <a>Authors</a> are
							discouraged from using the element when the referenced resource includes scripting. The
							[[!HTML]] <a
								href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-object-element"
									><code>object</code> element</a> can be used instead, as it includes intrinsic
							fallback capabilities.</p>
					</section>
				</section>

				<section id="sec-xhtml-fallbacks">
					<h3>Foreign Resource Restrictions</h3>

					<p id="confreq-resources-cd-fallback">Foreign Resources MAY be referenced from elements that have
						intrinsic fallback mechanisms, where an intrinsic fallback method is the capability to offer an
						alternative presentation if the foreign resource is not supported. For example, most [[!HTML]]
							<a href="https://www.w3.org/TR/html/dom.html#embedded-content">embedded content elements</a>
						provide options for alternative rendering, such as allowing multiple sources to be specified or
						allowing embedded HTML content for when a resource cannot be rendered. A <a>Core Media Type
							Resource</a> or embedded HTML content MUST be provided via the given element's intrinsic
						fallback mechanism when a Foreign Resource is referenced.</p>

					<p id="confreq-resources-cd-fallback-media">[[!HTML]] <a
							href="https://www.w3.org/TR/html/dom.html#flow-content">flow content</a> MAY be embedded
						within the <a
							href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-audio-element"
								><code>audio</code></a> and <a
							href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-video-element"
								><code>video</code></a> elements for rendering in older Reading Systems that do not
						recognize these elements (e.g., EPUB 2 Reading Systems), but it does not represent a fallback
						Core Media Type Resource.</p>

					<p id="confreq-resources-cd-fallback-img">Due to the variety of sources that can be associated with
						to the [[!HTML]] <a
							href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-img-element"
								><code>img</code> element</a>, the following fallback conditions apply to its use:</p>

					<ul>
						<li><p>If it is the child of a <a
									href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-picture-element"
										><code>picture</code> element</a>:</p>
							<ul>
								<li>it MUST reference Core Media Type Resources from its <code>src</code> and
										<code>srcset</code> attributes, when those attributes are specified; and</li>
								<li>each sibling <a
										href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-source-element"
											><code>source</code> element</a> MUST reference a Core Media Type Resource
									from its <code>src</code> and <code>srcset</code> attributes unless it specifies a
									media type in its <code>type</code> attribute that is not a Core Media Type.</li>
							</ul>
						</li>
						<li>Otherwise, it MAY reference Foreign Resources in its <code>src</code> and
								<code>srcset</code> attributes provided <a
								href="epub-packages.html#sec-foreign-restrictions-manifest">manifest fallbacks</a>
							[[Packages32]] are defined.</li>
					</ul>

					<p>The following [[!HTML]] elements can refer to <a href="epub-spec.html#sec-core-media-types"
							>Foreign Resources</a> [[!EPUB32]] without having to provide a fallback Core Media Type
						Resource:</p>

					<ul>
						<li><p id="confreq-resources-cd-fallback-link"><a
									href="https://www.w3.org/TR/html/document-metadata.html#the-link-element"
										><code>link</code></a> — when its <code>rel</code> attribute has <a
									href="#confreq-cd-pls-assoc">the value "<code>pronunciation</code>"</a></p></li>
						<li><p id="confreq-resources-cd-fallback-track"><a
									href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-track-element"
										><code>track</code></a></p></li>
						<li><p id="confreq-resources-cd-fallback-video"><a
									href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-video-element"
										><code>video</code></a> — including any child <a
									href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-source-element"
										><code>source</code></a> elements</p></li>
					</ul>

					<p>Foreign Resources MAY be referenced from the preceding three elements without the provision of a
						fallback Core Media Type Resource.</p>

					<div class="note">
						<p>Refer to <a href="epub-packages.html#sec-foreign-restrictions-manifest">manifest
								fallbacks</a> [[Packages32]] for the provision of fallbacks for elements without
							intrinsic mechanisms, such as the [[HTML]] <a
								href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-iframe-element"
									><code>iframe</code></a>.</p>
					</div>
				</section>

				<section id="sec-xhtml-forms">
					<h3>Form Submission</h3>

					<p><a>Reading System</a> support for the submission of [[!HTML]] forms is OPTIONAL. A Reading System
						might, for example, prevent form submissions by limiting access to networking.</p>
				</section>
			</section>
		</section>
		<section id="sec-svg">
			<h1>SVG Content Documents</h1>

			<div class="caution">
				<p>Some features of [[!SVG]] are not fully supported in <a>Reading Systems</a>, or supported across all
					platforms on which Reading Systems run. When utilizing such features, <a>Authors</a> need to
					consider the inherent risks in terms of the potential impact on interoperability and document
					longevity.</p>
			</div>



			<section id="sec-svg-intro" class="informative">
				<h2>Introduction</h2>

				<p>The Scalable Vector Graphics (SVG) specification [[SVG]] defines a format for representing final-form
					vector graphics and text.</p>

				<p>Although an EPUB Publication typically uses <a href="#sec-xhtml">XHTML Content Documents</a> as the
						<a data-lt="Top-level Content Document">top-level</a> document type, the use of <a>SVG Content
						Documents</a> is also permitted. SVGs are typically only used in certain special circumstances,
					such as when final-form page images are the only suitable representation of the content (e.g., for
					cover art or in the context of manga or comic books).</p>

				<p>This section defines a profile for [[SVG]] documents. An instance of an XML document that conforms to
					this profile is a <a>Core Media Type Resource</a> and is referred to in this specification as an
						<a>SVG Content Document</a>.</p>

				<div class="note">
					<p>This section defines conformance requirements for <a>SVG Content Documents</a>. Refer to <a
							href="#sec-xhtml-svg">Embedded SVG</a> for the conformance requirements for SVG embedded in
						XHTML Content Documents.</p>
				</div>

			</section>

			<section id="sec-svg-content-conf">
				<h2>Content Conformance</h2>
				<p>An <a>SVG Content Document</a> MUST meet all of the following criteria:</p>

				<dl class="conformance-list">
					<dt id="confreq-svg-docprops">Document Properties</dt>
					<dd><p id="confreq-cd-svg-xml">It MUST meet the conformance constraints for XML documents defined in
								<a href="epub-spec.html#sec-xml-constraints">XML Conformance</a> [[!EPUB32]].</p>
						<p id="confreq-resources-svg-fallback">It MAY include references to <a>Foreign Resources</a>
							provided a fallback to a <a>Core Media Type Resource</a> is included.</p>
						<p id="confreq-cd-svg-docprops-schema">It MUST be an <a
								href="https://www.w3.org/TR/SVG/intro.html#TermSVGDocumentFragment">SVG document
								fragment</a> [[!SVG]], and conform to all content conformance constraints expressed in
								<a href="#sec-svg-restrictions">Restrictions on SVG</a>.</p>
						<div class="note">
							<p>The recommendation that EPUB Publications follow the accessibility requirements in
								[[EPUBAccessibility]] applies to SVG Content Documents. See <a
									href="epub-spec.html#sec-epub-a11y">Accessibility</a> [[EPUB32]].</p>
						</div>
					</dd>

					<dt id="confreq-svg-fileprops">File Properties</dt>
					<dd><p id="confreq-svg-fileprops-name">The SVG Content Document filename SHOULD use the file
							extension <code>.svg</code>.</p></dd>
				</dl>
			</section>

			<section id="sec-svg-restrictions">
				<h2>Restrictions on SVG</h2>

				<p>This specification restricts the content model of <a>SVG Content Documents</a> and <a
						href="#sec-xhtml-svg">SVG embedded in XHTML Content Documents</a> as follows:</p>

				<ul class="conformance-list">
					<li><p id="confreq-svg-foreignObject">The [[!SVG]] <a
								href="https://www.w3.org/TR/SVG/embedded.html#ForeignObjectElement"
									><code>foreignObject</code></a> element MUST adhere to the following
							criteria:</p><ul class="conformance-list">
							<li><p id="confreq-svg-foreignObject-xhtml-content">It MUST contain either [[!HTML]] <a
										href="https://www.w3.org/TR/html/dom.html#flow-content">flow content</a> or
									exactly one [[!HTML]] <a
										href="https://www.w3.org/TR/html/sections.html#the-body-element"
											><code>body</code> element</a>.</p>
								<p class="note">In the case of <a href="#sec-xhtml-svg">embedded SVGs</a>, a
										<code>body</code> element is not permitted per the <a
										href="https://www.w3.org/TR/html/semantics-embedded-content.html#svg"
										>restrictions on SVG</a> defined in [[HTML]].</p>
							</li>
							<li><p id="confreq-svg-foreignObject-xhtml-frag">Its content MUST be a valid document
									fragment that conforms to the XHTML Content Document model defined in <a
										href="#sec-xhtml-conf-content">XHTML Content Documents — Content
									Conformance</a>.</p></li>
							<li><p id="confreq-svg-foreignObject-reqext">Its <code>requiredExtensions</code> attribute,
									if given, MUST be set to "<code>http://www.idpf.org/2007/ops</code>".</p></li>
						</ul></li>
					<li><p id="confreq-svg-title">The [[!SVG]] <a
								href="https://www.w3.org/TR/SVG/struct.html#TitleElement"><code>title</code></a> element
							MUST contain only valid <a href="#confreq-cd-html-docprops">XHTML Content Document Phrasing
								content</a>.</p></li>
				</ul>
			</section>

			<section id="sec-svg-rs-conf">
				<h2>Reading System Conformance</h2>

				<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for processing SVG
					Content Documents and <a href="#sec-xhtml-svg">SVG embedded in XHTML Content Documents</a>:</p>

				<ul class="conformance-list">
					<li><p id="confreq-svg-rs-behavior">Unless explicitly defined by this specification as overridden,
							it MUST process SVG Content Documents using semantics defined by the [[!SVG]] specification
							and honor any applicable user agent conformance constraints expressed therein.</p></li>
					<li><p id="confreq-svg-rs-scrpt">It MUST meet the Reading System conformance criteria defined in <a
								href="#sec-scripted-content-rs-reqs">Scripted Content Documents — Reading System
								Conformance</a>.</p></li>
					<li><p id="confreq-svg-rs-css">If it has a <a>Viewport</a>, it MUST support the visual rendering of
							SVG using CSS as defined in <a href="https://www.w3.org/TR/SVG/styling.html">Styling</a>
							[[!SVG]], and it SHOULD support all properties defined in the <a
								href="https://www.w3.org/TR/SVG/propidx.html">Property Index</a> [[!SVG]]. In the case
							of embedded SVG, it MUST also conform to the constraints defined in <a
								href="#sec-xhtml-svg-css">Embedded SVG and CSS</a>.</p></li>
					<li><p id="confreq-svg-rs-text">It SHOULD support user selection and searching of text within SVG
							elements.</p></li>
					<li><p id="confreq-svg-rs-reqdExt">It MUST recognize the value
								"<code>http://www.idpf.org/2007/ops</code>" of the <code>requiredExtensions</code>
							attribute as representing the occurrence of XHTML Content Document fragments (e.g., when the
							attribute is included on the <code>foreignObject</code> element or children of the
								<code>switch</code> element).</p></li>
				</ul>
			</section>

			<section id="sec-svg-semantic-inflection">
				<h2>Semantic Inflection</h2>
				<p>The syntax and semantics defined in <a href="#sec-xhtml-semantic-inflection">XHTML Semantic
						Inflection</a> are inherited for use of the <a href="#attrdef-epub-type"
						><code>epub:type</code></a> and <a href="#sec-contentdocs-prefix-attr"
						><code>epub:prefix</code></a> attributes in <a>SVG Content Documents</a>.</p>
				<p>The use of the <code>epub:prefix</code> attribute is only valid on the root <code>svg</code> element
					in SVG Content Documents. Prefixes used in <a href="#sec-xhtml-svg">embedded SVG</a> MUST be
					declared on the [[!HTML]] root <a href="https://www.w3.org/TR/html/semantics.html#the-html-element"
							><code>html</code> element</a>, as defined in <a href="#sec-xhtml-semantic-inflection">XHTML
						Semantic Inflection</a>.</p>
			</section>
		</section>
		<section id="sec-css">
			<h1>CSS Style Sheets</h1>

			<section id="sec-css-intro" class="informative">
				<h2>Introduction</h2>
				<p>CSS is an integral part of the Open Web Platform. Readers, publishers, and document authors expect
					CSS to "just work," as they expect HTML to just work.</p>
				<p>In the past, EPUB defined a profile of CSS that mandated support for certain properties and provided
					prefixed versions of numerous other properties. Although the CSS Working Group no longer recommends
					the use of prefixed properties, this specification has to maintain some prefixed properties to avoid
					breaking existing content. But with the minor exceptions defined in this section, EPUB defers to the
					W3C to define CSS.</p>
			</section>

			<section id="sec-css-content-conf">
				<h2>Content Conformance</h2>
				<p>A conformant CSS style sheet MUST meet all of the following criteria:</p>
				<ul class="conformance-list">
					<li><p id="confreq-css-props">It MAY include any CSS properties, with the following
							exceptions:</p><ul class="conformance-list">
							<li><p id="confreq-css-props-exc-direction">It MUST NOT use the <a
										href="https://www.w3.org/TR/css3-writing-modes/#direction"
											><code>direction</code> property</a> [[!CSS-Writing-Modes-3]]. Use the
									[[!HTML]] <a href="https://www.w3.org/TR/html/dom.html#the-dir-attribute"
											><code>dir</code> attribute</a> to set the inline base direction.</p></li>
							<li><p id="confreq-css-props-exc-unicode-bidi">It MUST NOT use the <a
										href="https://www.w3.org/TR/css3-writing-modes/#unicode-bidi"
											><code>unicode-bidi</code> property</a> [[!CSS-Writing-Modes-3]]. Use
									[[!HTML]] <a
										href="https://www.w3.org/TR/html/textlevel-semantics.html#the-bdo-element"
											><code>bdo</code> elements</a> and <a
										href="https://www.w3.org/TR/html/dom.html#the-dir-attribute"><code>dir</code>
										attributes</a> to control bidirectionality.</p></li>
						</ul></li>
					<li><p id="confreq-css-prefixed">It MAY include the prefixed properties defined in <a
								href="#sec-css-prefixed">CSS Style Sheets — Prefixed Properties</a>.</p></li>
					<li><p id="confreq-css-encoding">It MUST be encoded in UTF-8 or UTF-16 [[!Unicode]].</p></li>
				</ul>

				<div class="note">
					<p>Keep in mind that some <a>Reading Systems</a> will not support all desired features of CSS. In
						particular, the following are known to be problematic:</p>
					<ul>
						<li>
							<p>Reading System-induced pagination can interact poorly with style sheets. Pagination is
								sometimes done using columns, which can result in incorrect values for viewport sizes.
								Fixed and absolute positioning are particularly problematic.</p></li>
						<li>
							<p>Some types of screens will render animations and transitions poorly (e.g., those with
								high latency).</p></li>
					</ul>
				</div>

			</section>

			<section id="sec-css-rs-conf">
				<h2>Reading System Conformance</h2>
				<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for processing CSS
					Style Sheets:</p>
				<ul class="conformance-list">
					<li><p id="confreq-css-rs-support">It MUST support the official definition of CSS as described in
							the [[!CSSSnapshot]].</p></li>
					<li><p id="confreq-css-rs-modules">It SHOULD support all applicable modules in [[!CSSSnapshot]] that
							have reached at least <a href="https://www.w3.org/2015/Process-20150901/#candidate-rec"
								>Candidate Recommendation</a> status [[!W3CProcess]] (and are widely
						implemented).</p></li>
					<li><p id="confreq-css-rs-fonts">It MUST support [[!TrueType]], [[!OpenType]], [[!WOFF]] and
							[[!WOFF2]] font resources referenced from <code>@font-face</code> rules.</p></li>
					<li><p id="confreq-css-rs-prefixed">It MUST support all prefixed properties defined in <a
								href="#sec-css-prefixed">CSS Style Sheets — Prefixed Properties</a>.</p></li>
					<li><p id="confreq-css-rs-html-default">In addition to supporting CSS properties as defined above,
							its user agent style sheet SHOULD support the [[!HTML]] <a
								href="https://www.w3.org/TR/html/rendering.html#rendering">suggested default
								rendering</a>.</p></li>
					<li><p id="confreq-css-rs-overrides">It SHOULD respect Author CSS and user styles as defined in <a
								href="#sec-css-rs-overrides">Reading System Overrides</a>.</p></li>
				</ul>
				<p>Reading System developers are encouraged to implement CSS support at the level of major browsers.</p>
			</section>

			<section id="sec-css-prefixed">
				<h2>Prefixed Properties</h2>

				<div class="caution">
					<p><a>Authors</a> are strongly encouraged to use unprefixed properties, and <a>Reading Systems</a>
						to support current CSS specifications. The widely-used prefixed properties from
						[[!ContentDocs301]] have been retained, but support for the other properties has been removed.
						Authors are advised to use CSS-native solutions for the removed properties where and when they
						are available.</p>
					<p>Authors currently using these prefixed properties are advised to move to unprefixed versions as
						soon as support allows, as these properties are not anticipated to be supported in the next
						major version of EPUB.</p>
				</div>



				<section id="sec-css-prefixed-writing-modes">
					<h3>CSS Writing Modes</h3>
					<p>The following table lists the <code>-epub-</code> prefixed properties for
						[[!CSS-Writing-Modes-3]]. The Value column indicates the value the property accepts. The Prior
						EPUB Mapping column indicates values/properties that were used in previous versions of EPUB 3.
						An asterisk (*) denotes that the older property or value is now deprecated. The final column
						describes how to implement the prefixed property based on [[!CSS-Writing-Modes-3-20151215]].</p>
					<table>
						<thead>
							<tr>
								<th>Property</th>
								<th>Value</th>
								<th>Prior EPUB Mapping</th>
								<th>Mapping to [[!CSS-Writing-Modes-3-20151215]]</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>upright</code></td>
								<td><code>upright</code></td>
								<td><code>upright</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>mixed</code></td>
								<td><code>vertical-right</code>*</td>
								<td><code>mixed</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>sideways-right</code></td>
								<td><code>sideways-right</code></td>
								<td><code>sideways</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>sideways-right</code></td>
								<td><code>rotate-right</code>*</td>
								<td><code>sideways</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>sideways</code></td>
								<td><code>rotate-normal</code>*</td>
								<td><code>sideways</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>sideways</code></td>
								<td><code>sideways</code></td>
								<td><code>sideways</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-orientation</code></td>
								<td><code>mixed</code></td>
								<td><code>mixed</code></td>
								<td><code>mixed</code></td>
							</tr>
							<tr>
								<td><code>-epub-writing-mode</code></td>
								<td><code>horizontal-tb</code></td>
								<td><code>horizontal-tb</code></td>
								<td><code>horizontal-tb</code></td>
							</tr>
							<tr>
								<td><code>-epub-writing-mode</code></td>
								<td><code>vertical-rl</code></td>
								<td><code>vertical-rl</code></td>
								<td><code>vertical-rl</code></td>
							</tr>
							<tr>
								<td><code>-epub-writing-mode</code></td>
								<td><code>vertical-lr</code></td>
								<td><code>vertical-lr</code></td>
								<td><code>vertical-lr</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-combine</code>*</td>
								<td><code>-epub-text-combine-horizontal: none</code></td>
								<td><code>none</code></td>
								<td><code>text-combine-upright: none</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-combine</code>*</td>
								<td><code>-epub-text-combine-horizontal: all</code></td>
								<td><code>horizontal</code></td>
								<td><code>text-combine-upright: all</code></td>
							</tr>
							<tr>
								<td><code>-epub-text-combine</code>*</td>
								<td>Error</td>
								<td><code>horizontal &lt;number&gt;</code></td>
								<td><code>text-combine-upright: digits &lt;number&gt;</code></td>
							</tr>
						</tbody>
					</table>
				</section>

				<section id="sec-css-prefixed-text">
					<h3>CSS Text Level 3</h3>
					<table>
						<thead>
							<tr>
								<th>Property</th>
								<th>Value</th>
								<th>Mapping to [[!CSS-Text-3-20160119]]</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><code>-epub-hyphens</code></td>
								<td><code>none | manual | auto</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-hyphens</code></td>
								<td><code>all</code></td>
								<td>Not Supported</td>
							</tr>
							<tr>
								<td><code>-epub-line-break</code></td>
								<td><code>auto | loose | normal | strict</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-text-align-last</code></td>
								<td><code>auto | start | end | left | right | center | justify</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-word-break</code></td>
								<td><code>normal | keep-all | break-all</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>text-transform</code></td>
								<td><code>-epub-fullwidth</code></td>
								<td><code>text-transform: full-width</code></td>
							</tr>
						</tbody>
					</table>
				</section>

				<section id="sec-css-prefixed-text-decoration">
					<h3>CSS Text Decoration Level 3</h3>
					<table>
						<thead>
							<tr>
								<th>Property</th>
								<th>Value</th>
								<th>Mapping to [[!CSS-Text-Decor-3]]</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><code>-epub-text-emphasis-color</code></td>
								<td><code>&lt;color&gt;</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-text-emphasis-position </code></td>
								<td><code>[ over | under ] &amp;&amp; [ right | left ]</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-text-emphasis-style</code></td>
								<td><code>none | [ [ filled | open ] || [ dot | circle | double-circle | triangle |
										sesame ] ] | &lt;string&gt;</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-text-underline-position</code></td>
								<td><code>auto | [ under || [ left | right ] ]</code></td>
								<td>No Change</td>
							</tr>
							<tr>
								<td><code>-epub-text-underline-position</code></td>
								<td><code>alphabetic</code></td>
								<td><code>text-underline-position: auto</code></td>
							</tr>
						</tbody>
					</table>
					<p>Property value syntax defined in <a
							href="https://www.w3.org/TR/css-values/#component-combinators">Component value
							combinators</a> [[!CSS-Values-3]].</p>
				</section>
			</section>

			<section id="sec-css-rs-overrides">
				<h2>Reading System Overrides</h2>
				<p><a>EPUB Reading Systems</a> SHOULD apply <a>Author</a> style sheets as written to <a>EPUB Content
						Documents</a>. If a Reading System allows, users SHOULD be able to override Author style sheets
					as desired. EPUB Reading Systems SHOULD NOT override Author style sheets unless strictly
					necessary.</p>
				<p>If a Reading System has to override an Author style sheet, it SHOULD do so in a way that preserves
					the Cascade: through a user agent style sheet, the <a
						href="https://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/css.html#CSS-OverrideAndComputed"
							><code>getOverrideStyle</code> method</a> [[!DOM-Level-2-Style]], or [[!HTML]] <a
						href="https://www.w3.org/TR/html/dom.html#the-style-attribute"><code>style</code>
					attributes</a>.</p>
				<p>Developers of Reading Systems are strongly encouraged to publicly document their user agent style
					sheets and how they interact with Author style sheets.</p>
			</section>
		</section>
		<section id="sec-scripted-content">
			<h1>Scripting</h1>

			<section id="sec-scripted-context">
				<h2>Scripting Contexts</h2>
				<p><a>EPUB Content Documents</a> MAY contain scripting using the facilities defined for this in the
					respective underlying specifications ([[!HTML]] and [[!SVG]]). When an EPUB Content Document
					contains scripting, it is referred to in this specification as a <a>Scripted Content Document</a>.
					This label also applies to <a>XHTML Content Documents</a> when they contain instances of [[!HTML]]
						<a href="https://www.w3.org/TR/html/sec-forms.html#sec-forms">forms</a>.</p>
				<p id="sec-scripted-content-models">This specification defines two contexts in which scripts MAY
					appear:</p>

				<dl class="variablelist">
					<dt id="sec-scripted-content-type-spine-level">spine-level</dt>
					<dd><p>An instance of the [[!HTML]] <a
								href="https://www.w3.org/TR/html/semantics-scripting.html#the-script-element"
									><code>script</code></a> or [[!SVG]] <a
								href="https://www.w3.org/TR/SVG/interact.html#ScriptElement"><code>script</code></a>
							element included in a <a>Top-level Content Document</a>.</p></dd>
					<dt id="sec-scripted-content-type-container-constrained">container-constrained</dt>
					<dd><p>Either of the following:</p>
						<ul>
							<li>
								<p>An instance of the [[!HTML]] <a
										href="https://www.w3.org/TR/html/semantics-scripting.html#the-script-element"
											><code>script</code></a> element included in an <a>XHTML Content
										Document</a> that is embedded in a parent XHTML Content Document using the
									[[!HTML]] <a
										href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-iframe-element"
											><code>iframe</code></a> element.</p></li>
							<li>
								<p>An instance of the [[!SVG]] <a
										href="https://www.w3.org/TR/SVG/script.html#ScriptElement"
										><code>script</code></a> element included in an <a>SVG Content Document</a> that
									is embedded in a parent XHTML Content Document using the [[!HTML]] <a
										href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-iframe-element"
											><code>iframe</code></a> element.</p></li>
						</ul>
					</dd>
				</dl>
				<p>In both of the above-defined contexts, whether the JavaScript code is embedded directly in the
						<code>script</code> element or referenced via its <code>src</code> attribute makes no difference
					to the executing context.</p>
				<p>Which context a script is used in determines the rights and restrictions that a Reading System places
					on it. Refer to <a href="#sec-scripted-content-content-reqs">Content Conformance</a> and <a
						href="#sec-scripted-content-rs-reqs">Reading System Conformance</a> for some specific
					requirements that have to be adhered to (not all Reading Systems will provide the same scripting
					functionality).</p>

				<h2>Example</h2>

				<aside class="example">
					<p>Consider the following example Package Document:</p>
					<pre>&lt;package …&gt;
    …
    &lt;manifest&gt;
        …
        &lt;item id="chap01" 
            href="scripted01.xhtml" 
            media-type="application/xhtml+xml"
            properties="scripted"/&gt;
        &lt;item id="inset01" 
            href="scripted02.xhtml" 
            media-type="application/xhtml+xml"
            properties="scripted"/&gt;
        &lt;item id="slideshowjs" 
            href="slideshow.js" 
            media-type="text/javascript"/&gt;
    &lt;/manifest&gt;
    
    &lt;spine …&gt;
        &lt;itemref idref="chap01"/&gt;
        …
    &lt;/spine&gt;
    …
&lt;/package&gt;</pre>

					<p>and the following file <code>scripted01.xhtml</code>:</p>

					<pre>&lt;html …&gt;
    &lt;head&gt;
        …
        &lt;script type="text/javascript"&gt;
            alert("Reading System name: " + navigator.epubReadingSystem.name);
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        …
        &lt;iframe src="scripted02.xhtml" … /&gt;
        …
    &lt;/body&gt;
&lt;/html&gt;</pre>


					<p>and the following file <code>scripted02.xhtml</code>:</p>

					<pre>&lt;html …&gt;
    &lt;head&gt;
        …
        &lt;script type="text/javascript" href="slideshow.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        …
    &lt;/body&gt;
&lt;/html&gt;</pre>

					<p>From these examples, it is true that:</p>
					<ul>
						<li>
							<p>the code in the <code>script</code> element in the <code>head</code> in
									<code>scripted01.xhtml</code> is a spine-level script because the document is
								referenced from the spine;</p></li>
						<li>
							<p>the code in the <code>script</code> element in <code>scripted02.xhtml</code> is a
								container-constrained script because the HTML file it occurs in is included in
									<code>scripted01.xhtml</code> via the <code>iframe</code> element.</p></li>
					</ul>
				</aside>
			</section>

			<section id="sec-scripted-content-content-reqs">
				<h2>Content Conformance</h2>

				<dl class="conformance-list">
					<dt>Container-constrained scripts</dt>
					<dd><p id="confreq-cd-scripted-container">A container-constrained script MUST NOT contain
							instructions for modifying the DOM of the parent Content Document or other contents in the
							EPUB Publication, and MUST NOT contain instructions for manipulating the size of its
							containing rectangle.</p></dd>
					<dt>Spine-level scripts</dt>
					<dd><p id="confreq-cd-scripted-spine">EPUB Content Documents that include <a
								href="#sec-scripted-content-type-spine-level">spine-level</a> scripting MUST utilize the
								<em>progressive enhancement technique</em>, which for the purposes of this specification
							has the following definition: when the document is rendered by a Reading System without
							scripting support or with scripting support disabled, the <a>Top-level Content Document</a>
							MUST retain its integrity, remaining consumable by the user without any information loss or
							other significant deterioration.</p></dd>
					<dt>Accessibility</dt>
					<dd><p id="confreq-cd-scripted-a11y">EPUB Content Documents that <a
								href="#sec-scripted-content-models">include scripting</a> SHOULD employ relevant
							[[!WAI-ARIA]] accessibility techniques to ensure that the content remains consumable by all
							users.</p></dd>
					<dt id="confreq-cd-scripted-flbk">Fallbacks</dt>
					<dd><p id="confreq-cd-scripted-fallback">EPUB Content Documents that <a
								href="#sec-scripted-content-models">include scripting</a> MAY provide fallbacks for such
							content, either by using intrinsic fallback mechanisms (such as those available for the
							[[!HTML]] <a
								href="https://www.w3.org/TR/html/semantics-embedded-content.html#the-object-element"
									><code>object</code></a> and <a
								href="https://www.w3.org/TR/html/semantics-scripting.html#the-canvas-element"
									><code>canvas</code></a> elements) or, when an intrinsic fallback is not applicable,
							by using a <a href="epub-packages.html#sec-foreign-restrictions-manifest">manifest-level
								fallback</a> [[!Packages32]].</p>
						<p id="confreq-cd-scripted-foreign-resources">Authors MUST ensure that scripts only generate <a
								href="epub-spec.html#sec-core-media-types">Core Media Type Resources</a> or fragments
							thereof [[!EPUB32]].</p></dd>
				</dl>

				<div class="note">
					<p>The <a href="epub-packages.html#scripted"><code>scripted</code> property</a> of the
							<a>manifest</a>
						<code>item</code> element indicates that an EPUB Content Document is a <a>Scripted Content
							Document</a>.</p>
				</div>

			</section>

			<section id="sec-scripted-content-rs-reqs">
				<h2>Reading System Conformance</h2>
				<p>A Reading System that supports scripting MUST meet the following criteria:</p>
				<ul class="conformance-list">
					<li><p id="confreq-rs-scripted-reflow-support">It SHOULD support <a
								href="#sec-scripted-content-type-container-constrained">container-constrained</a>
							scripting in reflowable EPUB Content Documents.</p></li>
					<li><p id="confreq-rs-scripted-fxl-support">It SHOULD support <a
								href="#sec-scripted-content-type-spine-level">spine-level</a> scripting in <a
								href="#sec-fixed-layouts">fixed-layout documents</a>.</p></li>
					<li><p id="confreq-rs-scripted-scrolled">It SHOULD support spine-level scripting in reflowable EPUB
							Content Documents that use the <a href="epub-packages.html#flow-scrolled-doc"
									>"<code>scrolled-doc</code>"</a> or <a
								href="epub-packages.html#flow-scrolled-continuous"
								>"<code>scrolled-continuous</code>"</a> presentation modes defined by <a
								href="epub-packages.html#flow">the <code>rendition:flow</code> property</a>
							[[!Packages32]]. Similarly, if it supports spine-level scripting in reflowable EPUB Content
							Documents, it MUST implement the "<code>scrolled-doc</code>" presentation mode and SHOULD
							implement the "<code>scrolled-continuous</code>" presentation mode.</p></li>
					<li><p id="confreq-rs-scripted-optional-support">It MAY support scripting in other contexts, but
							this specification does not address such scripting. As a result, the use of scripting in
							these contexts might not be consistent across Reading Systems.</p></li>
					<li><p id="confreq-rs-scripted-ua">It MAY render <a>Scripted Content Documents</a> as an
							interactive, scripted user agent according to [[!HTML]].</p></li>
					<li><p id="confreq-rs-scripted-container">It MUST NOT allow a container-constrained script to modify
							the DOM of the parent Content Document or other contents in the EPUB Publication, and MUST
							NOT allow it to manipulate the size of its containing rectangle. (Note: Even if a script is
							not container-constrained, the Reading System MAY impose restrictions on modifications (see
							also the <a href="#feature-dom-manipulation">dom-manipulation feature</a>).)</p></li>
					<li><p id="confreq-rs-scripted-limit">It MAY place additional limitations on the capabilities
							provided to scripts during execution (e.g., limiting networking).</p></li>
					<li><p id="confreq-rs-scripted-readingsystem-object">It MUST implement the JavaScript
								<code>navigator</code> extension object <code>epubReadingSystem</code> defined in <a
								href="#app-epubReadingSystem">Appendix A, <em>JavaScript epubReadingSystem
								Object</em></a>. It also MUST support the <code>dom-manipulation</code> and
								<code>layout-change</code> features defined in <a href="#app-ers-hasFeature-features"
								>Features</a> in container-constrained scripting contexts.</p></li>
				</ul>
				<p>A Reading System that does not support scripting MUST meet the following criteria:</p>
				<ul class="conformance-list">
					<li><p id="confreq-rs-scripted-flbk">It MUST process fallbacks for scripted content as defined in <a
								href="#confreq-cd-scripted-flbk">Fallbacks for Scripted Content Documents</a>.</p></li>
				</ul>

				<div class="note">
					<p>Reading Systems might render Scripted Content Documents in a manner that disables other EPUB
						capabilities and/or provides a different rendering and user experience (e.g., by disabling
						pagination).</p>
					<p>Authors choosing to restrict the usage of scripting to the <a
							href="#sec-scripted-content-type-container-constrained">container-constrained</a> model will
						ensure a more consistent user experience between scripted and non-scripted content (e.g.,
						consistent pagination behavior).</p>
					<p>Authors are advised to use declarative techniques whenever practical to increase the
						interoperability, longevity and accessibility of their EPUB Publications, and avoid the
						inclusion of scripting whenever practical.</p>
				</div>

			</section>

			<section id="sec-scripted-content-security" class="informative">
				<h2>Security Considerations</h2>
				<p>All EPUB <a>Authors</a> and <a>EPUB Reading System</a> developers have to be aware of the security
					issues that arise when scripted content is executed by a Reading System. As the underlying scripting
					model employed by Reading Systems and browsers is the same, the same kinds of issues encountered in
					Web contexts have to be taken into consideration.</p>
				<p>Each Reading System has to establish if the scripts in a particular document are to be trusted or
					not. It is advised that all scripts be treated as untrusted (and potentially malicious), and that
					all vectors of attack be examined and protected against. In particular, the following need to be
					considered:</p>
				<ul>
					<li>
						<p>an attack against the runtime environment (e.g., stealing files from a user's hard
							drive);</p></li>
					<li>
						<p>an attack against the Reading System itself (e.g., stealing a list of a user's books or
							causing unexpected behavior);</p></li>
					<li>
						<p>an attack of one Content Document against another (e.g., stealing data that originated in a
							different document);</p></li>
					<li>
						<p>an attack of an unencrypted script against an encrypted portion of a document (e.g., an
							injected malicious script extracting protected content);</p></li>
					<li>
						<p>an attack against the local network (e.g., stealing data from a server behind a
							firewall).</p></li>
				</ul>
				<p>The following recommendations are provided as a guide to handling untrusted scripts:</p>
				<ul>
					<li>
						<p>Reading Systems need to behave as if a unique domain were allocated to each Content Document,
							as browser-based security relies heavily on document URLs and domains. Adopting this
							approach will isolate documents from each other and from other Internet domains, thereby
							limiting access to external URLs, cookies, DOM storage, etc.</p>
						<p>Reading Systems that enable scripting and network access also need to consider including
							methods to notify the user that network activity is occurring and/or that allow them to
							disable it.</p>
						<div class="note">
							<p>In practice, Reading Systems might share domains across documents, but they still need to
								maintain isolation between documents.</p>
							<p>If parts of a document are encrypted and parts are not, or if different encryption keys
								are used for different parts of the document, a unique per-document domain might not
								provide sufficient protection.</p>
						</div>
					</li>
					<li>
						<p>If a Reading System allows persistent data to be stored, that data needs to be treated as
							sensitive. Scripts might save persistent data through cookies and DOM storage, but Reading
							Systems might block such attempts. Reading Systems that do allow data to be stored have to
							ensure that it is not made available to other unrelated documents (e.g., ones that could
							have been spoofed). In particular, checking for a matching document identifier (or similar
							metadata) is not a valid method to control access to persistent data.</p>
						<p>Reading Systems that allow local storage also need to provide methods for users to inspect,
							disable, or delete that data. The data needs to be destroyed if the corresponding EPUB
							Publication is deleted.</p></li>
				</ul>
				<p>Note that compliance with these recommendations does not guarantee protection from the possible
					attacks listed above; developers have to examine each potential vulnerability within the context of
					their Reading System.</p>
			</section>

			<section id="sec-scripted-content-events" class="informative">
				<h2>Event Model Considerations</h2>
				<p>Reading Systems need to follow the DOM Event model as per [[HTML]] and pass UI events to the
					scripting environment before performing any default action associated with these events. Reading
					System implementers need to ensure that scripts cannot disable critical functionality (such as
					navigation) to constrain the extent to which a <a href="#sec-scripted-content-security">potentially
						malicious</a> script could impact their Reading Systems. As a result, although the scripting
					environment needs to be able to cancel the default action of any event, some events either might not
					be passed through or might not be cancelable.</p>
				<p><a>Authors</a> need to take into account the wide variety of possible Reading System implementations
					when adding scripting functionality to their EPUB Publications (e.g., not all devices have physical
					keyboards, and in many cases a soft keyboard is activated only for text input elements).
					Consequently, relying on keyboard events alone is not advised; alternative ways to trigger a desired
					action always need to be provided.</p>
			</section>
		</section>
		<section id="sec-fixed-layouts">
			<h1>Fixed Layouts</h1>

			<section id="sec-fxl-overview" class="informative">
				<h2>Introduction</h2>

				<p>This section defines rules for the expression and interpretation of dimensional properties of
						<a>Fixed-Layout Documents</a> — <a>EPUB Content Documents</a> marked as
						<code>pre-paginated</code> in the <a>Package Document</a>.</p>

				<p>This specification does not define how the <a
						href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">initial containing
						block</a> [[CSS2]] will be placed within the Reading System <a>Content Display Area</a>.</p>

				<div class="note">
					<p>Refer to <a href="epub-packages.html#sec-package-metadata-fxl">Fixed-Layout Properties</a>
						[[Packages32]] for information on how to designate that a <a>Rendition</a>, or its individual
						spine items, are to be rendered in a pre-paginated manner (i.e., with fixed width and height
						dimensions).</p>
				</div>

			</section>

			<section id="sec-fxl-content-conf">
				<h2>Content Conformance</h2>
				<p>A conformant <a>Fixed-Layout Document</a> MUST meet all of the following criteria:</p>
				<ul class="conformance-list">
					<li>
						<p>It MUST specify its <a
								href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">initial
								containing block</a> [[!CSS2]] as defined in <a href="#sec-fxl-html-svg-dimensions"
								>Initial Containing Block Dimensions</a>.</p></li>
				</ul>
			</section>

			<section id="sec-fxl-rs-conf">
				<h2>Reading System Conformance</h2>
				<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for processing
						<a>Fixed-Layout Documents</a>:</p>
				<ul class="conformance-list">
					<li><p id="confreq-fxl-rs-viewport">It SHOULD allocate the full <a>Content Display Area</a> for the
							document, as defined in <a href="#sec-fxl-viewport">Viewport Rendering</a>.</p></li>
					<li><p id="confreq-fxl-rs-html">It MUST use the dimensions expressed in the <code>viewport</code>
							<code>meta</code> tag to render <a>XHTML Content Documents</a>, as defined in <a
								href="#sec-fxl-icb-html">Expressing the ICB in HTML</a>.</p></li>
					<li><p id="confreq-fxl-rs-svg">It MUST use the dimensions as defined in <a href="#sec-fxl-icb-svg"
								>Expressing the ICB in SVG</a> to render <a>SVG Content Documents</a>.</p></li>
				</ul>
			</section>

			<section id="sec-fxl-viewport">
				<h2>Viewport Rendering</h2>

				<p>When rendering <a>Fixed-Layout Documents</a>, the default intent is that the <a>Content Display
						Area</a> SHOULD occupy as much of the available <a>Viewport</a> area as possible. <a>Reading
						Systems</a> SHOULD NOT inject additional content such as border, margins, headers or footers
					into the Viewport.</p>

				<div class="note">
					<p>The exposure of Reading System control widgets to the user is implementation-specific and not
						included in the above behavioral expectations.</p>
				</div>

			</section>

			<section id="sec-fxl-html-svg-dimensions">
				<h2>Initial Containing Block Dimensions</h2>

				<section id="sec-fxl-icb-html">
					<h3>Expressing in HTML</h3>

					<p>For XHTML <a>Fixed-Layout Documents</a>, the <a
							href="https://www.w3.org/TR/CSS2/visudet.html#containing-block-details">initial containing
							block</a> [[!CSS2]] dimensions MUST be expressed in a <code>viewport</code>
						<code>meta</code> tag using the syntax defined in [[!CSS-Device-Adapt-1]]. In this version of
						this specification, only the width and height expressions MUST be recognized by <a>Reading
							Systems</a>.</p>

					<aside class="example">
						<p>The following example shows a <code>viewport</code>
							<code>meta</code> tag.</p>
						<pre>
&lt;head&gt;
   …
   &lt;meta name="viewport" content="width=1200, height=600"/&gt;
   …
&lt;/head&gt;</pre>
					</aside>


					<p>Reading Systems MUST clip XHTML content to the initial containing block (ICB) dimensions declared
						in the <code>viewport</code>
						<code>meta</code> tag — content positioned outside of the initial containing block will not be
						visible. When the ICB aspect ratio does not match the aspect ratio of the Reading System
							<a>Content Display Area</a>, Reading Systems MAY position the ICB inside the area to
						accommodate the user interface; in other words, added letter-boxing space MAY appear on either
						side (or both) of the content.</p>
				</section>

				<section id="sec-fxl-icb-svg">
					<h3>Expressing in SVG</h3>

					<p>For SVG <a>Fixed-Layout Documents</a>, the ICB dimensions MUST be expressed using the <a
							href="http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute"><code>viewBox</code>
							attribute</a> [[!SVG]].</p>

					<aside class="example">
						<p>The following example shows a <code>viewBox</code> attribute declaration for an SVG Content
							Document with an aspect ratio of 844 pixels wide by 1200 pixels high.</p>
						<pre>
&lt;svg xmlns="http://www.w3.org/2000/svg"
     version="1.1" 
     viewBox="0 0 844 1200"&gt;
   …
&lt;/svg&gt;</pre>
					</aside>
				</section>
			</section>
		</section>
		<section id="sec-pls">
			<h1>Pronunciation Lexicons</h1>

			<section id="sec-pls-intro" class="informative">
				<h2>Introduction</h2>
				<p>The W3C Pronunciation Lexicon Specification (PLS) [[PRONUNCIATION-LEXICON]] defines syntax and
					semantics for XML-based pronunciation lexicons to be used by Automatic Speech Recognition and
						<a>Text-to-Speech</a> (TTS) engines.</p>
				<p>The following sections define conformance criteria for PLS documents when included in <a>EPUB
						Publications</a>, and rules for associating PLS documents with <a>XHTML Content
					Documents</a>.</p>

				<div class="note">
					<p>For more information on EPUB 3 features related to synthetic speech, refer to <a
							href="epub-overview.html#sec-tts">Text-to-speech</a> [[EPUB3Overview]].</p>
				</div>

			</section>

			<section id="sec-pls-conf-pub">
				<h2>EPUB Publication Conformance</h2>
				<p>A conformant <a>Rendition</a> of an <a>EPUB Publication</a> MUST meet all of the following criteria
					for inclusion of <abbr title="Pronunciation Lexicon Specification">PLS</abbr> documents:</p>
				<ul class="conformance-list">
					<li><p id="confreq-cd-pls-xht">PLS Documents MAY be associated with <a>XHTML Content Documents</a>.
							Each XHTML Content Document MAY contain zero or more PLS document associations.</p></li>
					<li><p id="confreq-cd-pls-assoc">PLS documents MUST be associated with the <a>XHTML Content
								Document</a> to which they apply using the [[!HTML]] <a
								href="https://www.w3.org/TR/html/document-metadata.html#the-link-element"
									><code>link</code></a> element with its <code>rel</code> attribute set to
								"<code>pronunciation</code>" and its <code>type</code> attribute set to the media type
								"<code>application/pls+xml</code>".</p><p id="confreq-cd-pls-assoc-lang">The
								<code>link</code> element <code>hreflang</code> attribute SHOULD be specified on each
								<code>link</code>, and its value MUST match <a
								href="https://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/#S4.1">the language
								for which the pronunciation lexicon is relevant</a> [[!PRONUNCIATION-LEXICON]] when
							specified.</p></li>
					<li><p id="confreq-pls-pub-cont">PLS documents MUST meet the content conformance criteria defined in
								<a href="#sec-pls-conf-content">PLS Documents — Content Conformance</a>.</p></li>
					<li><p id="confreq-pls-pub-manif">PLS documents MUST be represented and located as defined in <a
								href="epub-packages.html#sec-package-conformance">EPUB Package — Conformance</a>
							[[!Packages32]].</p></li>
				</ul>

				<section id="pls-examples">
					<h3>Examples</h3>

					<aside class="example">
						<p>The following example shows two <abbr title="Pronunciation Lexicon Specification">PLS</abbr>
							documents (one for Chinese and one for Mongolian) associated with an XHTML Content
							Document.</p>
						<pre>
&lt;html … &gt;    
    &lt;head&gt;
        …
        &lt;link rel="pronunciation" type="application/pls+xml" hreflang="zh" href="../speech/zh.pls"/&gt;
        &lt;link rel="pronunciation" type="application/pls+xml" hreflang="mn" href="../speech/mn.pls"/&gt;
    &lt;/head&gt;        
    …
&lt;/html&gt;</pre>
					</aside>
				</section>
			</section>

			<section id="sec-pls-conf-content">
				<h2>Content Conformance</h2>
				<p>A <abbr title="Pronunciation Lexicon Specification">PLS</abbr> document MUST meet all of the
					following criteria:</p>

				<dl class="conformance-list">
					<dt id="confreq-cd-pls-docprops">Document Properties</dt>
					<dd><p id="confreq-cd-pls-xml">It MUST meet the conformance constraints for XML documents defined in
								<a href="epub-spec.html#sec-xml-constraints">XML Conformance</a> [[!EPUB32]].</p>
						<p id="confreq-cd-pls-docprops-schema">It MUST be valid to the RELAX NG schema for PLS documents
							available at the URI <a class="uri"
								href="https://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/pls.rng"
									><code>https://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/</code></a>
							[[!PRONUNCIATION-LEXICON]].</p></dd>
					<dt id="confreq-cd-pls-fileprops">File Properties</dt>
					<dd><p id="confreq-cd-pls-fileprops-name">The PLS document filename SHOULD use the file extension
								<code class="filename">.pls</code>.</p></dd>
				</dl>
			</section>

			<section id="sec-pls-conf-rs">
				<h2>Reading System Conformance</h2>
				<p>Reading Systems with Text-to-Speech (TTS) capabilities SHOULD support <abbr
						title="Pronunciation Lexicon Specification">PLS</abbr> documents.</p>
				<p>A conformant <a>EPUB Reading System</a> MUST meet all of the following criteria for processing PLS
					documents:</p>
				<ul class="conformance-list">
					<li><p id="confreq-pls-rs-sptts">Reading Systems with <a>Text-to-Speech</a> (TTS) capabilities
							SHOULD support [[!PRONUNCIATION-LEXICON]].</p>
						<p id="confreq-pls-rs-proc">It MUST process PLS documents as defined in
							[[!PRONUNCIATION-LEXICON]].</p>
						<p id="confreq-pls-rs-scope">It MUST apply the supplied pronunciation instructions to all text
							nodes in the current XHTML Content Document whose <a
								href="https://www.w3.org/TR/html/dom.html#the-lang-and-xmllang-attributes">language</a>
							[[!HTML]] matches <a
								href="https://www.w3.org/TR/2008/REC-pronunciation-lexicon-20081014/#S4.1">the language
								for which the pronunciation lexicon is relevant</a> [[!PRONUNCIATION-LEXICON]]. The
							algorithm for matching language tags is defined in [[!BCP47]].</p>
						<p id="confreq-pls-rs-multi">When a pronunciation rule is specified more than once for a given
							string target in a given language, it MUST give precedence to the last occurrence of the
							rule in such a way that any previously-defined pronunciation rule gets overridden.</p>
						<p id="confreq-pls-rs-casc">If it also supports <a href="#sec-xhtml-ssml-attrib">SSML
								Attributes</a>, it MUST let any pronunciation instructions provided via the <a
								href="#sec-cd-ssml-ph-attrib"><code>ssml:ph</code></a> attribute take precedence in
							cases where a <code>grapheme</code> element [[!PRONUNCIATION-LEXICON]] matches a text node
							of an element that carries the <code>ssml:ph</code> attribute [[!SSML]].</p></li>
				</ul>
			</section>
		</section>
		<section class="appendix" id="app-epubReadingSystem">
			<h1>JavaScript <dfn>epubReadingSystem</dfn> Object</h1>

			<section id="app-ers-idl">
				<h2>Interface Definition</h2>

				<p>This specification extends the [[!HTML]] <dfn>Navigator</dfn> object as follows.</p>

				<pre class="idl">[Exposed=(Window)]
interface EpubReadingSystem {
    [Unforgeable] readonly attribute DOMString name;
    [Unforgeable] readonly attribute DOMString version;
    boolean hasFeature(DOMString feature, optional DOMString version);
};

partial interface Navigator {
    [Unforgeable, SameObject] readonly attribute EpubReadingSystem epubReadingSystem;
};</pre>
				<p>[[!WEBIDL]] notation.</p>

				<div class="note">
					<p>This specification does not define an <code>epubReadingSystem</code> property extension for the
							<a href="https://www.w3.org/TR/2015/WD-workers-20150924/#the-workernavigator-object"
								><code>WorkerNavigator</code> object</a> [[WebWorkers]]. Reading Systems therefore do
						not have to expose the <code>epubReadingSystem</code> object in the scripting context of
						Workers, and Authors cannot rely on its presence.</p>
				</div>

			</section>

			<section id="app-ers-desc">
				<h2>Description</h2>

				<p>The <code><dfn>Navigator.epubReadingSystem</dfn></code> object provides an interface through which a
						<a>Scripted Content Document</a> can query information about a user's <a>Reading System</a>.</p>

				<p>The object exposes <a href="#app-ers-properties">properties</a> of the Reading System (its name and
					version), and provides the <a href="#app-ers-hasFeature"><code>hasFeature</code> method</a> which
					can be invoked to determine the features it supports.</p>

				<aside class="example">
					<p>Example JavaScript function that displays the name of the current Reading System.</p>

					<pre>alert("Reading System name: " + navigator.epubReadingSystem.name);</pre>
				</aside>

				<p>Reading Systems MUST expose the <code>epubReadingSystem</code> object on the <code>navigator</code>
					object of all loaded Scripted Content Documents, including any nested <a
						href="#sec-scripted-content-type-container-constrained">container-constrained</a> scripting
					contexts. Reading Systems MUST ensure that the <code>epubReadingSystem</code> object is available no
					later than when the <a href="https://www.w3.org/TR/html/syntax.html#the-end"
							><code>DOMContentLoaded</code> event is triggered</a> [[!HTML]].</p>

				<div class="note">
					<p>Reading systems implementations might create cloned instances of the
							<code>epubReadingSystem</code> object in Scripted Content Documents for technical
						feasibility reasons. In such cases, the Reading System has to ensure that the object’s state —
						as reflected by the values of its properties and methods — is consistently maintained across all
						copied instances.</p>
				</div>
			</section>

			<section id="app-ers-properties">
				<h2>Properties</h2>

				<p>The following properties MUST be made available for retrieving information about the Reading
					System.</p>

				<table data-dfn-for="epubReadingSystem">
					<thead>
						<tr>
							<th>Name</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td id="propdef-name"><code><dfn>name</dfn></code></td>
							<td>Returns a <code>String</code> value representing the name of the Reading System (e.g.,
									"<code>iBooks</code>", "<code>Kindle</code>").</td>
						</tr>
						<tr>
							<td id="propdef-version"><code><dfn>version</dfn></code></td>
							<td>Returns a <code>String</code> value representing the version of the Reading System
								(e.g., "<code>1.0</code>", "<code>2.1.1</code>").</td>
						</tr>
						<tr>
							<td id="propdef-layoutStyle"><code><dfn>layoutStyle</dfn></code></td>
							<td>Use of the <code>layoutStyle</code> property is <a href="epub-spec.html#deprecated"
									>deprecated</a>. Refer to its definition in [[!ContentDocs301]] for usage
								information.</td>
						</tr>
					</tbody>
				</table>
			</section>

			<section id="app-ers-methods">
				<h2>Methods</h2>

				<section id="app-ers-hasFeature">
					<h3>hasFeature</h3>

					<section id="app-ers-hasFeature-desc">
						<h4>Description</h4>

						<p data-dfn-for="epubReadingSystem">The <code><dfn>hasFeature</dfn></code> method returns a
							boolean value indicating whether any version of the specified feature is supported, or
								<code>undefined</code> if the specified feature is not recognized.</p>

						<p>The OPTIONAL <code>version</code> parameter is included for querying custom features that
							could change in incompatible ways over time. The return value indicates support only for the
							specified version of the feature.</p>

						<p><a>Authors</a> SHOULD NOT include the <code>version</code> parameter when querying <a
								href="#app-ers-hasFeature-features">features defined in this specification</a> — these
							features are considered versionless. If a Reading System supports a feature defined in this
							specification, it MUST ignore any supplied <code>version</code> parameter and return a
								<code>true</code> value.</p>

						<aside class="example">
							<p>Example JavaScript function that displays whether the current Reading System supports
								scripted manipulation of the DOM.</p>

							<pre>var feature = "dom-manipulation";

var conformTest = navigator.epubReadingSystem.hasFeature(feature);

alert("Feature " + feature + " supported?: " + conformTest);</pre>
						</aside>
					</section>

					<section id="app-ers-hasFeature-features">
						<h4>Features</h4>

						<p>The following table lists the set of features that Reading Systems that support the
								<code>epubReadingSystem</code> object MUST recognize (i.e., provide a return value for).
							Support for these features is OPTIONAL.</p>

						<table>
							<thead>
								<tr>
									<th>Name</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td id="feature-dom-manipulation"><code>dom-manipulation</code></td>
									<td>Scripts MAY make structural changes to the document’s DOM (applies to <a
											href="#sec-scripted-content-type-spine-level">spine-level scripting</a>
										only).</td>
								</tr>
								<tr>
									<td id="feature-layout-changes"><code>layout-changes</code></td>
									<td>Scripts MAY modify attributes and CSS styles that affect content layout (applies
										to <a href="#sec-scripted-content-type-spine-level">spine-level scripting</a>
										only).</td>
								</tr>
								<tr>
									<td id="feature-touch-events"><code>touch-events</code></td>
									<td>The device supports touch events and the Reading System passes touch events to
										the content.</td>
								</tr>
								<tr>
									<td id="feature-mouse-events"><code>mouse-events</code></td>
									<td>The device supports mouse events and the Reading System passes mouse events to
										the content.</td>
								</tr>
								<tr>
									<td id="feature-keyboard-events"><code>keyboard-events</code></td>
									<td>The device supports keyboard events and the Reading System passes keyboard
										events to the content.</td>
								</tr>
								<tr>
									<td id="feature-spine-scripting"><code>spine-scripting</code></td>
									<td>Indicates whether the Reading System supports <a
											href="#sec-scripted-content-type-spine-level">spine-level scripting</a>
										(e.g., so a <a href="#sec-scripted-content-type-container-constrained"
											>container-constrained script</a> can determine whether any actions that
										depend on scripting support in a <a>Top-level Content Document</a> have any
										chance of success before attempting them).</td>
								</tr>
							</tbody>
						</table>

						<p>Additional features MAY be added by Reading System developers, but future versions of this
							specification might append to this list in ways that could conflict or be incompatible with
							any such custom additions.</p>
					</section>
				</section>
			</section>
		</section>
		<div data-include="acknowledgements.html" data-oninclude="fixIncludes" data-include-replace="true"></div>
	</body>
</html>
